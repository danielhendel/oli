{
  "version": 3,
  "sources": ["../src/index.ts", "../src/firebaseAdmin.ts", "../src/normalization/onRawEventCreated.ts", "../src/normalization/mapRawEventToCanonical.ts", "../../../node_modules/zod/v3/external.js", "../../../node_modules/zod/v3/helpers/util.js", "../../../node_modules/zod/v3/ZodError.js", "../../../node_modules/zod/v3/locales/en.js", "../../../node_modules/zod/v3/errors.js", "../../../node_modules/zod/v3/helpers/parseUtil.js", "../../../node_modules/zod/v3/helpers/errorUtil.js", "../../../node_modules/zod/v3/types.js", "../../../lib/contracts/day.ts", "../../../lib/contracts/rawEvent.ts", "../../../lib/contracts/dailyFacts.ts", "../../../lib/contracts/intelligenceContext.ts", "../../../lib/contracts/insights.ts", "../../../lib/contracts/derivedLedger.ts", "../../../lib/contracts/dayTruth.ts", "../../../lib/contracts/failure.ts", "../../../lib/contracts/weight.ts", "../../../lib/contracts/preferences.ts", "../../../lib/contracts/labResults.ts", "../../../lib/contracts/retrieval.ts", "../../../lib/contracts/uploads.ts", "../../../lib/contracts/readiness.ts", "../../../lib/contracts/export.ts", "../../../lib/contracts/healthScore.ts", "../src/validation/rawEvent.ts", "../src/normalization/writeCanonicalEventImmutable.ts", "../src/normalization/canonicalImmutability.ts", "../src/ingestion/rawEventDedupe.ts", "../src/ingestion/stableJson.ts", "../src/failures/writeFailureImmutable.ts", "../src/dailyFacts/aggregateDailyFacts.ts", "../src/dailyFacts/enrichDailyFacts.ts", "../src/insights/intelligenceContext.ts", "../src/insights/rules.ts", "../src/intelligence/buildDailyIntelligenceContext.ts", "../src/pipeline/pipelineMeta.ts", "../src/pipeline/derivedLedger.ts", "../src/healthScore/computeHealthScoreV1.ts", "../src/healthScore/writeHealthScoreImmutable.ts", "../src/pipeline/recomputeForDay.ts", "../src/realtime/onCanonicalEventCreated.ts", "../src/pipeline/pipelineLatency.ts", "../src/dailyFacts/onDailyFactsRecomputeScheduled.ts", "../src/insights/onInsightsRecomputeScheduled.ts", "../src/intelligence/onDailyIntelligenceContextRecomputeScheduled.ts", "../src/account/onAccountDeleteRequested.ts", "../src/account/onAccountExportRequested.ts", "../src/http/recomputeDailyFactsAdminHttp.ts", "../src/http/adminAuth.ts", "../src/http/recomputeInsightsAdminHttp.ts", "../src/http/recomputeDailyIntelligenceContextAdminHttp.ts"],
  "sourcesContent": ["// services/functions/src/index.ts\n\nimport * as functionsV1 from \"firebase-functions/v1\";\nimport { setGlobalOptions } from \"firebase-functions/v2\";\n\nimport { admin, db } from \"./firebaseAdmin\";\n\n// =============================\n// Global options (v2 only)\n// =============================\n//\n// NOTE:\n// We no longer rely on setGlobalOptions() for IAM correctness because\n// each Gen2 function explicitly sets { region, serviceAccount } in its\n// own options object (approved strategy). This remains as a safe default.\nsetGlobalOptions({\n  region: \"us-central1\",\n  // Runtime service account for Gen2 functions (Cloud Run service identity)\n  serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n});\n\n// =============================\n// Triggers & Scheduled Jobs (v2)\n// =============================\n//\n// IMPORTANT:\n// These are static ES imports so the module graph loads deterministically.\n// IAM correctness is enforced per-function via explicit options objects.\n\n// Firestore triggers\nimport { onRawEventCreated } from \"./normalization/onRawEventCreated\";\nimport { onCanonicalEventCreated } from \"./realtime/onCanonicalEventCreated\";\n\n// Scheduled recompute jobs\nimport { onDailyFactsRecomputeScheduled } from \"./dailyFacts/onDailyFactsRecomputeScheduled\";\nimport { onInsightsRecomputeScheduled } from \"./insights/onInsightsRecomputeScheduled\";\nimport { onDailyIntelligenceContextRecomputeScheduled } from \"./intelligence/onDailyIntelligenceContextRecomputeScheduled\";\n\n// Account executors (Pub/Sub)\nimport { onAccountDeleteRequested } from \"./account/onAccountDeleteRequested\";\nimport { onAccountExportRequested } from \"./account/onAccountExportRequested\";\n\n// Admin-only HTTP endpoints\nimport { recomputeDailyFactsAdminHttp } from \"./http/recomputeDailyFactsAdminHttp\";\nimport { recomputeInsightsAdminHttp } from \"./http/recomputeInsightsAdminHttp\";\nimport { recomputeDailyIntelligenceContextAdminHttp } from \"./http/recomputeDailyIntelligenceContextAdminHttp\";\n\n// =============================\n// Helpers (v1)\n// =============================\n\nfunction defaultGeneralProfile(user: {\n  uid: string;\n  displayName?: string | null;\n  email?: string | null;\n}) {\n  const now = admin.firestore.FieldValue.serverTimestamp();\n\n  return {\n    displayName: user.displayName ?? null,\n    firstName: null as string | null,\n    lastName: null as string | null,\n    avatarUrl: null as string | null,\n    email: user.email ?? null,\n    createdAt: now,\n    updatedAt: now,\n  };\n}\n\n// =============================\n// v1 Auth Trigger\n// =============================\n//\n// IMPORTANT:\n// Move Gen1 Auth trigger off the App Engine Default Service Account.\n// Sprint requirement: no default SAs with elevated permissions.\n// This keeps logic identical; only runtime identity changes.\nexport const onAuthCreate = functionsV1\n  .runWith({\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  })\n  .region(\"us-central1\")\n  .auth.user()\n  .onCreate(async (user) => {\n    const uid = user.uid;\n\n    await db.doc(`users/${uid}/profile/general`).set(defaultGeneralProfile(user), {\n      merge: true,\n    });\n  });\n\n// =============================\n// v2 Exports (DEPLOYED)\n// =============================\n\n// Firestore triggers\nexport { onRawEventCreated };\nexport { onCanonicalEventCreated };\n\n// Scheduled recompute jobs\nexport { onDailyFactsRecomputeScheduled };\nexport { onInsightsRecomputeScheduled };\nexport { onDailyIntelligenceContextRecomputeScheduled };\n\n// Account executors (Pub/Sub)\nexport { onAccountDeleteRequested };\nexport { onAccountExportRequested };\n\n// Admin-only HTTP endpoints\nexport { recomputeDailyFactsAdminHttp };\nexport { recomputeInsightsAdminHttp };\nexport { recomputeDailyIntelligenceContextAdminHttp };\n", "// services/functions/src/firebaseAdmin.ts\n\nimport * as admin from 'firebase-admin';\n\ntry {\n  // Reuse existing app if already initialized (cold start vs warm start).\n  admin.app();\n} catch {\n  admin.initializeApp();\n}\n\n/**\n * Shared firebase-admin instance for all Cloud Functions.\n */\nexport { admin };\n\n/**\n * Shared Firestore reference.\n */\nexport const db = admin.firestore();\n", "// services/functions/src/normalization/onRawEventCreated.ts\n\nimport { onDocumentCreated } from \"firebase-functions/v2/firestore\";\nimport * as logger from \"firebase-functions/logger\";\nimport { mapRawEventToCanonical, isFactOnlyKind } from \"./mapRawEventToCanonical\";\nimport { parseRawEvent } from \"../validation/rawEvent\";\nimport { writeCanonicalEventImmutable } from \"./writeCanonicalEventImmutable\";\nimport { upsertRawEventDedupeEvidence } from \"../ingestion/rawEventDedupe\";\nimport { writeFailureImmutable } from \"../failures/writeFailureImmutable\";\nimport { recomputeDerivedTruthForDay } from \"../pipeline/recomputeForDay\";\nimport { db } from \"../firebaseAdmin\";\nimport type { DailyBodyFacts, YmdDateString } from \"../types/health\";\n\nfunction toYmdUtc(d: Date): string {\n  const y = d.getUTCFullYear();\n  const m = (d.getUTCMonth() + 1).toString().padStart(2, \"0\");\n  const day = d.getUTCDate().toString().padStart(2, \"0\");\n  return `${y}-${m}-${day}`;\n}\n\nfunction deriveDayFromRaw(raw: Record<string, unknown> | undefined): string | null {\n  if (!raw) return null;\n  const observedAt = raw[\"observedAt\"];\n  const timeZone = raw[\"timeZone\"];\n  if (typeof observedAt !== \"string\" || typeof timeZone !== \"string\") return null;\n  try {\n    const d = new Date(observedAt);\n    if (Number.isNaN(d.getTime())) return null;\n    const fmt = new Intl.DateTimeFormat(\"en-CA\", { timeZone });\n    return fmt.format(d);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Derive dayKey and factOnlyBody from a fact-only rawEvent (e.g. weight).\n * Must match canonical day derivation: Intl.DateTimeFormat(\"en-CA\", { timeZone }).\n */\nfunction extractFactOnlyContext(\n  rawEvent: { kind: string; payload: unknown },\n): { dayKey: YmdDateString; factOnlyBody: DailyBodyFacts } | null {\n  if (!isFactOnlyKind(rawEvent.kind)) return null;\n\n  if (rawEvent.kind === \"weight\") {\n    const p = rawEvent.payload as Record<string, unknown> | undefined;\n    if (!p || typeof p[\"time\"] !== \"string\" || typeof p[\"timezone\"] !== \"string\") return null;\n    const weightKg = p[\"weightKg\"];\n    if (typeof weightKg !== \"number\" || !Number.isFinite(weightKg) || weightKg <= 0) return null;\n\n    try {\n      const d = new Date(p[\"time\"] as string);\n      if (Number.isNaN(d.getTime())) return null;\n      const fmt = new Intl.DateTimeFormat(\"en-CA\", { timeZone: p[\"timezone\"] as string });\n      const dayKey = fmt.format(d) as YmdDateString;\n\n      const bodyFatPercent = p[\"bodyFatPercent\"];\n      const factOnlyBody: DailyBodyFacts = {\n        weightKg,\n        ...(typeof bodyFatPercent === \"number\" &&\n        Number.isFinite(bodyFatPercent) &&\n        bodyFatPercent >= 0 &&\n        bodyFatPercent <= 100\n          ? { bodyFatPercent }\n          : {}),\n      };\n\n      return { dayKey, factOnlyBody };\n    } catch {\n      return null;\n    }\n  }\n\n  return null;\n}\n\n/** Bounded zod issue summary (no raw payload dumps) */\nfunction boundedZodSummary(issues: unknown): Record<string, unknown> {\n  if (!issues || typeof issues !== \"object\") return { _: \"unknown\" };\n  const obj = issues as Record<string, unknown>;\n  const out: Record<string, unknown> = {};\n  if (Array.isArray(obj[\"formErrors\"])) out.formErrors = obj.formErrors;\n  if (obj[\"fieldErrors\"] && typeof obj.fieldErrors === \"object\") {\n    const fe = obj.fieldErrors as Record<string, unknown>;\n    out.fieldErrors = Object.keys(fe)\n      .slice(0, 10)\n      .reduce((acc, k) => {\n        acc[k] = fe[k];\n        return acc;\n      }, {} as Record<string, unknown>);\n  }\n  return Object.keys(out).length > 0 ? out : { _: \"validation_failed\" };\n}\n\n/**\n * Firestore trigger:\n *   Input:  /users/{userId}/rawEvents/{rawEventId}\n *   Output: /users/{userId}/events/{canonicalEventId}\n *\n * Behavior:\n * - Validates RawEvent envelope strictly (fail fast).\n * - Records replay/duplicate evidence (no silent duplication).\n * - Maps RawEvent \u2192 CanonicalEvent via pure mapper.\n * - Writes canonical truth immutably (create-only OR identical-on-replay).\n * - Logs failures (no silent drops).\n * - Avoids logging any user PII.\n *\n * Phase 1 / Step 1 invariant:\n * - Canonical `day` must be derived deterministically from the authoritative time anchor\n *   and timezone, using Intl.DateTimeFormat(\"en-CA\", { timeZone }).\n *   (Enforced inside mapRawEventToCanonical; this trigger preserves that authority.)\n */\nexport const onRawEventCreated = onDocumentCreated(\n  {\n    document: \"users/{userId}/rawEvents/{rawEventId}\",\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  },\n  async (event) => {\n    const snapshot = event.data;\n    if (!snapshot) return;\n\n    const parsed = parseRawEvent(snapshot.data());\n    if (!parsed.ok) {\n      logger.warn(\"Invalid RawEvent envelope (dropping)\", {\n        path: snapshot.ref.path,\n        reason: parsed.reason,\n      });\n      const rawData = snapshot.data() as Record<string, unknown> | undefined;\n      const day = deriveDayFromRaw(rawData) ?? toYmdUtc(new Date());\n      try {\n        await writeFailureImmutable(\n          {},\n          {\n            userId: event.params.userId,\n            source: \"normalization\",\n            stage: \"rawEvent.validate\",\n            reasonCode: \"RAW_EVENT_INVALID\",\n            message: \"RawEvent failed contract validation\",\n            day,\n            rawEventId: event.params.rawEventId,\n            details: boundedZodSummary(parsed.issues),\n          },\n        );\n      } catch (err) {\n        logger.error(\"Failed to write failure record\", {\n          path: snapshot.ref.path,\n          error: err instanceof Error ? err.message : String(err),\n        });\n      }\n      return;\n    }\n\n    const rawEvent = parsed.value;\n    const rawData = snapshot.data() as Record<string, unknown>;\n    const payload = rawEvent.payload as Record<string, unknown> | undefined;\n\n    // [INSTRUMENTATION] Sprint 0 prod debug \u2014 remove after root cause fixed\n    logger.info(\"ON_RAW_EVENT_CREATED\", {\n      msg: \"ON_RAW_EVENT_CREATED\",\n      userId: rawEvent.userId,\n      rawEventId: rawEvent.id,\n      kind: rawEvent.kind,\n      observedAt: rawEvent.observedAt,\n      timeZone: rawData[\"timeZone\"] ?? payload?.[\"timezone\"] ?? \"(missing)\",\n      dayKey: payload?.[\"day\"] ?? rawData[\"dayKey\"] ?? \"(derived)\",\n    });\n\n    // Optional extra guard: ensure doc path user matches payload userId\n    const pathUserId = event.params.userId;\n    if (rawEvent.userId !== pathUserId) {\n      logger.warn(\"RawEvent userId mismatch (dropping)\", {\n        path: snapshot.ref.path,\n        pathUserId,\n        rawUserId: rawEvent.userId,\n      });\n      return;\n    }\n\n    // Step 2: record duplicate/replay evidence (does not alter ingestion behavior).\n    // Validate contract-first inside the dedupe helper by passing the raw snapshot data.\n    try {\n      const dedupe = await upsertRawEventDedupeEvidence({\n        userId: rawEvent.userId,\n        rawEvent: snapshot.data(),\n      });\n\n      if (!dedupe.ok) {\n        logger.warn(\"RawEvent dedupe evidence skipped due to invalid contract\", {\n          path: snapshot.ref.path,\n          userId: rawEvent.userId,\n        });\n      }\n    } catch (err) {\n      // Never throw: ingestion must remain stable and retries would create noise.\n      logger.error(\"Failed to write RawEvent dedupe evidence\", {\n        userId: rawEvent.userId,\n        rawEventId: rawEvent.id,\n        provider: rawEvent.provider,\n        kind: rawEvent.kind,\n        error: err instanceof Error ? err.message : String(err),\n      });\n    }\n\n    // Pure deterministic normalization\n    const result = mapRawEventToCanonical(rawEvent);\n\n    if (!result.ok) {\n      const details = result.details as Record<string, unknown> | undefined;\n      const isFactOnly = details?.factOnly === true;\n\n      if (isFactOnly) {\n        // Fact-only: trigger derived truth recompute (no canonical event).\n        const ctx = extractFactOnlyContext(rawEvent);\n        logger.info(\"FACT_ONLY_BRANCH_ENTERED\", {\n          msg: \"FACT_ONLY_BRANCH_ENTERED\",\n          kind: rawEvent.kind,\n          rawEventId: rawEvent.id,\n          ctxDayKey: ctx?.dayKey ?? \"(extract failed)\",\n          factOnlyBodyWeightKg: ctx?.factOnlyBody?.weightKg,\n        });\n        if (!ctx) {\n          logger.warn(\"Fact-only rawEvent missing/invalid payload (writing failure)\", {\n            userId: rawEvent.userId,\n            rawEventId: rawEvent.id,\n            kind: rawEvent.kind,\n          });\n          const day =\n            deriveDayFromRaw(snapshot.data() as Record<string, unknown>) ?? toYmdUtc(new Date());\n          try {\n            await writeFailureImmutable(\n              {},\n              {\n                userId: rawEvent.userId,\n                source: \"normalization\",\n                stage: \"factOnly.extract\",\n                reasonCode: \"FACT_ONLY_INVALID_PAYLOAD\",\n                message: \"Fact-only rawEvent payload missing or invalid (time, timezone, weightKg)\",\n                day,\n                rawEventId: rawEvent.id,\n                details: { kind: rawEvent.kind },\n              },\n            );\n          } catch (err) {\n            logger.error(\"Failed to write failure record (factOnly.extract)\", {\n              userId: rawEvent.userId,\n              rawEventId: rawEvent.id,\n              error: err instanceof Error ? err.message : String(err),\n            });\n          }\n          return;\n        }\n\n        try {\n          logger.info(\"FACT_ONLY_RECOMPUTE_START\", {\n            msg: \"FACT_ONLY_RECOMPUTE_START\",\n            userId: rawEvent.userId,\n            dayKey: ctx.dayKey,\n            trigger: \"onRawEventCreated_factOnly\",\n          });\n          await recomputeDerivedTruthForDay({\n            db,\n            userId: rawEvent.userId,\n            dayKey: ctx.dayKey,\n            factOnlyBody: ctx.factOnlyBody,\n            trigger: { type: \"factOnly\", rawEventId: rawEvent.id },\n          });\n          logger.info(\"FACT_ONLY_RECOMPUTE_DONE\", {\n            msg: \"FACT_ONLY_RECOMPUTE_DONE\",\n            userId: rawEvent.userId,\n            dayKey: ctx.dayKey,\n          });\n        } catch (err) {\n          logger.error(\"FACT_ONLY_RECOMPUTE_ERROR\", {\n            msg: \"FACT_ONLY_RECOMPUTE_ERROR\",\n            userId: rawEvent.userId,\n            rawEventId: rawEvent.id,\n            kind: rawEvent.kind,\n            dayKey: ctx.dayKey,\n            error: err instanceof Error ? err.message : String(err),\n            stack: err instanceof Error ? err.stack : undefined,\n          });\n          try {\n            await writeFailureImmutable(\n              {},\n              {\n                userId: rawEvent.userId,\n                source: \"normalization\",\n                stage: \"factOnly.recompute\",\n                reasonCode: \"FACT_ONLY_RECOMPUTE_FAILED\",\n                message: \"Derived truth recompute failed for fact-only rawEvent\",\n                day: ctx.dayKey,\n                rawEventId: rawEvent.id,\n                details: { kind: rawEvent.kind, error: err instanceof Error ? err.message : String(err) },\n              },\n            );\n          } catch (writeErr) {\n            logger.error(\"Failed to write failure record (factOnly.recompute)\", {\n              userId: rawEvent.userId,\n              rawEventId: rawEvent.id,\n              error: writeErr instanceof Error ? writeErr.message : String(writeErr),\n            });\n          }\n        }\n        return;\n      }\n\n      // Non-fact-only: write failure\n      logger.warn(\"Normalization failed\", {\n        userId: rawEvent.userId,\n        rawEventId: rawEvent.id,\n        provider: rawEvent.provider,\n        kind: rawEvent.kind,\n        reason: result.reason,\n        ...(details ? { details } : {}),\n      });\n      const day = deriveDayFromRaw(snapshot.data() as Record<string, unknown>) ?? toYmdUtc(new Date());\n      const reasonCode =\n        result.reason === \"UNSUPPORTED_KIND\" ? \"RAW_KIND_UNSUPPORTED\" : \"NORMALIZE_ERROR\";\n      try {\n        await writeFailureImmutable(\n          {},\n          {\n            userId: rawEvent.userId,\n            source: \"normalization\",\n            stage: \"normalize.map\",\n            reasonCode,\n            message: `Normalization failed: ${result.reason}`,\n            day,\n            rawEventId: rawEvent.id,\n            ...(details ? { details } : {}),\n          },\n        );\n      } catch (err) {\n        logger.error(\"Failed to write failure record (normalize.map)\", {\n          userId: rawEvent.userId,\n          rawEventId: rawEvent.id,\n          error: err instanceof Error ? err.message : String(err),\n        });\n      }\n      return;\n    }\n\n    const canonical = result.canonical;\n\n    const writeRes = await writeCanonicalEventImmutable({\n      userId: rawEvent.userId,\n      canonical,\n      sourceRawEventId: rawEvent.id,\n      sourceRawEventPath: snapshot.ref.path,\n    });\n\n    if (!writeRes.ok) {\n      // Important: do not throw (would cause retries and noise).\n      // This is a real integrity violation that must be investigated.\n      logger.error(\"Canonical write conflict: immutability prevented overwrite\", {\n        userId: rawEvent.userId,\n        canonicalId: canonical.id,\n        existingHash: writeRes.existingHash,\n        incomingHash: writeRes.incomingHash,\n        integrityViolationPath: writeRes.integrityViolationPath,\n      });\n      try {\n        await writeFailureImmutable(\n          {},\n          {\n            userId: rawEvent.userId,\n            source: \"normalization\",\n            stage: \"canonical.write\",\n            reasonCode: \"CANONICAL_IMMUTABILITY_CONFLICT\",\n            message: \"Canonical immutability conflict: attempted overwrite with different content\",\n            day: canonical.day,\n            rawEventId: rawEvent.id,\n            canonicalEventId: canonical.id,\n            details: {\n              existingHash: writeRes.existingHash,\n              incomingHash: writeRes.incomingHash,\n            },\n          },\n        );\n      } catch (err) {\n        logger.error(\"Failed to write failure record (canonical.write)\", {\n          userId: rawEvent.userId,\n          canonicalId: canonical.id,\n          error: err instanceof Error ? err.message : String(err),\n        });\n      }\n    }\n  },\n);\n", "// services/functions/src/normalization/mapRawEventToCanonical.ts\nimport type {\n  CanonicalEvent,\n  RawEvent,\n  IsoDateTimeString,\n  YmdDateString,\n  SleepCanonicalEvent,\n  StepsCanonicalEvent,\n  WorkoutCanonicalEvent,\n  HrvCanonicalEvent,\n  StrengthWorkoutCanonicalEvent,\n  StrengthWorkoutCanonicalSet,\n} from \"../types/health\";\n\n/**\n * RawEvent \u2192 CanonicalEvent mapper.\n *\n * Properties:\n * - Pure: no Firestore/Admin calls, no I/O.\n * - Deterministic: same RawEvent \u2192 same CanonicalEvent.\n * - Safe to reuse in the Reprocessing Engine.\n *\n * IMPORTANT:\n * - `day` is derived server-side from (time/start, timezone).\n * - Do NOT trust any client-provided `day`.\n *\n * Phase 1 note:\n * - Some RawEvent kinds are \"memory-only\" and intentionally do NOT emit CanonicalEvents\n *   (e.g., upload.file with no parsing). Those return UNSUPPORTED_KIND with a marker\n *   so callers can treat them as a valid no-op.\n */\n\n/**\n * RawEvent kinds that are fact-only: they update derived truth (dailyFacts, intelligenceContext)\n * but do NOT emit canonical events. Constitutional: canonical = \"what happened\"; weight is a\n * measurement fact, not an event.\n */\nexport const FACT_ONLY_RAW_EVENT_KINDS = [\"weight\"] as const;\n\nexport type FactOnlyRawEventKind = (typeof FACT_ONLY_RAW_EVENT_KINDS)[number];\n\nexport const isFactOnlyKind = (kind: string): kind is FactOnlyRawEventKind =>\n  (FACT_ONLY_RAW_EVENT_KINDS as readonly string[]).includes(kind);\n\nexport type MappingFailureReason =\n  | \"UNSUPPORTED_PROVIDER\"\n  | \"UNSUPPORTED_KIND\"\n  | \"MALFORMED_PAYLOAD\";\n\nexport type MappingFailure = {\n  ok: false;\n  reason: MappingFailureReason;\n  details?: Record<string, unknown>;\n};\n\nexport type MappingSuccess = {\n  ok: true;\n  canonical: CanonicalEvent;\n};\n\nexport type MappingResult = MappingSuccess | MappingFailure;\n\n// -----------------------------------------------------------------------------\n// Canonical dayKey derivation (AUTHORITATIVE)\n// -----------------------------------------------------------------------------\n\n/**\n * Canonical dayKey derivation using IANA timezone.\n *\n * Algorithm must match the ingestion acknowledgement semantics:\n *   Intl.DateTimeFormat(\"en-CA\", { timeZone }).format(new Date(iso))\n *\n * Returns null if:\n * - ISO timestamp is invalid, OR\n * - timeZone is invalid (fail closed; no UTC fallback here)\n */\nconst ymdInTimeZoneFromIso = (\n  iso: string,\n  timeZone: string,\n): YmdDateString | null => {\n  const d = new Date(iso);\n  if (Number.isNaN(d.getTime())) return null;\n\n  try {\n    const fmt = new Intl.DateTimeFormat(\"en-CA\", { timeZone });\n    return fmt.format(d) as YmdDateString;\n  } catch {\n    return null;\n  }\n};\n\n// -----------------------------------------------------------------------------\n// Manual payload shapes & guards\n// -----------------------------------------------------------------------------\n\ntype ManualWindowBase = {\n  start: IsoDateTimeString;\n  end: IsoDateTimeString;\n  timezone: string;\n};\n\ntype ManualSleepPayload = ManualWindowBase & {\n  totalMinutes: number;\n  efficiency?: number | null;\n  latencyMinutes?: number | null;\n  awakenings?: number | null;\n  isMainSleep: boolean;\n};\n\ntype ManualStepsPayload = ManualWindowBase & {\n  steps: number;\n  distanceKm?: number | null;\n  moveMinutes?: number | null;\n};\n\ntype ManualWorkoutPayload = ManualWindowBase & {\n  sport: string;\n  intensity?: \"easy\" | \"moderate\" | \"hard\";\n  durationMinutes: number;\n  trainingLoad?: number | null;\n};\n\ntype ManualWeightPayload = {\n  time: IsoDateTimeString;\n  timezone: string;\n  weightKg: number;\n  bodyFatPercent?: number | null;\n};\n\ntype ManualHrvPayload = {\n  time: IsoDateTimeString;\n  timezone: string;\n  rmssdMs?: number | null;\n  sdnnMs?: number | null;\n  measurementType?: \"nightly\" | \"spot\";\n};\n\ntype ManualStrengthWorkoutSetPayload = {\n  reps: number;\n  load: number;\n  unit: \"lb\" | \"kg\";\n  isWarmup?: boolean;\n  rpe?: number;\n  rir?: number;\n  notes?: string;\n};\n\ntype ManualStrengthWorkoutExercisePayload = {\n  name: string;\n  sets: ManualStrengthWorkoutSetPayload[];\n};\n\ntype ManualStrengthWorkoutPayload = {\n  startedAt: IsoDateTimeString;\n  timeZone: string;\n  exercises: ManualStrengthWorkoutExercisePayload[];\n};\n\ntype ManualPayloadByKind = {\n  sleep: ManualSleepPayload;\n  steps: ManualStepsPayload;\n  workout: ManualWorkoutPayload;\n  weight: ManualWeightPayload;\n  hrv: ManualHrvPayload;\n  strength_workout: ManualStrengthWorkoutPayload;\n};\n\ntype ManualKind = keyof ManualPayloadByKind;\n\nconst MANUAL_KINDS: readonly ManualKind[] = [\n  \"sleep\",\n  \"steps\",\n  \"workout\",\n  \"weight\",\n  \"hrv\",\n  \"strength_workout\",\n] as const;\n\nconst isManualKind = (kind: RawEvent[\"kind\"]): kind is ManualKind =>\n  (MANUAL_KINDS as readonly string[]).includes(kind);\n\nconst isRecord = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null;\n\nconst hasString = (obj: Record<string, unknown>, key: string): boolean =>\n  typeof obj[key] === \"string\";\n\nconst hasNumber = (obj: Record<string, unknown>, key: string): boolean =>\n  typeof obj[key] === \"number\";\n\nconst isManualWindowBase = (value: unknown): value is ManualWindowBase => {\n  if (!isRecord(value)) return false;\n  return hasString(value, \"start\") && hasString(value, \"end\") && hasString(value, \"timezone\");\n};\n\nconst isManualSleepPayload = (value: unknown): value is ManualSleepPayload => {\n  if (!isRecord(value)) return false;\n  if (!isManualWindowBase(value)) return false;\n  if (!hasNumber(value, \"totalMinutes\")) return false;\n  return typeof (value as Record<string, unknown>)[\"isMainSleep\"] === \"boolean\";\n};\n\nconst isManualStepsPayload = (value: unknown): value is ManualStepsPayload => {\n  if (!isRecord(value)) return false;\n  if (!isManualWindowBase(value)) return false;\n  return hasNumber(value, \"steps\");\n};\n\nconst isManualWorkoutPayload = (value: unknown): value is ManualWorkoutPayload => {\n  if (!isRecord(value)) return false;\n  if (!isManualWindowBase(value)) return false;\n  return hasString(value, \"sport\") && hasNumber(value, \"durationMinutes\");\n};\n\nconst isManualWeightPayload = (value: unknown): value is ManualWeightPayload => {\n  if (!isRecord(value)) return false;\n  return hasString(value, \"time\") && hasString(value, \"timezone\") && hasNumber(value, \"weightKg\");\n};\n\nconst isManualHrvPayload = (value: unknown): value is ManualHrvPayload => {\n  if (!isRecord(value)) return false;\n  return hasString(value, \"time\") && hasString(value, \"timezone\");\n};\n\nconst isManualStrengthWorkoutPayload = (\n  value: unknown,\n): value is ManualStrengthWorkoutPayload => {\n  if (!isRecord(value)) return false;\n  if (!hasString(value, \"startedAt\") || !hasString(value, \"timeZone\")) return false;\n  const exs = value.exercises;\n  if (!Array.isArray(exs) || exs.length === 0) return false;\n  for (const ex of exs) {\n    if (!isRecord(ex) || !hasString(ex, \"name\")) return false;\n    const sets = ex.sets;\n    if (!Array.isArray(sets) || sets.length === 0) return false;\n    for (const s of sets) {\n      if (!isRecord(s)) return false;\n      if (\n        typeof s.reps !== \"number\" ||\n        s.reps < 0 ||\n        !Number.isInteger(s.reps)\n      )\n        return false;\n      if (typeof s.load !== \"number\" || s.load < 0) return false;\n      if (s.unit !== \"lb\" && s.unit !== \"kg\") return false;\n      if (s.rpe !== undefined && s.rir !== undefined) return false;\n      if (s.rpe !== undefined && (typeof s.rpe !== \"number\" || s.rpe < 0 || s.rpe > 10))\n        return false;\n      if (s.rir !== undefined && (typeof s.rir !== \"number\" || s.rir < 0 || s.rir > 10))\n        return false;\n      if (s.notes !== undefined && (typeof s.notes !== \"string\" || s.notes.length > 256))\n        return false;\n    }\n  }\n  return true;\n};\n\n/**\n * Parse manual payload based on kind.\n * Constrains K to keyof ManualPayloadByKind to allow indexed access.\n */\nconst parseManualPayload = <K extends ManualKind>(\n  kind: K,\n  payload: unknown,\n): ManualPayloadByKind[K] | null => {\n  switch (kind) {\n    case \"sleep\":\n      return isManualSleepPayload(payload) ? (payload as ManualPayloadByKind[K]) : null;\n    case \"steps\":\n      return isManualStepsPayload(payload) ? (payload as ManualPayloadByKind[K]) : null;\n    case \"workout\":\n      return isManualWorkoutPayload(payload) ? (payload as ManualPayloadByKind[K]) : null;\n    case \"weight\":\n      return isManualWeightPayload(payload) ? (payload as ManualPayloadByKind[K]) : null;\n    case \"hrv\":\n      return isManualHrvPayload(payload) ? (payload as ManualPayloadByKind[K]) : null;\n    case \"strength_workout\":\n      return isManualStrengthWorkoutPayload(payload)\n        ? (payload as ManualPayloadByKind[K])\n        : null;\n    default: {\n      const _exhaustive: never = kind;\n      return _exhaustive;\n    }\n  }\n};\n\n// -----------------------------------------------------------------------------\n// Manual mappers (provider === \"manual\")\n// -----------------------------------------------------------------------------\n\nconst mapManualSleep = (\n  raw: RawEvent,\n  payload: ManualSleepPayload,\n): SleepCanonicalEvent | null => {\n  const day = ymdInTimeZoneFromIso(payload.start, payload.timezone);\n  if (!day) return null;\n\n  return {\n    id: raw.id,\n    userId: raw.userId,\n    sourceId: raw.sourceId,\n    kind: \"sleep\",\n    start: payload.start,\n    end: payload.end,\n    day,\n    timezone: payload.timezone,\n    createdAt: raw.receivedAt,\n    updatedAt: raw.receivedAt,\n    schemaVersion: 1,\n    totalMinutes: payload.totalMinutes,\n    efficiency: payload.efficiency ?? null,\n    latencyMinutes: payload.latencyMinutes ?? null,\n    awakenings: payload.awakenings ?? null,\n    isMainSleep: payload.isMainSleep,\n  };\n};\n\nconst mapManualSteps = (\n  raw: RawEvent,\n  payload: ManualStepsPayload,\n): StepsCanonicalEvent | null => {\n  const day = ymdInTimeZoneFromIso(payload.start, payload.timezone);\n  if (!day) return null;\n\n  return {\n    id: raw.id,\n    userId: raw.userId,\n    sourceId: raw.sourceId,\n    kind: \"steps\",\n    start: payload.start,\n    end: payload.end,\n    day,\n    timezone: payload.timezone,\n    createdAt: raw.receivedAt,\n    updatedAt: raw.receivedAt,\n    schemaVersion: 1,\n    steps: payload.steps,\n    distanceKm: payload.distanceKm ?? null,\n    moveMinutes: payload.moveMinutes ?? null,\n  };\n};\n\nconst mapManualWorkout = (\n  raw: RawEvent,\n  payload: ManualWorkoutPayload,\n): WorkoutCanonicalEvent | null => {\n  const day = ymdInTimeZoneFromIso(payload.start, payload.timezone);\n  if (!day) return null;\n\n  const base: WorkoutCanonicalEvent = {\n    id: raw.id,\n    userId: raw.userId,\n    sourceId: raw.sourceId,\n    kind: \"workout\",\n    start: payload.start,\n    end: payload.end,\n    day,\n    timezone: payload.timezone,\n    createdAt: raw.receivedAt,\n    updatedAt: raw.receivedAt,\n    schemaVersion: 1,\n    sport: payload.sport,\n    durationMinutes: payload.durationMinutes,\n    trainingLoad: payload.trainingLoad ?? null,\n  };\n\n  if (payload.intensity) {\n    base.intensity = payload.intensity;\n  }\n\n  return base;\n};\n\nconst mapManualHrv = (\n  raw: RawEvent,\n  payload: ManualHrvPayload,\n): HrvCanonicalEvent | null => {\n  const day = ymdInTimeZoneFromIso(payload.time, payload.timezone);\n  if (!day) return null;\n\n  const base: HrvCanonicalEvent = {\n    id: raw.id,\n    userId: raw.userId,\n    sourceId: raw.sourceId,\n    kind: \"hrv\",\n    start: payload.time,\n    end: payload.time,\n    day,\n    timezone: payload.timezone,\n    createdAt: raw.receivedAt,\n    updatedAt: raw.receivedAt,\n    schemaVersion: 1,\n    rmssdMs: payload.rmssdMs ?? null,\n    sdnnMs: payload.sdnnMs ?? null,\n  };\n\n  if (payload.measurementType) {\n    base.measurementType = payload.measurementType;\n  }\n\n  return base;\n};\n\nconst mapManualStrengthWorkout = (\n  raw: RawEvent,\n  payload: ManualStrengthWorkoutPayload,\n): StrengthWorkoutCanonicalEvent | null => {\n  const day = ymdInTimeZoneFromIso(payload.startedAt, payload.timeZone);\n  if (!day) return null;\n\n  const exercises: StrengthWorkoutCanonicalSet[] = [];\n  for (const ex of payload.exercises) {\n    for (const s of ex.sets) {\n      const set: StrengthWorkoutCanonicalSet = {\n        exercise: ex.name,\n        reps: s.reps,\n        load: s.load,\n        unit: s.unit,\n      };\n      if (s.isWarmup !== undefined) set.isWarmup = s.isWarmup;\n      if (s.rpe !== undefined) set.rpe = s.rpe;\n      else if (s.rir !== undefined) set.rir = s.rir;\n      if (s.notes !== undefined) set.notes = s.notes;\n      exercises.push(set);\n    }\n  }\n\n  return {\n    id: raw.id,\n    userId: raw.userId,\n    sourceId: raw.sourceId,\n    kind: \"strength_workout\",\n    start: payload.startedAt,\n    end: payload.startedAt,\n    day,\n    timezone: payload.timeZone,\n    createdAt: raw.receivedAt,\n    updatedAt: raw.receivedAt,\n    schemaVersion: 1,\n    exercises,\n  };\n};\n\n// -----------------------------------------------------------------------------\n// Entry point\n// -----------------------------------------------------------------------------\n\nexport const mapRawEventToCanonical = (raw: RawEvent): MappingResult => {\n  /**\n   * Phase 1: memory-only uploads.\n   * Upload events are intentionally NOT normalizable into canonical health facts.\n   * They are still valid RawEvents and should be treated as a valid no-op by callers.\n   */\n  if (raw.kind === \"upload.file\") {\n    return {\n      ok: false,\n      reason: \"UNSUPPORTED_KIND\",\n      details: { kind: raw.kind, rawEventId: raw.id, memoryOnly: true },\n    };\n  }\n\n  /**\n   * Phase 2: memory-only incomplete events.\n   * \"Something happened, details later\" \u2014 no canonical normalization.\n   */\n  if (raw.kind === \"incomplete\") {\n    return {\n      ok: false,\n      reason: \"UNSUPPORTED_KIND\",\n      details: { kind: raw.kind, rawEventId: raw.id, memoryOnly: true },\n    };\n  }\n\n  if (raw.provider !== \"manual\") {\n    return {\n      ok: false,\n      reason: \"UNSUPPORTED_PROVIDER\",\n      details: { provider: raw.provider, kind: raw.kind, rawEventId: raw.id },\n    };\n  }\n\n  if (!isManualKind(raw.kind)) {\n    return {\n      ok: false,\n      reason: \"UNSUPPORTED_KIND\",\n      details: { provider: raw.provider, kind: raw.kind, rawEventId: raw.id },\n    };\n  }\n\n  switch (raw.kind) {\n    case \"sleep\": {\n      const payload = parseManualPayload(\"sleep\", raw.payload);\n      if (!payload) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id },\n        };\n      }\n      const canonical = mapManualSleep(raw, payload);\n      if (!canonical) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id, field: \"start\", reason: \"INVALID_TIME_OR_TIMEZONE\" },\n        };\n      }\n      return { ok: true, canonical };\n    }\n\n    case \"steps\": {\n      const payload = parseManualPayload(\"steps\", raw.payload);\n      if (!payload) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id },\n        };\n      }\n      const canonical = mapManualSteps(raw, payload);\n      if (!canonical) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id, field: \"start\", reason: \"INVALID_TIME_OR_TIMEZONE\" },\n        };\n      }\n      return { ok: true, canonical };\n    }\n\n    case \"workout\": {\n      const payload = parseManualPayload(\"workout\", raw.payload);\n      if (!payload) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id },\n        };\n      }\n      const canonical = mapManualWorkout(raw, payload);\n      if (!canonical) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id, field: \"start\", reason: \"INVALID_TIME_OR_TIMEZONE\" },\n        };\n      }\n      return { ok: true, canonical };\n    }\n\n    case \"weight\":\n      // Fact-only: handled by early return; this case satisfies exhaustive switch\n      return {\n        ok: false,\n        reason: \"UNSUPPORTED_KIND\",\n        details: { kind: raw.kind, rawEventId: raw.id, factOnly: true },\n      };\n\n    case \"hrv\": {\n      const payload = parseManualPayload(\"hrv\", raw.payload);\n      if (!payload) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id },\n        };\n      }\n      const canonical = mapManualHrv(raw, payload);\n      if (!canonical) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id, field: \"time\", reason: \"INVALID_TIME_OR_TIMEZONE\" },\n        };\n      }\n      return { ok: true, canonical };\n    }\n\n    case \"strength_workout\": {\n      const payload = parseManualPayload(\"strength_workout\", raw.payload);\n      if (!payload) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: { rawEventId: raw.id },\n        };\n      }\n      const canonical = mapManualStrengthWorkout(raw, payload);\n      if (!canonical) {\n        return {\n          ok: false,\n          reason: \"MALFORMED_PAYLOAD\",\n          details: {\n            rawEventId: raw.id,\n            field: \"startedAt\",\n            reason: \"INVALID_TIME_OR_TIMEZONE\",\n          },\n        };\n      }\n      return { ok: true, canonical };\n    }\n\n    default: {\n      const _exhaustive: never = raw.kind;\n      return _exhaustive;\n    }\n  }\n};", "export * from \"./errors.js\";\nexport * from \"./helpers/parseUtil.js\";\nexport * from \"./helpers/typeAliases.js\";\nexport * from \"./helpers/util.js\";\nexport * from \"./types.js\";\nexport * from \"./ZodError.js\";\n", "export var util;\n(function (util) {\n    util.assertEqual = (_) => { };\n    function assertIs(_arg) { }\n    util.assertIs = assertIs;\n    function assertNever(_x) {\n        throw new Error();\n    }\n    util.assertNever = assertNever;\n    util.arrayToEnum = (items) => {\n        const obj = {};\n        for (const item of items) {\n            obj[item] = item;\n        }\n        return obj;\n    };\n    util.getValidEnumValues = (obj) => {\n        const validKeys = util.objectKeys(obj).filter((k) => typeof obj[obj[k]] !== \"number\");\n        const filtered = {};\n        for (const k of validKeys) {\n            filtered[k] = obj[k];\n        }\n        return util.objectValues(filtered);\n    };\n    util.objectValues = (obj) => {\n        return util.objectKeys(obj).map(function (e) {\n            return obj[e];\n        });\n    };\n    util.objectKeys = typeof Object.keys === \"function\" // eslint-disable-line ban/ban\n        ? (obj) => Object.keys(obj) // eslint-disable-line ban/ban\n        : (object) => {\n            const keys = [];\n            for (const key in object) {\n                if (Object.prototype.hasOwnProperty.call(object, key)) {\n                    keys.push(key);\n                }\n            }\n            return keys;\n        };\n    util.find = (arr, checker) => {\n        for (const item of arr) {\n            if (checker(item))\n                return item;\n        }\n        return undefined;\n    };\n    util.isInteger = typeof Number.isInteger === \"function\"\n        ? (val) => Number.isInteger(val) // eslint-disable-line ban/ban\n        : (val) => typeof val === \"number\" && Number.isFinite(val) && Math.floor(val) === val;\n    function joinValues(array, separator = \" | \") {\n        return array.map((val) => (typeof val === \"string\" ? `'${val}'` : val)).join(separator);\n    }\n    util.joinValues = joinValues;\n    util.jsonStringifyReplacer = (_, value) => {\n        if (typeof value === \"bigint\") {\n            return value.toString();\n        }\n        return value;\n    };\n})(util || (util = {}));\nexport var objectUtil;\n(function (objectUtil) {\n    objectUtil.mergeShapes = (first, second) => {\n        return {\n            ...first,\n            ...second, // second overwrites first\n        };\n    };\n})(objectUtil || (objectUtil = {}));\nexport const ZodParsedType = util.arrayToEnum([\n    \"string\",\n    \"nan\",\n    \"number\",\n    \"integer\",\n    \"float\",\n    \"boolean\",\n    \"date\",\n    \"bigint\",\n    \"symbol\",\n    \"function\",\n    \"undefined\",\n    \"null\",\n    \"array\",\n    \"object\",\n    \"unknown\",\n    \"promise\",\n    \"void\",\n    \"never\",\n    \"map\",\n    \"set\",\n]);\nexport const getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return ZodParsedType.undefined;\n        case \"string\":\n            return ZodParsedType.string;\n        case \"number\":\n            return Number.isNaN(data) ? ZodParsedType.nan : ZodParsedType.number;\n        case \"boolean\":\n            return ZodParsedType.boolean;\n        case \"function\":\n            return ZodParsedType.function;\n        case \"bigint\":\n            return ZodParsedType.bigint;\n        case \"symbol\":\n            return ZodParsedType.symbol;\n        case \"object\":\n            if (Array.isArray(data)) {\n                return ZodParsedType.array;\n            }\n            if (data === null) {\n                return ZodParsedType.null;\n            }\n            if (data.then && typeof data.then === \"function\" && data.catch && typeof data.catch === \"function\") {\n                return ZodParsedType.promise;\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return ZodParsedType.map;\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return ZodParsedType.set;\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return ZodParsedType.date;\n            }\n            return ZodParsedType.object;\n        default:\n            return ZodParsedType.unknown;\n    }\n};\n", "import { util } from \"./helpers/util.js\";\nexport const ZodIssueCode = util.arrayToEnum([\n    \"invalid_type\",\n    \"invalid_literal\",\n    \"custom\",\n    \"invalid_union\",\n    \"invalid_union_discriminator\",\n    \"invalid_enum_value\",\n    \"unrecognized_keys\",\n    \"invalid_arguments\",\n    \"invalid_return_type\",\n    \"invalid_date\",\n    \"invalid_string\",\n    \"too_small\",\n    \"too_big\",\n    \"invalid_intersection_types\",\n    \"not_multiple_of\",\n    \"not_finite\",\n]);\nexport const quotelessJson = (obj) => {\n    const json = JSON.stringify(obj, null, 2);\n    return json.replace(/\"([^\"]+)\":/g, \"$1:\");\n};\nexport class ZodError extends Error {\n    get errors() {\n        return this.issues;\n    }\n    constructor(issues) {\n        super();\n        this.issues = [];\n        this.addIssue = (sub) => {\n            this.issues = [...this.issues, sub];\n        };\n        this.addIssues = (subs = []) => {\n            this.issues = [...this.issues, ...subs];\n        };\n        const actualProto = new.target.prototype;\n        if (Object.setPrototypeOf) {\n            // eslint-disable-next-line ban/ban\n            Object.setPrototypeOf(this, actualProto);\n        }\n        else {\n            this.__proto__ = actualProto;\n        }\n        this.name = \"ZodError\";\n        this.issues = issues;\n    }\n    format(_mapper) {\n        const mapper = _mapper ||\n            function (issue) {\n                return issue.message;\n            };\n        const fieldErrors = { _errors: [] };\n        const processError = (error) => {\n            for (const issue of error.issues) {\n                if (issue.code === \"invalid_union\") {\n                    issue.unionErrors.map(processError);\n                }\n                else if (issue.code === \"invalid_return_type\") {\n                    processError(issue.returnTypeError);\n                }\n                else if (issue.code === \"invalid_arguments\") {\n                    processError(issue.argumentsError);\n                }\n                else if (issue.path.length === 0) {\n                    fieldErrors._errors.push(mapper(issue));\n                }\n                else {\n                    let curr = fieldErrors;\n                    let i = 0;\n                    while (i < issue.path.length) {\n                        const el = issue.path[i];\n                        const terminal = i === issue.path.length - 1;\n                        if (!terminal) {\n                            curr[el] = curr[el] || { _errors: [] };\n                            // if (typeof el === \"string\") {\n                            //   curr[el] = curr[el] || { _errors: [] };\n                            // } else if (typeof el === \"number\") {\n                            //   const errorArray: any = [];\n                            //   errorArray._errors = [];\n                            //   curr[el] = curr[el] || errorArray;\n                            // }\n                        }\n                        else {\n                            curr[el] = curr[el] || { _errors: [] };\n                            curr[el]._errors.push(mapper(issue));\n                        }\n                        curr = curr[el];\n                        i++;\n                    }\n                }\n            }\n        };\n        processError(this);\n        return fieldErrors;\n    }\n    static assert(value) {\n        if (!(value instanceof ZodError)) {\n            throw new Error(`Not a ZodError: ${value}`);\n        }\n    }\n    toString() {\n        return this.message;\n    }\n    get message() {\n        return JSON.stringify(this.issues, util.jsonStringifyReplacer, 2);\n    }\n    get isEmpty() {\n        return this.issues.length === 0;\n    }\n    flatten(mapper = (issue) => issue.message) {\n        const fieldErrors = {};\n        const formErrors = [];\n        for (const sub of this.issues) {\n            if (sub.path.length > 0) {\n                const firstEl = sub.path[0];\n                fieldErrors[firstEl] = fieldErrors[firstEl] || [];\n                fieldErrors[firstEl].push(mapper(sub));\n            }\n            else {\n                formErrors.push(mapper(sub));\n            }\n        }\n        return { formErrors, fieldErrors };\n    }\n    get formErrors() {\n        return this.flatten();\n    }\n}\nZodError.create = (issues) => {\n    const error = new ZodError(issues);\n    return error;\n};\n", "import { ZodIssueCode } from \"../ZodError.js\";\nimport { util, ZodParsedType } from \"../helpers/util.js\";\nconst errorMap = (issue, _ctx) => {\n    let message;\n    switch (issue.code) {\n        case ZodIssueCode.invalid_type:\n            if (issue.received === ZodParsedType.undefined) {\n                message = \"Required\";\n            }\n            else {\n                message = `Expected ${issue.expected}, received ${issue.received}`;\n            }\n            break;\n        case ZodIssueCode.invalid_literal:\n            message = `Invalid literal value, expected ${JSON.stringify(issue.expected, util.jsonStringifyReplacer)}`;\n            break;\n        case ZodIssueCode.unrecognized_keys:\n            message = `Unrecognized key(s) in object: ${util.joinValues(issue.keys, \", \")}`;\n            break;\n        case ZodIssueCode.invalid_union:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_union_discriminator:\n            message = `Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;\n            break;\n        case ZodIssueCode.invalid_enum_value:\n            message = `Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;\n            break;\n        case ZodIssueCode.invalid_arguments:\n            message = `Invalid function arguments`;\n            break;\n        case ZodIssueCode.invalid_return_type:\n            message = `Invalid function return type`;\n            break;\n        case ZodIssueCode.invalid_date:\n            message = `Invalid date`;\n            break;\n        case ZodIssueCode.invalid_string:\n            if (typeof issue.validation === \"object\") {\n                if (\"includes\" in issue.validation) {\n                    message = `Invalid input: must include \"${issue.validation.includes}\"`;\n                    if (typeof issue.validation.position === \"number\") {\n                        message = `${message} at one or more positions greater than or equal to ${issue.validation.position}`;\n                    }\n                }\n                else if (\"startsWith\" in issue.validation) {\n                    message = `Invalid input: must start with \"${issue.validation.startsWith}\"`;\n                }\n                else if (\"endsWith\" in issue.validation) {\n                    message = `Invalid input: must end with \"${issue.validation.endsWith}\"`;\n                }\n                else {\n                    util.assertNever(issue.validation);\n                }\n            }\n            else if (issue.validation !== \"regex\") {\n                message = `Invalid ${issue.validation}`;\n            }\n            else {\n                message = \"Invalid\";\n            }\n            break;\n        case ZodIssueCode.too_small:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `more than`} ${issue.minimum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `over`} ${issue.minimum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"bigint\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${new Date(Number(issue.minimum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.too_big:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `less than`} ${issue.maximum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `under`} ${issue.maximum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"bigint\")\n                message = `BigInt must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly` : issue.inclusive ? `smaller than or equal to` : `smaller than`} ${new Date(Number(issue.maximum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.custom:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_intersection_types:\n            message = `Intersection results could not be merged`;\n            break;\n        case ZodIssueCode.not_multiple_of:\n            message = `Number must be a multiple of ${issue.multipleOf}`;\n            break;\n        case ZodIssueCode.not_finite:\n            message = \"Number must be finite\";\n            break;\n        default:\n            message = _ctx.defaultError;\n            util.assertNever(issue);\n    }\n    return { message };\n};\nexport default errorMap;\n", "import defaultErrorMap from \"./locales/en.js\";\nlet overrideErrorMap = defaultErrorMap;\nexport { defaultErrorMap };\nexport function setErrorMap(map) {\n    overrideErrorMap = map;\n}\nexport function getErrorMap() {\n    return overrideErrorMap;\n}\n", "import { getErrorMap } from \"../errors.js\";\nimport defaultErrorMap from \"../locales/en.js\";\nexport const makeIssue = (params) => {\n    const { data, path, errorMaps, issueData } = params;\n    const fullPath = [...path, ...(issueData.path || [])];\n    const fullIssue = {\n        ...issueData,\n        path: fullPath,\n    };\n    if (issueData.message !== undefined) {\n        return {\n            ...issueData,\n            path: fullPath,\n            message: issueData.message,\n        };\n    }\n    let errorMessage = \"\";\n    const maps = errorMaps\n        .filter((m) => !!m)\n        .slice()\n        .reverse();\n    for (const map of maps) {\n        errorMessage = map(fullIssue, { data, defaultError: errorMessage }).message;\n    }\n    return {\n        ...issueData,\n        path: fullPath,\n        message: errorMessage,\n    };\n};\nexport const EMPTY_PATH = [];\nexport function addIssueToContext(ctx, issueData) {\n    const overrideMap = getErrorMap();\n    const issue = makeIssue({\n        issueData: issueData,\n        data: ctx.data,\n        path: ctx.path,\n        errorMaps: [\n            ctx.common.contextualErrorMap, // contextual error map is first priority\n            ctx.schemaErrorMap, // then schema-bound map if available\n            overrideMap, // then global override map\n            overrideMap === defaultErrorMap ? undefined : defaultErrorMap, // then global default map\n        ].filter((x) => !!x),\n    });\n    ctx.common.issues.push(issue);\n}\nexport class ParseStatus {\n    constructor() {\n        this.value = \"valid\";\n    }\n    dirty() {\n        if (this.value === \"valid\")\n            this.value = \"dirty\";\n    }\n    abort() {\n        if (this.value !== \"aborted\")\n            this.value = \"aborted\";\n    }\n    static mergeArray(status, results) {\n        const arrayValue = [];\n        for (const s of results) {\n            if (s.status === \"aborted\")\n                return INVALID;\n            if (s.status === \"dirty\")\n                status.dirty();\n            arrayValue.push(s.value);\n        }\n        return { status: status.value, value: arrayValue };\n    }\n    static async mergeObjectAsync(status, pairs) {\n        const syncPairs = [];\n        for (const pair of pairs) {\n            const key = await pair.key;\n            const value = await pair.value;\n            syncPairs.push({\n                key,\n                value,\n            });\n        }\n        return ParseStatus.mergeObjectSync(status, syncPairs);\n    }\n    static mergeObjectSync(status, pairs) {\n        const finalObject = {};\n        for (const pair of pairs) {\n            const { key, value } = pair;\n            if (key.status === \"aborted\")\n                return INVALID;\n            if (value.status === \"aborted\")\n                return INVALID;\n            if (key.status === \"dirty\")\n                status.dirty();\n            if (value.status === \"dirty\")\n                status.dirty();\n            if (key.value !== \"__proto__\" && (typeof value.value !== \"undefined\" || pair.alwaysSet)) {\n                finalObject[key.value] = value.value;\n            }\n        }\n        return { status: status.value, value: finalObject };\n    }\n}\nexport const INVALID = Object.freeze({\n    status: \"aborted\",\n});\nexport const DIRTY = (value) => ({ status: \"dirty\", value });\nexport const OK = (value) => ({ status: \"valid\", value });\nexport const isAborted = (x) => x.status === \"aborted\";\nexport const isDirty = (x) => x.status === \"dirty\";\nexport const isValid = (x) => x.status === \"valid\";\nexport const isAsync = (x) => typeof Promise !== \"undefined\" && x instanceof Promise;\n", "export var errorUtil;\n(function (errorUtil) {\n    errorUtil.errToObj = (message) => typeof message === \"string\" ? { message } : message || {};\n    // biome-ignore lint:\n    errorUtil.toString = (message) => typeof message === \"string\" ? message : message?.message;\n})(errorUtil || (errorUtil = {}));\n", "import { ZodError, ZodIssueCode, } from \"./ZodError.js\";\nimport { defaultErrorMap, getErrorMap } from \"./errors.js\";\nimport { errorUtil } from \"./helpers/errorUtil.js\";\nimport { DIRTY, INVALID, OK, ParseStatus, addIssueToContext, isAborted, isAsync, isDirty, isValid, makeIssue, } from \"./helpers/parseUtil.js\";\nimport { util, ZodParsedType, getParsedType } from \"./helpers/util.js\";\nclass ParseInputLazyPath {\n    constructor(parent, value, path, key) {\n        this._cachedPath = [];\n        this.parent = parent;\n        this.data = value;\n        this._path = path;\n        this._key = key;\n    }\n    get path() {\n        if (!this._cachedPath.length) {\n            if (Array.isArray(this._key)) {\n                this._cachedPath.push(...this._path, ...this._key);\n            }\n            else {\n                this._cachedPath.push(...this._path, this._key);\n            }\n        }\n        return this._cachedPath;\n    }\n}\nconst handleResult = (ctx, result) => {\n    if (isValid(result)) {\n        return { success: true, data: result.value };\n    }\n    else {\n        if (!ctx.common.issues.length) {\n            throw new Error(\"Validation failed but no issues detected.\");\n        }\n        return {\n            success: false,\n            get error() {\n                if (this._error)\n                    return this._error;\n                const error = new ZodError(ctx.common.issues);\n                this._error = error;\n                return this._error;\n            },\n        };\n    }\n};\nfunction processCreateParams(params) {\n    if (!params)\n        return {};\n    const { errorMap, invalid_type_error, required_error, description } = params;\n    if (errorMap && (invalid_type_error || required_error)) {\n        throw new Error(`Can't use \"invalid_type_error\" or \"required_error\" in conjunction with custom error map.`);\n    }\n    if (errorMap)\n        return { errorMap: errorMap, description };\n    const customMap = (iss, ctx) => {\n        const { message } = params;\n        if (iss.code === \"invalid_enum_value\") {\n            return { message: message ?? ctx.defaultError };\n        }\n        if (typeof ctx.data === \"undefined\") {\n            return { message: message ?? required_error ?? ctx.defaultError };\n        }\n        if (iss.code !== \"invalid_type\")\n            return { message: ctx.defaultError };\n        return { message: message ?? invalid_type_error ?? ctx.defaultError };\n    };\n    return { errorMap: customMap, description };\n}\nexport class ZodType {\n    get description() {\n        return this._def.description;\n    }\n    _getType(input) {\n        return getParsedType(input.data);\n    }\n    _getOrReturnCtx(input, ctx) {\n        return (ctx || {\n            common: input.parent.common,\n            data: input.data,\n            parsedType: getParsedType(input.data),\n            schemaErrorMap: this._def.errorMap,\n            path: input.path,\n            parent: input.parent,\n        });\n    }\n    _processInputParams(input) {\n        return {\n            status: new ParseStatus(),\n            ctx: {\n                common: input.parent.common,\n                data: input.data,\n                parsedType: getParsedType(input.data),\n                schemaErrorMap: this._def.errorMap,\n                path: input.path,\n                parent: input.parent,\n            },\n        };\n    }\n    _parseSync(input) {\n        const result = this._parse(input);\n        if (isAsync(result)) {\n            throw new Error(\"Synchronous parse encountered promise.\");\n        }\n        return result;\n    }\n    _parseAsync(input) {\n        const result = this._parse(input);\n        return Promise.resolve(result);\n    }\n    parse(data, params) {\n        const result = this.safeParse(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    safeParse(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: params?.async ?? false,\n                contextualErrorMap: params?.errorMap,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const result = this._parseSync({ data, path: ctx.path, parent: ctx });\n        return handleResult(ctx, result);\n    }\n    \"~validate\"(data) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: !!this[\"~standard\"].async,\n            },\n            path: [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        if (!this[\"~standard\"].async) {\n            try {\n                const result = this._parseSync({ data, path: [], parent: ctx });\n                return isValid(result)\n                    ? {\n                        value: result.value,\n                    }\n                    : {\n                        issues: ctx.common.issues,\n                    };\n            }\n            catch (err) {\n                if (err?.message?.toLowerCase()?.includes(\"encountered\")) {\n                    this[\"~standard\"].async = true;\n                }\n                ctx.common = {\n                    issues: [],\n                    async: true,\n                };\n            }\n        }\n        return this._parseAsync({ data, path: [], parent: ctx }).then((result) => isValid(result)\n            ? {\n                value: result.value,\n            }\n            : {\n                issues: ctx.common.issues,\n            });\n    }\n    async parseAsync(data, params) {\n        const result = await this.safeParseAsync(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    async safeParseAsync(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                contextualErrorMap: params?.errorMap,\n                async: true,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const maybeAsyncResult = this._parse({ data, path: ctx.path, parent: ctx });\n        const result = await (isAsync(maybeAsyncResult) ? maybeAsyncResult : Promise.resolve(maybeAsyncResult));\n        return handleResult(ctx, result);\n    }\n    refine(check, message) {\n        const getIssueProperties = (val) => {\n            if (typeof message === \"string\" || typeof message === \"undefined\") {\n                return { message };\n            }\n            else if (typeof message === \"function\") {\n                return message(val);\n            }\n            else {\n                return message;\n            }\n        };\n        return this._refinement((val, ctx) => {\n            const result = check(val);\n            const setError = () => ctx.addIssue({\n                code: ZodIssueCode.custom,\n                ...getIssueProperties(val),\n            });\n            if (typeof Promise !== \"undefined\" && result instanceof Promise) {\n                return result.then((data) => {\n                    if (!data) {\n                        setError();\n                        return false;\n                    }\n                    else {\n                        return true;\n                    }\n                });\n            }\n            if (!result) {\n                setError();\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    refinement(check, refinementData) {\n        return this._refinement((val, ctx) => {\n            if (!check(val)) {\n                ctx.addIssue(typeof refinementData === \"function\" ? refinementData(val, ctx) : refinementData);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    _refinement(refinement) {\n        return new ZodEffects({\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"refinement\", refinement },\n        });\n    }\n    superRefine(refinement) {\n        return this._refinement(refinement);\n    }\n    constructor(def) {\n        /** Alias of safeParseAsync */\n        this.spa = this.safeParseAsync;\n        this._def = def;\n        this.parse = this.parse.bind(this);\n        this.safeParse = this.safeParse.bind(this);\n        this.parseAsync = this.parseAsync.bind(this);\n        this.safeParseAsync = this.safeParseAsync.bind(this);\n        this.spa = this.spa.bind(this);\n        this.refine = this.refine.bind(this);\n        this.refinement = this.refinement.bind(this);\n        this.superRefine = this.superRefine.bind(this);\n        this.optional = this.optional.bind(this);\n        this.nullable = this.nullable.bind(this);\n        this.nullish = this.nullish.bind(this);\n        this.array = this.array.bind(this);\n        this.promise = this.promise.bind(this);\n        this.or = this.or.bind(this);\n        this.and = this.and.bind(this);\n        this.transform = this.transform.bind(this);\n        this.brand = this.brand.bind(this);\n        this.default = this.default.bind(this);\n        this.catch = this.catch.bind(this);\n        this.describe = this.describe.bind(this);\n        this.pipe = this.pipe.bind(this);\n        this.readonly = this.readonly.bind(this);\n        this.isNullable = this.isNullable.bind(this);\n        this.isOptional = this.isOptional.bind(this);\n        this[\"~standard\"] = {\n            version: 1,\n            vendor: \"zod\",\n            validate: (data) => this[\"~validate\"](data),\n        };\n    }\n    optional() {\n        return ZodOptional.create(this, this._def);\n    }\n    nullable() {\n        return ZodNullable.create(this, this._def);\n    }\n    nullish() {\n        return this.nullable().optional();\n    }\n    array() {\n        return ZodArray.create(this);\n    }\n    promise() {\n        return ZodPromise.create(this, this._def);\n    }\n    or(option) {\n        return ZodUnion.create([this, option], this._def);\n    }\n    and(incoming) {\n        return ZodIntersection.create(this, incoming, this._def);\n    }\n    transform(transform) {\n        return new ZodEffects({\n            ...processCreateParams(this._def),\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"transform\", transform },\n        });\n    }\n    default(def) {\n        const defaultValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodDefault({\n            ...processCreateParams(this._def),\n            innerType: this,\n            defaultValue: defaultValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodDefault,\n        });\n    }\n    brand() {\n        return new ZodBranded({\n            typeName: ZodFirstPartyTypeKind.ZodBranded,\n            type: this,\n            ...processCreateParams(this._def),\n        });\n    }\n    catch(def) {\n        const catchValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodCatch({\n            ...processCreateParams(this._def),\n            innerType: this,\n            catchValue: catchValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodCatch,\n        });\n    }\n    describe(description) {\n        const This = this.constructor;\n        return new This({\n            ...this._def,\n            description,\n        });\n    }\n    pipe(target) {\n        return ZodPipeline.create(this, target);\n    }\n    readonly() {\n        return ZodReadonly.create(this);\n    }\n    isOptional() {\n        return this.safeParse(undefined).success;\n    }\n    isNullable() {\n        return this.safeParse(null).success;\n    }\n}\nconst cuidRegex = /^c[^\\s-]{8,}$/i;\nconst cuid2Regex = /^[0-9a-z]+$/;\nconst ulidRegex = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n// const uuidRegex =\n//   /^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i;\nconst uuidRegex = /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/i;\nconst nanoidRegex = /^[a-z0-9_-]{21}$/i;\nconst jwtRegex = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/;\nconst durationRegex = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n// from https://stackoverflow.com/a/46181/1550155\n// old version: too slow, didn't support unicode\n// const emailRegex = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n//old email regex\n// const emailRegex = /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@((?!-)([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{1,})[^-<>()[\\].,;:\\s@\"]$/i;\n// eslint-disable-next-line\n// const emailRegex =\n//   /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$/;\n// const emailRegex =\n//   /^[a-zA-Z0-9\\.\\!\\#\\$\\%\\&\\'\\*\\+\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// const emailRegex =\n//   /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i;\nconst emailRegex = /^(?!\\.)(?!.*\\.\\.)([A-Z0-9_'+\\-\\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\\-]*\\.)+[A-Z]{2,}$/i;\n// const emailRegex =\n//   /^[a-z0-9.!#$%&\u2019*+/=?^_`{|}~-]+@[a-z0-9-]+(?:\\.[a-z0-9\\-]+)*$/i;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emojiRegex = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nlet emojiRegex;\n// faster, simpler, safer\nconst ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nconst ipv4CidrRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/;\n// const ipv6Regex =\n// /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;\nconst ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;\nconst ipv6CidrRegex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nconst base64Regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n// https://base64.guru/standards/base64url\nconst base64urlRegex = /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/;\n// simple\n// const dateRegexSource = `\\\\d{4}-\\\\d{2}-\\\\d{2}`;\n// no leap year validation\n// const dateRegexSource = `\\\\d{4}-((0[13578]|10|12)-31|(0[13-9]|1[0-2])-30|(0[1-9]|1[0-2])-(0[1-9]|1\\\\d|2\\\\d))`;\n// with leap year validation\nconst dateRegexSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateRegex = new RegExp(`^${dateRegexSource}$`);\nfunction timeRegexSource(args) {\n    let secondsRegexSource = `[0-5]\\\\d`;\n    if (args.precision) {\n        secondsRegexSource = `${secondsRegexSource}\\\\.\\\\d{${args.precision}}`;\n    }\n    else if (args.precision == null) {\n        secondsRegexSource = `${secondsRegexSource}(\\\\.\\\\d+)?`;\n    }\n    const secondsQuantifier = args.precision ? \"+\" : \"?\"; // require seconds if precision is nonzero\n    return `([01]\\\\d|2[0-3]):[0-5]\\\\d(:${secondsRegexSource})${secondsQuantifier}`;\n}\nfunction timeRegex(args) {\n    return new RegExp(`^${timeRegexSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nexport function datetimeRegex(args) {\n    let regex = `${dateRegexSource}T${timeRegexSource(args)}`;\n    const opts = [];\n    opts.push(args.local ? `Z?` : `Z`);\n    if (args.offset)\n        opts.push(`([+-]\\\\d{2}:?\\\\d{2})`);\n    regex = `${regex}(${opts.join(\"|\")})`;\n    return new RegExp(`^${regex}$`);\n}\nfunction isValidIP(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4Regex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6Regex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nfunction isValidJWT(jwt, alg) {\n    if (!jwtRegex.test(jwt))\n        return false;\n    try {\n        const [header] = jwt.split(\".\");\n        if (!header)\n            return false;\n        // Convert base64url to base64\n        const base64 = header\n            .replace(/-/g, \"+\")\n            .replace(/_/g, \"/\")\n            .padEnd(header.length + ((4 - (header.length % 4)) % 4), \"=\");\n        const decoded = JSON.parse(atob(base64));\n        if (typeof decoded !== \"object\" || decoded === null)\n            return false;\n        if (\"typ\" in decoded && decoded?.typ !== \"JWT\")\n            return false;\n        if (!decoded.alg)\n            return false;\n        if (alg && decoded.alg !== alg)\n            return false;\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nfunction isValidCidr(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4CidrRegex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6CidrRegex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nexport class ZodString extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = String(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.string) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.string,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.length < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.length > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"length\") {\n                const tooBig = input.data.length > check.value;\n                const tooSmall = input.data.length < check.value;\n                if (tooBig || tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    if (tooBig) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_big,\n                            maximum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    else if (tooSmall) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_small,\n                            minimum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"email\") {\n                if (!emailRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"email\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"emoji\") {\n                if (!emojiRegex) {\n                    emojiRegex = new RegExp(_emojiRegex, \"u\");\n                }\n                if (!emojiRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"emoji\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"uuid\") {\n                if (!uuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"uuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"nanoid\") {\n                if (!nanoidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"nanoid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid\") {\n                if (!cuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid2\") {\n                if (!cuid2Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid2\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ulid\") {\n                if (!ulidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ulid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"url\") {\n                try {\n                    new URL(input.data);\n                }\n                catch {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"regex\") {\n                check.regex.lastIndex = 0;\n                const testResult = check.regex.test(input.data);\n                if (!testResult) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"regex\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"trim\") {\n                input.data = input.data.trim();\n            }\n            else if (check.kind === \"includes\") {\n                if (!input.data.includes(check.value, check.position)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { includes: check.value, position: check.position },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"toLowerCase\") {\n                input.data = input.data.toLowerCase();\n            }\n            else if (check.kind === \"toUpperCase\") {\n                input.data = input.data.toUpperCase();\n            }\n            else if (check.kind === \"startsWith\") {\n                if (!input.data.startsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { startsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"endsWith\") {\n                if (!input.data.endsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { endsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"datetime\") {\n                const regex = datetimeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"datetime\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"date\") {\n                const regex = dateRegex;\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"date\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"time\") {\n                const regex = timeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"time\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"duration\") {\n                if (!durationRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"duration\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ip\") {\n                if (!isValidIP(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ip\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"jwt\") {\n                if (!isValidJWT(input.data, check.alg)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"jwt\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cidr\") {\n                if (!isValidCidr(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cidr\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64\") {\n                if (!base64Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64url\") {\n                if (!base64urlRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _regex(regex, validation, message) {\n        return this.refinement((data) => regex.test(data), {\n            validation,\n            code: ZodIssueCode.invalid_string,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    _addCheck(check) {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    email(message) {\n        return this._addCheck({ kind: \"email\", ...errorUtil.errToObj(message) });\n    }\n    url(message) {\n        return this._addCheck({ kind: \"url\", ...errorUtil.errToObj(message) });\n    }\n    emoji(message) {\n        return this._addCheck({ kind: \"emoji\", ...errorUtil.errToObj(message) });\n    }\n    uuid(message) {\n        return this._addCheck({ kind: \"uuid\", ...errorUtil.errToObj(message) });\n    }\n    nanoid(message) {\n        return this._addCheck({ kind: \"nanoid\", ...errorUtil.errToObj(message) });\n    }\n    cuid(message) {\n        return this._addCheck({ kind: \"cuid\", ...errorUtil.errToObj(message) });\n    }\n    cuid2(message) {\n        return this._addCheck({ kind: \"cuid2\", ...errorUtil.errToObj(message) });\n    }\n    ulid(message) {\n        return this._addCheck({ kind: \"ulid\", ...errorUtil.errToObj(message) });\n    }\n    base64(message) {\n        return this._addCheck({ kind: \"base64\", ...errorUtil.errToObj(message) });\n    }\n    base64url(message) {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return this._addCheck({\n            kind: \"base64url\",\n            ...errorUtil.errToObj(message),\n        });\n    }\n    jwt(options) {\n        return this._addCheck({ kind: \"jwt\", ...errorUtil.errToObj(options) });\n    }\n    ip(options) {\n        return this._addCheck({ kind: \"ip\", ...errorUtil.errToObj(options) });\n    }\n    cidr(options) {\n        return this._addCheck({ kind: \"cidr\", ...errorUtil.errToObj(options) });\n    }\n    datetime(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"datetime\",\n                precision: null,\n                offset: false,\n                local: false,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"datetime\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            offset: options?.offset ?? false,\n            local: options?.local ?? false,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    date(message) {\n        return this._addCheck({ kind: \"date\", message });\n    }\n    time(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"time\",\n                precision: null,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"time\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    duration(message) {\n        return this._addCheck({ kind: \"duration\", ...errorUtil.errToObj(message) });\n    }\n    regex(regex, message) {\n        return this._addCheck({\n            kind: \"regex\",\n            regex: regex,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    includes(value, options) {\n        return this._addCheck({\n            kind: \"includes\",\n            value: value,\n            position: options?.position,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    startsWith(value, message) {\n        return this._addCheck({\n            kind: \"startsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    endsWith(value, message) {\n        return this._addCheck({\n            kind: \"endsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    min(minLength, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    max(maxLength, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    length(len, message) {\n        return this._addCheck({\n            kind: \"length\",\n            value: len,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    /**\n     * Equivalent to `.min(1)`\n     */\n    nonempty(message) {\n        return this.min(1, errorUtil.errToObj(message));\n    }\n    trim() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"trim\" }],\n        });\n    }\n    toLowerCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toLowerCase\" }],\n        });\n    }\n    toUpperCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toUpperCase\" }],\n        });\n    }\n    get isDatetime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"datetime\");\n    }\n    get isDate() {\n        return !!this._def.checks.find((ch) => ch.kind === \"date\");\n    }\n    get isTime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"time\");\n    }\n    get isDuration() {\n        return !!this._def.checks.find((ch) => ch.kind === \"duration\");\n    }\n    get isEmail() {\n        return !!this._def.checks.find((ch) => ch.kind === \"email\");\n    }\n    get isURL() {\n        return !!this._def.checks.find((ch) => ch.kind === \"url\");\n    }\n    get isEmoji() {\n        return !!this._def.checks.find((ch) => ch.kind === \"emoji\");\n    }\n    get isUUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"uuid\");\n    }\n    get isNANOID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"nanoid\");\n    }\n    get isCUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid\");\n    }\n    get isCUID2() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid2\");\n    }\n    get isULID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ulid\");\n    }\n    get isIP() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ip\");\n    }\n    get isCIDR() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cidr\");\n    }\n    get isBase64() {\n        return !!this._def.checks.find((ch) => ch.kind === \"base64\");\n    }\n    get isBase64url() {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return !!this._def.checks.find((ch) => ch.kind === \"base64url\");\n    }\n    get minLength() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxLength() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodString.create = (params) => {\n    return new ZodString({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodString,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\n// https://stackoverflow.com/questions/3966484/why-does-modulus-operator-return-fractional-number-in-javascript/31711034#31711034\nfunction floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepDecCount = (step.toString().split(\".\")[1] || \"\").length;\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = Number.parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = Number.parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / 10 ** decCount;\n}\nexport class ZodNumber extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n        this.step = this.multipleOf;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Number(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.number) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.number,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"int\") {\n                if (!util.isInteger(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_type,\n                        expected: \"integer\",\n                        received: \"float\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (floatSafeRemainder(input.data, check.value) !== 0) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"finite\") {\n                if (!Number.isFinite(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_finite,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    int(message) {\n        return this._addCheck({\n            kind: \"int\",\n            message: errorUtil.toString(message),\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value: value,\n            message: errorUtil.toString(message),\n        });\n    }\n    finite(message) {\n        return this._addCheck({\n            kind: \"finite\",\n            message: errorUtil.toString(message),\n        });\n    }\n    safe(message) {\n        return this._addCheck({\n            kind: \"min\",\n            inclusive: true,\n            value: Number.MIN_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        })._addCheck({\n            kind: \"max\",\n            inclusive: true,\n            value: Number.MAX_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n    get isInt() {\n        return !!this._def.checks.find((ch) => ch.kind === \"int\" || (ch.kind === \"multipleOf\" && util.isInteger(ch.value)));\n    }\n    get isFinite() {\n        let max = null;\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"finite\" || ch.kind === \"int\" || ch.kind === \"multipleOf\") {\n                return true;\n            }\n            else if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n            else if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return Number.isFinite(min) && Number.isFinite(max);\n    }\n}\nZodNumber.create = (params) => {\n    return new ZodNumber({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodNumber,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBigInt extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            try {\n                input.data = BigInt(input.data);\n            }\n            catch {\n                return this._getInvalidInput(input);\n            }\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.bigint) {\n            return this._getInvalidInput(input);\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        type: \"bigint\",\n                        minimum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        type: \"bigint\",\n                        maximum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (input.data % check.value !== BigInt(0)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _getInvalidInput(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.bigint,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodBigInt.create = (params) => {\n    return new ZodBigInt({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodBigInt,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBoolean extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Boolean(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.boolean) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.boolean,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodBoolean.create = (params) => {\n    return new ZodBoolean({\n        typeName: ZodFirstPartyTypeKind.ZodBoolean,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDate extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = new Date(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.date) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.date,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (Number.isNaN(input.data.getTime())) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_date,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.getTime() < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        minimum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.getTime() > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        maximum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return {\n            status: status.value,\n            value: new Date(input.data.getTime()),\n        };\n    }\n    _addCheck(check) {\n        return new ZodDate({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    min(minDate, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    max(maxDate, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    get minDate() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min != null ? new Date(min) : null;\n    }\n    get maxDate() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max != null ? new Date(max) : null;\n    }\n}\nZodDate.create = (params) => {\n    return new ZodDate({\n        checks: [],\n        coerce: params?.coerce || false,\n        typeName: ZodFirstPartyTypeKind.ZodDate,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSymbol extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.symbol) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.symbol,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodSymbol.create = (params) => {\n    return new ZodSymbol({\n        typeName: ZodFirstPartyTypeKind.ZodSymbol,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUndefined extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.undefined,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodUndefined.create = (params) => {\n    return new ZodUndefined({\n        typeName: ZodFirstPartyTypeKind.ZodUndefined,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNull extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.null) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.null,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodNull.create = (params) => {\n    return new ZodNull({\n        typeName: ZodFirstPartyTypeKind.ZodNull,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodAny extends ZodType {\n    constructor() {\n        super(...arguments);\n        // to prevent instances of other classes from extending ZodAny. this causes issues with catchall in ZodObject.\n        this._any = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodAny.create = (params) => {\n    return new ZodAny({\n        typeName: ZodFirstPartyTypeKind.ZodAny,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnknown extends ZodType {\n    constructor() {\n        super(...arguments);\n        // required\n        this._unknown = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodUnknown.create = (params) => {\n    return new ZodUnknown({\n        typeName: ZodFirstPartyTypeKind.ZodUnknown,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNever extends ZodType {\n    _parse(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.never,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n}\nZodNever.create = (params) => {\n    return new ZodNever({\n        typeName: ZodFirstPartyTypeKind.ZodNever,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodVoid extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.void,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodVoid.create = (params) => {\n    return new ZodVoid({\n        typeName: ZodFirstPartyTypeKind.ZodVoid,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodArray extends ZodType {\n    _parse(input) {\n        const { ctx, status } = this._processInputParams(input);\n        const def = this._def;\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (def.exactLength !== null) {\n            const tooBig = ctx.data.length > def.exactLength.value;\n            const tooSmall = ctx.data.length < def.exactLength.value;\n            if (tooBig || tooSmall) {\n                addIssueToContext(ctx, {\n                    code: tooBig ? ZodIssueCode.too_big : ZodIssueCode.too_small,\n                    minimum: (tooSmall ? def.exactLength.value : undefined),\n                    maximum: (tooBig ? def.exactLength.value : undefined),\n                    type: \"array\",\n                    inclusive: true,\n                    exact: true,\n                    message: def.exactLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.minLength !== null) {\n            if (ctx.data.length < def.minLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxLength !== null) {\n            if (ctx.data.length > def.maxLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.all([...ctx.data].map((item, i) => {\n                return def.type._parseAsync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n            })).then((result) => {\n                return ParseStatus.mergeArray(status, result);\n            });\n        }\n        const result = [...ctx.data].map((item, i) => {\n            return def.type._parseSync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n        });\n        return ParseStatus.mergeArray(status, result);\n    }\n    get element() {\n        return this._def.type;\n    }\n    min(minLength, message) {\n        return new ZodArray({\n            ...this._def,\n            minLength: { value: minLength, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxLength, message) {\n        return new ZodArray({\n            ...this._def,\n            maxLength: { value: maxLength, message: errorUtil.toString(message) },\n        });\n    }\n    length(len, message) {\n        return new ZodArray({\n            ...this._def,\n            exactLength: { value: len, message: errorUtil.toString(message) },\n        });\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodArray.create = (schema, params) => {\n    return new ZodArray({\n        type: schema,\n        minLength: null,\n        maxLength: null,\n        exactLength: null,\n        typeName: ZodFirstPartyTypeKind.ZodArray,\n        ...processCreateParams(params),\n    });\n};\nfunction deepPartialify(schema) {\n    if (schema instanceof ZodObject) {\n        const newShape = {};\n        for (const key in schema.shape) {\n            const fieldSchema = schema.shape[key];\n            newShape[key] = ZodOptional.create(deepPartialify(fieldSchema));\n        }\n        return new ZodObject({\n            ...schema._def,\n            shape: () => newShape,\n        });\n    }\n    else if (schema instanceof ZodArray) {\n        return new ZodArray({\n            ...schema._def,\n            type: deepPartialify(schema.element),\n        });\n    }\n    else if (schema instanceof ZodOptional) {\n        return ZodOptional.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodNullable) {\n        return ZodNullable.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodTuple) {\n        return ZodTuple.create(schema.items.map((item) => deepPartialify(item)));\n    }\n    else {\n        return schema;\n    }\n}\nexport class ZodObject extends ZodType {\n    constructor() {\n        super(...arguments);\n        this._cached = null;\n        /**\n         * @deprecated In most cases, this is no longer needed - unknown properties are now silently stripped.\n         * If you want to pass through unknown properties, use `.passthrough()` instead.\n         */\n        this.nonstrict = this.passthrough;\n        // extend<\n        //   Augmentation extends ZodRawShape,\n        //   NewOutput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_output\"]\n        //       : k extends keyof Output\n        //       ? Output[k]\n        //       : never;\n        //   }>,\n        //   NewInput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_input\"]\n        //       : k extends keyof Input\n        //       ? Input[k]\n        //       : never;\n        //   }>\n        // >(\n        //   augmentation: Augmentation\n        // ): ZodObject<\n        //   extendShape<T, Augmentation>,\n        //   UnknownKeys,\n        //   Catchall,\n        //   NewOutput,\n        //   NewInput\n        // > {\n        //   return new ZodObject({\n        //     ...this._def,\n        //     shape: () => ({\n        //       ...this._def.shape(),\n        //       ...augmentation,\n        //     }),\n        //   }) as any;\n        // }\n        /**\n         * @deprecated Use `.extend` instead\n         *  */\n        this.augment = this.extend;\n    }\n    _getCached() {\n        if (this._cached !== null)\n            return this._cached;\n        const shape = this._def.shape();\n        const keys = util.objectKeys(shape);\n        this._cached = { shape, keys };\n        return this._cached;\n    }\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.object) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const { status, ctx } = this._processInputParams(input);\n        const { shape, keys: shapeKeys } = this._getCached();\n        const extraKeys = [];\n        if (!(this._def.catchall instanceof ZodNever && this._def.unknownKeys === \"strip\")) {\n            for (const key in ctx.data) {\n                if (!shapeKeys.includes(key)) {\n                    extraKeys.push(key);\n                }\n            }\n        }\n        const pairs = [];\n        for (const key of shapeKeys) {\n            const keyValidator = shape[key];\n            const value = ctx.data[key];\n            pairs.push({\n                key: { status: \"valid\", value: key },\n                value: keyValidator._parse(new ParseInputLazyPath(ctx, value, ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (this._def.catchall instanceof ZodNever) {\n            const unknownKeys = this._def.unknownKeys;\n            if (unknownKeys === \"passthrough\") {\n                for (const key of extraKeys) {\n                    pairs.push({\n                        key: { status: \"valid\", value: key },\n                        value: { status: \"valid\", value: ctx.data[key] },\n                    });\n                }\n            }\n            else if (unknownKeys === \"strict\") {\n                if (extraKeys.length > 0) {\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.unrecognized_keys,\n                        keys: extraKeys,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (unknownKeys === \"strip\") {\n            }\n            else {\n                throw new Error(`Internal ZodObject error: invalid unknownKeys value.`);\n            }\n        }\n        else {\n            // run catchall validation\n            const catchall = this._def.catchall;\n            for (const key of extraKeys) {\n                const value = ctx.data[key];\n                pairs.push({\n                    key: { status: \"valid\", value: key },\n                    value: catchall._parse(new ParseInputLazyPath(ctx, value, ctx.path, key) //, ctx.child(key), value, getParsedType(value)\n                    ),\n                    alwaysSet: key in ctx.data,\n                });\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.resolve()\n                .then(async () => {\n                const syncPairs = [];\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    syncPairs.push({\n                        key,\n                        value,\n                        alwaysSet: pair.alwaysSet,\n                    });\n                }\n                return syncPairs;\n            })\n                .then((syncPairs) => {\n                return ParseStatus.mergeObjectSync(status, syncPairs);\n            });\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get shape() {\n        return this._def.shape();\n    }\n    strict(message) {\n        errorUtil.errToObj;\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strict\",\n            ...(message !== undefined\n                ? {\n                    errorMap: (issue, ctx) => {\n                        const defaultError = this._def.errorMap?.(issue, ctx).message ?? ctx.defaultError;\n                        if (issue.code === \"unrecognized_keys\")\n                            return {\n                                message: errorUtil.errToObj(message).message ?? defaultError,\n                            };\n                        return {\n                            message: defaultError,\n                        };\n                    },\n                }\n                : {}),\n        });\n    }\n    strip() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strip\",\n        });\n    }\n    passthrough() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"passthrough\",\n        });\n    }\n    // const AugmentFactory =\n    //   <Def extends ZodObjectDef>(def: Def) =>\n    //   <Augmentation extends ZodRawShape>(\n    //     augmentation: Augmentation\n    //   ): ZodObject<\n    //     extendShape<ReturnType<Def[\"shape\"]>, Augmentation>,\n    //     Def[\"unknownKeys\"],\n    //     Def[\"catchall\"]\n    //   > => {\n    //     return new ZodObject({\n    //       ...def,\n    //       shape: () => ({\n    //         ...def.shape(),\n    //         ...augmentation,\n    //       }),\n    //     }) as any;\n    //   };\n    extend(augmentation) {\n        return new ZodObject({\n            ...this._def,\n            shape: () => ({\n                ...this._def.shape(),\n                ...augmentation,\n            }),\n        });\n    }\n    /**\n     * Prior to zod@1.0.12 there was a bug in the\n     * inferred type of merged objects. Please\n     * upgrade if you are experiencing issues.\n     */\n    merge(merging) {\n        const merged = new ZodObject({\n            unknownKeys: merging._def.unknownKeys,\n            catchall: merging._def.catchall,\n            shape: () => ({\n                ...this._def.shape(),\n                ...merging._def.shape(),\n            }),\n            typeName: ZodFirstPartyTypeKind.ZodObject,\n        });\n        return merged;\n    }\n    // merge<\n    //   Incoming extends AnyZodObject,\n    //   Augmentation extends Incoming[\"shape\"],\n    //   NewOutput extends {\n    //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_output\"]\n    //       : k extends keyof Output\n    //       ? Output[k]\n    //       : never;\n    //   },\n    //   NewInput extends {\n    //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_input\"]\n    //       : k extends keyof Input\n    //       ? Input[k]\n    //       : never;\n    //   }\n    // >(\n    //   merging: Incoming\n    // ): ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"],\n    //   NewOutput,\n    //   NewInput\n    // > {\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    setKey(key, schema) {\n        return this.augment({ [key]: schema });\n    }\n    // merge<Incoming extends AnyZodObject>(\n    //   merging: Incoming\n    // ): //ZodObject<T & Incoming[\"_shape\"], UnknownKeys, Catchall> = (merging) => {\n    // ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"]\n    // > {\n    //   // const mergedShape = objectUtil.mergeShapes(\n    //   //   this._def.shape(),\n    //   //   merging._def.shape()\n    //   // );\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    catchall(index) {\n        return new ZodObject({\n            ...this._def,\n            catchall: index,\n        });\n    }\n    pick(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(mask)) {\n            if (mask[key] && this.shape[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    omit(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (!mask[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    /**\n     * @deprecated\n     */\n    deepPartial() {\n        return deepPartialify(this);\n    }\n    partial(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            const fieldSchema = this.shape[key];\n            if (mask && !mask[key]) {\n                newShape[key] = fieldSchema;\n            }\n            else {\n                newShape[key] = fieldSchema.optional();\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    required(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (mask && !mask[key]) {\n                newShape[key] = this.shape[key];\n            }\n            else {\n                const fieldSchema = this.shape[key];\n                let newField = fieldSchema;\n                while (newField instanceof ZodOptional) {\n                    newField = newField._def.innerType;\n                }\n                newShape[key] = newField;\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    keyof() {\n        return createZodEnum(util.objectKeys(this.shape));\n    }\n}\nZodObject.create = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.strictCreate = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strict\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.lazycreate = (shape, params) => {\n    return new ZodObject({\n        shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const options = this._def.options;\n        function handleResults(results) {\n            // return first issue-free validation if it exists\n            for (const result of results) {\n                if (result.result.status === \"valid\") {\n                    return result.result;\n                }\n            }\n            for (const result of results) {\n                if (result.result.status === \"dirty\") {\n                    // add issues from dirty option\n                    ctx.common.issues.push(...result.ctx.common.issues);\n                    return result.result;\n                }\n            }\n            // return invalid\n            const unionErrors = results.map((result) => new ZodError(result.ctx.common.issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return Promise.all(options.map(async (option) => {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                return {\n                    result: await option._parseAsync({\n                        data: ctx.data,\n                        path: ctx.path,\n                        parent: childCtx,\n                    }),\n                    ctx: childCtx,\n                };\n            })).then(handleResults);\n        }\n        else {\n            let dirty = undefined;\n            const issues = [];\n            for (const option of options) {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                const result = option._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: childCtx,\n                });\n                if (result.status === \"valid\") {\n                    return result;\n                }\n                else if (result.status === \"dirty\" && !dirty) {\n                    dirty = { result, ctx: childCtx };\n                }\n                if (childCtx.common.issues.length) {\n                    issues.push(childCtx.common.issues);\n                }\n            }\n            if (dirty) {\n                ctx.common.issues.push(...dirty.ctx.common.issues);\n                return dirty.result;\n            }\n            const unionErrors = issues.map((issues) => new ZodError(issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n    }\n    get options() {\n        return this._def.options;\n    }\n}\nZodUnion.create = (types, params) => {\n    return new ZodUnion({\n        options: types,\n        typeName: ZodFirstPartyTypeKind.ZodUnion,\n        ...processCreateParams(params),\n    });\n};\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\n//////////                                 //////////\n//////////      ZodDiscriminatedUnion      //////////\n//////////                                 //////////\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\nconst getDiscriminator = (type) => {\n    if (type instanceof ZodLazy) {\n        return getDiscriminator(type.schema);\n    }\n    else if (type instanceof ZodEffects) {\n        return getDiscriminator(type.innerType());\n    }\n    else if (type instanceof ZodLiteral) {\n        return [type.value];\n    }\n    else if (type instanceof ZodEnum) {\n        return type.options;\n    }\n    else if (type instanceof ZodNativeEnum) {\n        // eslint-disable-next-line ban/ban\n        return util.objectValues(type.enum);\n    }\n    else if (type instanceof ZodDefault) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else if (type instanceof ZodUndefined) {\n        return [undefined];\n    }\n    else if (type instanceof ZodNull) {\n        return [null];\n    }\n    else if (type instanceof ZodOptional) {\n        return [undefined, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodNullable) {\n        return [null, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodBranded) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodReadonly) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodCatch) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else {\n        return [];\n    }\n};\nexport class ZodDiscriminatedUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const discriminator = this.discriminator;\n        const discriminatorValue = ctx.data[discriminator];\n        const option = this.optionsMap.get(discriminatorValue);\n        if (!option) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union_discriminator,\n                options: Array.from(this.optionsMap.keys()),\n                path: [discriminator],\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return option._parseAsync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n        else {\n            return option._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n    }\n    get discriminator() {\n        return this._def.discriminator;\n    }\n    get options() {\n        return this._def.options;\n    }\n    get optionsMap() {\n        return this._def.optionsMap;\n    }\n    /**\n     * The constructor of the discriminated union schema. Its behaviour is very similar to that of the normal z.union() constructor.\n     * However, it only allows a union of objects, all of which need to share a discriminator property. This property must\n     * have a different value for each object in the union.\n     * @param discriminator the name of the discriminator property\n     * @param types an array of object schemas\n     * @param params\n     */\n    static create(discriminator, options, params) {\n        // Get all the valid discriminator values\n        const optionsMap = new Map();\n        // try {\n        for (const type of options) {\n            const discriminatorValues = getDiscriminator(type.shape[discriminator]);\n            if (!discriminatorValues.length) {\n                throw new Error(`A discriminator value for key \\`${discriminator}\\` could not be extracted from all schema options`);\n            }\n            for (const value of discriminatorValues) {\n                if (optionsMap.has(value)) {\n                    throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);\n                }\n                optionsMap.set(value, type);\n            }\n        }\n        return new ZodDiscriminatedUnion({\n            typeName: ZodFirstPartyTypeKind.ZodDiscriminatedUnion,\n            discriminator,\n            options,\n            optionsMap,\n            ...processCreateParams(params),\n        });\n    }\n}\nfunction mergeValues(a, b) {\n    const aType = getParsedType(a);\n    const bType = getParsedType(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    else if (aType === ZodParsedType.object && bType === ZodParsedType.object) {\n        const bKeys = util.objectKeys(b);\n        const sharedKeys = util.objectKeys(a).filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    else if (aType === ZodParsedType.array && bType === ZodParsedType.array) {\n        if (a.length !== b.length) {\n            return { valid: false };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    else if (aType === ZodParsedType.date && bType === ZodParsedType.date && +a === +b) {\n        return { valid: true, data: a };\n    }\n    else {\n        return { valid: false };\n    }\n}\nexport class ZodIntersection extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const handleParsed = (parsedLeft, parsedRight) => {\n            if (isAborted(parsedLeft) || isAborted(parsedRight)) {\n                return INVALID;\n            }\n            const merged = mergeValues(parsedLeft.value, parsedRight.value);\n            if (!merged.valid) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.invalid_intersection_types,\n                });\n                return INVALID;\n            }\n            if (isDirty(parsedLeft) || isDirty(parsedRight)) {\n                status.dirty();\n            }\n            return { status: status.value, value: merged.data };\n        };\n        if (ctx.common.async) {\n            return Promise.all([\n                this._def.left._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n                this._def.right._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n            ]).then(([left, right]) => handleParsed(left, right));\n        }\n        else {\n            return handleParsed(this._def.left._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }), this._def.right._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }));\n        }\n    }\n}\nZodIntersection.create = (left, right, params) => {\n    return new ZodIntersection({\n        left: left,\n        right: right,\n        typeName: ZodFirstPartyTypeKind.ZodIntersection,\n        ...processCreateParams(params),\n    });\n};\n// type ZodTupleItems = [ZodTypeAny, ...ZodTypeAny[]];\nexport class ZodTuple extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (ctx.data.length < this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_small,\n                minimum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            return INVALID;\n        }\n        const rest = this._def.rest;\n        if (!rest && ctx.data.length > this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_big,\n                maximum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            status.dirty();\n        }\n        const items = [...ctx.data]\n            .map((item, itemIndex) => {\n            const schema = this._def.items[itemIndex] || this._def.rest;\n            if (!schema)\n                return null;\n            return schema._parse(new ParseInputLazyPath(ctx, item, ctx.path, itemIndex));\n        })\n            .filter((x) => !!x); // filter nulls\n        if (ctx.common.async) {\n            return Promise.all(items).then((results) => {\n                return ParseStatus.mergeArray(status, results);\n            });\n        }\n        else {\n            return ParseStatus.mergeArray(status, items);\n        }\n    }\n    get items() {\n        return this._def.items;\n    }\n    rest(rest) {\n        return new ZodTuple({\n            ...this._def,\n            rest,\n        });\n    }\n}\nZodTuple.create = (schemas, params) => {\n    if (!Array.isArray(schemas)) {\n        throw new Error(\"You must pass an array of schemas to z.tuple([ ... ])\");\n    }\n    return new ZodTuple({\n        items: schemas,\n        typeName: ZodFirstPartyTypeKind.ZodTuple,\n        rest: null,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodRecord extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const pairs = [];\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        for (const key in ctx.data) {\n            pairs.push({\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, key)),\n                value: valueType._parse(new ParseInputLazyPath(ctx, ctx.data[key], ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (ctx.common.async) {\n            return ParseStatus.mergeObjectAsync(status, pairs);\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get element() {\n        return this._def.valueType;\n    }\n    static create(first, second, third) {\n        if (second instanceof ZodType) {\n            return new ZodRecord({\n                keyType: first,\n                valueType: second,\n                typeName: ZodFirstPartyTypeKind.ZodRecord,\n                ...processCreateParams(third),\n            });\n        }\n        return new ZodRecord({\n            keyType: ZodString.create(),\n            valueType: first,\n            typeName: ZodFirstPartyTypeKind.ZodRecord,\n            ...processCreateParams(second),\n        });\n    }\n}\nexport class ZodMap extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.map) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.map,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        const pairs = [...ctx.data.entries()].map(([key, value], index) => {\n            return {\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, [index, \"key\"])),\n                value: valueType._parse(new ParseInputLazyPath(ctx, value, ctx.path, [index, \"value\"])),\n            };\n        });\n        if (ctx.common.async) {\n            const finalMap = new Map();\n            return Promise.resolve().then(async () => {\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    if (key.status === \"aborted\" || value.status === \"aborted\") {\n                        return INVALID;\n                    }\n                    if (key.status === \"dirty\" || value.status === \"dirty\") {\n                        status.dirty();\n                    }\n                    finalMap.set(key.value, value.value);\n                }\n                return { status: status.value, value: finalMap };\n            });\n        }\n        else {\n            const finalMap = new Map();\n            for (const pair of pairs) {\n                const key = pair.key;\n                const value = pair.value;\n                if (key.status === \"aborted\" || value.status === \"aborted\") {\n                    return INVALID;\n                }\n                if (key.status === \"dirty\" || value.status === \"dirty\") {\n                    status.dirty();\n                }\n                finalMap.set(key.value, value.value);\n            }\n            return { status: status.value, value: finalMap };\n        }\n    }\n}\nZodMap.create = (keyType, valueType, params) => {\n    return new ZodMap({\n        valueType,\n        keyType,\n        typeName: ZodFirstPartyTypeKind.ZodMap,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSet extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.set) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.set,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const def = this._def;\n        if (def.minSize !== null) {\n            if (ctx.data.size < def.minSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minSize.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxSize !== null) {\n            if (ctx.data.size > def.maxSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxSize.message,\n                });\n                status.dirty();\n            }\n        }\n        const valueType = this._def.valueType;\n        function finalizeSet(elements) {\n            const parsedSet = new Set();\n            for (const element of elements) {\n                if (element.status === \"aborted\")\n                    return INVALID;\n                if (element.status === \"dirty\")\n                    status.dirty();\n                parsedSet.add(element.value);\n            }\n            return { status: status.value, value: parsedSet };\n        }\n        const elements = [...ctx.data.values()].map((item, i) => valueType._parse(new ParseInputLazyPath(ctx, item, ctx.path, i)));\n        if (ctx.common.async) {\n            return Promise.all(elements).then((elements) => finalizeSet(elements));\n        }\n        else {\n            return finalizeSet(elements);\n        }\n    }\n    min(minSize, message) {\n        return new ZodSet({\n            ...this._def,\n            minSize: { value: minSize, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxSize, message) {\n        return new ZodSet({\n            ...this._def,\n            maxSize: { value: maxSize, message: errorUtil.toString(message) },\n        });\n    }\n    size(size, message) {\n        return this.min(size, message).max(size, message);\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodSet.create = (valueType, params) => {\n    return new ZodSet({\n        valueType,\n        minSize: null,\n        maxSize: null,\n        typeName: ZodFirstPartyTypeKind.ZodSet,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodFunction extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.validate = this.implement;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.function) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.function,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        function makeArgsIssue(args, error) {\n            return makeIssue({\n                data: args,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_arguments,\n                    argumentsError: error,\n                },\n            });\n        }\n        function makeReturnsIssue(returns, error) {\n            return makeIssue({\n                data: returns,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_return_type,\n                    returnTypeError: error,\n                },\n            });\n        }\n        const params = { errorMap: ctx.common.contextualErrorMap };\n        const fn = ctx.data;\n        if (this._def.returns instanceof ZodPromise) {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(async function (...args) {\n                const error = new ZodError([]);\n                const parsedArgs = await me._def.args.parseAsync(args, params).catch((e) => {\n                    error.addIssue(makeArgsIssue(args, e));\n                    throw error;\n                });\n                const result = await Reflect.apply(fn, this, parsedArgs);\n                const parsedReturns = await me._def.returns._def.type\n                    .parseAsync(result, params)\n                    .catch((e) => {\n                    error.addIssue(makeReturnsIssue(result, e));\n                    throw error;\n                });\n                return parsedReturns;\n            });\n        }\n        else {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(function (...args) {\n                const parsedArgs = me._def.args.safeParse(args, params);\n                if (!parsedArgs.success) {\n                    throw new ZodError([makeArgsIssue(args, parsedArgs.error)]);\n                }\n                const result = Reflect.apply(fn, this, parsedArgs.data);\n                const parsedReturns = me._def.returns.safeParse(result, params);\n                if (!parsedReturns.success) {\n                    throw new ZodError([makeReturnsIssue(result, parsedReturns.error)]);\n                }\n                return parsedReturns.data;\n            });\n        }\n    }\n    parameters() {\n        return this._def.args;\n    }\n    returnType() {\n        return this._def.returns;\n    }\n    args(...items) {\n        return new ZodFunction({\n            ...this._def,\n            args: ZodTuple.create(items).rest(ZodUnknown.create()),\n        });\n    }\n    returns(returnType) {\n        return new ZodFunction({\n            ...this._def,\n            returns: returnType,\n        });\n    }\n    implement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    strictImplement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    static create(args, returns, params) {\n        return new ZodFunction({\n            args: (args ? args : ZodTuple.create([]).rest(ZodUnknown.create())),\n            returns: returns || ZodUnknown.create(),\n            typeName: ZodFirstPartyTypeKind.ZodFunction,\n            ...processCreateParams(params),\n        });\n    }\n}\nexport class ZodLazy extends ZodType {\n    get schema() {\n        return this._def.getter();\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const lazySchema = this._def.getter();\n        return lazySchema._parse({ data: ctx.data, path: ctx.path, parent: ctx });\n    }\n}\nZodLazy.create = (getter, params) => {\n    return new ZodLazy({\n        getter: getter,\n        typeName: ZodFirstPartyTypeKind.ZodLazy,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodLiteral extends ZodType {\n    _parse(input) {\n        if (input.data !== this._def.value) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_literal,\n                expected: this._def.value,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n    get value() {\n        return this._def.value;\n    }\n}\nZodLiteral.create = (value, params) => {\n    return new ZodLiteral({\n        value: value,\n        typeName: ZodFirstPartyTypeKind.ZodLiteral,\n        ...processCreateParams(params),\n    });\n};\nfunction createZodEnum(values, params) {\n    return new ZodEnum({\n        values,\n        typeName: ZodFirstPartyTypeKind.ZodEnum,\n        ...processCreateParams(params),\n    });\n}\nexport class ZodEnum extends ZodType {\n    _parse(input) {\n        if (typeof input.data !== \"string\") {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(this._def.values);\n        }\n        if (!this._cache.has(input.data)) {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get options() {\n        return this._def.values;\n    }\n    get enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Values() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    extract(values, newDef = this._def) {\n        return ZodEnum.create(values, {\n            ...this._def,\n            ...newDef,\n        });\n    }\n    exclude(values, newDef = this._def) {\n        return ZodEnum.create(this.options.filter((opt) => !values.includes(opt)), {\n            ...this._def,\n            ...newDef,\n        });\n    }\n}\nZodEnum.create = createZodEnum;\nexport class ZodNativeEnum extends ZodType {\n    _parse(input) {\n        const nativeEnumValues = util.getValidEnumValues(this._def.values);\n        const ctx = this._getOrReturnCtx(input);\n        if (ctx.parsedType !== ZodParsedType.string && ctx.parsedType !== ZodParsedType.number) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(util.getValidEnumValues(this._def.values));\n        }\n        if (!this._cache.has(input.data)) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get enum() {\n        return this._def.values;\n    }\n}\nZodNativeEnum.create = (values, params) => {\n    return new ZodNativeEnum({\n        values: values,\n        typeName: ZodFirstPartyTypeKind.ZodNativeEnum,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodPromise extends ZodType {\n    unwrap() {\n        return this._def.type;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.promise && ctx.common.async === false) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.promise,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const promisified = ctx.parsedType === ZodParsedType.promise ? ctx.data : Promise.resolve(ctx.data);\n        return OK(promisified.then((data) => {\n            return this._def.type.parseAsync(data, {\n                path: ctx.path,\n                errorMap: ctx.common.contextualErrorMap,\n            });\n        }));\n    }\n}\nZodPromise.create = (schema, params) => {\n    return new ZodPromise({\n        type: schema,\n        typeName: ZodFirstPartyTypeKind.ZodPromise,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodEffects extends ZodType {\n    innerType() {\n        return this._def.schema;\n    }\n    sourceType() {\n        return this._def.schema._def.typeName === ZodFirstPartyTypeKind.ZodEffects\n            ? this._def.schema.sourceType()\n            : this._def.schema;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const effect = this._def.effect || null;\n        const checkCtx = {\n            addIssue: (arg) => {\n                addIssueToContext(ctx, arg);\n                if (arg.fatal) {\n                    status.abort();\n                }\n                else {\n                    status.dirty();\n                }\n            },\n            get path() {\n                return ctx.path;\n            },\n        };\n        checkCtx.addIssue = checkCtx.addIssue.bind(checkCtx);\n        if (effect.type === \"preprocess\") {\n            const processed = effect.transform(ctx.data, checkCtx);\n            if (ctx.common.async) {\n                return Promise.resolve(processed).then(async (processed) => {\n                    if (status.value === \"aborted\")\n                        return INVALID;\n                    const result = await this._def.schema._parseAsync({\n                        data: processed,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                    if (result.status === \"aborted\")\n                        return INVALID;\n                    if (result.status === \"dirty\")\n                        return DIRTY(result.value);\n                    if (status.value === \"dirty\")\n                        return DIRTY(result.value);\n                    return result;\n                });\n            }\n            else {\n                if (status.value === \"aborted\")\n                    return INVALID;\n                const result = this._def.schema._parseSync({\n                    data: processed,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (result.status === \"aborted\")\n                    return INVALID;\n                if (result.status === \"dirty\")\n                    return DIRTY(result.value);\n                if (status.value === \"dirty\")\n                    return DIRTY(result.value);\n                return result;\n            }\n        }\n        if (effect.type === \"refinement\") {\n            const executeRefinement = (acc) => {\n                const result = effect.refinement(acc, checkCtx);\n                if (ctx.common.async) {\n                    return Promise.resolve(result);\n                }\n                if (result instanceof Promise) {\n                    throw new Error(\"Async refinement encountered during synchronous parse operation. Use .parseAsync instead.\");\n                }\n                return acc;\n            };\n            if (ctx.common.async === false) {\n                const inner = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inner.status === \"aborted\")\n                    return INVALID;\n                if (inner.status === \"dirty\")\n                    status.dirty();\n                // return value is ignored\n                executeRefinement(inner.value);\n                return { status: status.value, value: inner.value };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((inner) => {\n                    if (inner.status === \"aborted\")\n                        return INVALID;\n                    if (inner.status === \"dirty\")\n                        status.dirty();\n                    return executeRefinement(inner.value).then(() => {\n                        return { status: status.value, value: inner.value };\n                    });\n                });\n            }\n        }\n        if (effect.type === \"transform\") {\n            if (ctx.common.async === false) {\n                const base = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (!isValid(base))\n                    return INVALID;\n                const result = effect.transform(base.value, checkCtx);\n                if (result instanceof Promise) {\n                    throw new Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);\n                }\n                return { status: status.value, value: result };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((base) => {\n                    if (!isValid(base))\n                        return INVALID;\n                    return Promise.resolve(effect.transform(base.value, checkCtx)).then((result) => ({\n                        status: status.value,\n                        value: result,\n                    }));\n                });\n            }\n        }\n        util.assertNever(effect);\n    }\n}\nZodEffects.create = (schema, effect, params) => {\n    return new ZodEffects({\n        schema,\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        effect,\n        ...processCreateParams(params),\n    });\n};\nZodEffects.createWithPreprocess = (preprocess, schema, params) => {\n    return new ZodEffects({\n        schema,\n        effect: { type: \"preprocess\", transform: preprocess },\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        ...processCreateParams(params),\n    });\n};\nexport { ZodEffects as ZodTransformer };\nexport class ZodOptional extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.undefined) {\n            return OK(undefined);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodOptional.create = (type, params) => {\n    return new ZodOptional({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodOptional,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNullable extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.null) {\n            return OK(null);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodNullable.create = (type, params) => {\n    return new ZodNullable({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodNullable,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDefault extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        let data = ctx.data;\n        if (ctx.parsedType === ZodParsedType.undefined) {\n            data = this._def.defaultValue();\n        }\n        return this._def.innerType._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    removeDefault() {\n        return this._def.innerType;\n    }\n}\nZodDefault.create = (type, params) => {\n    return new ZodDefault({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodDefault,\n        defaultValue: typeof params.default === \"function\" ? params.default : () => params.default,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodCatch extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        // newCtx is used to not collect issues from inner types in ctx\n        const newCtx = {\n            ...ctx,\n            common: {\n                ...ctx.common,\n                issues: [],\n            },\n        };\n        const result = this._def.innerType._parse({\n            data: newCtx.data,\n            path: newCtx.path,\n            parent: {\n                ...newCtx,\n            },\n        });\n        if (isAsync(result)) {\n            return result.then((result) => {\n                return {\n                    status: \"valid\",\n                    value: result.status === \"valid\"\n                        ? result.value\n                        : this._def.catchValue({\n                            get error() {\n                                return new ZodError(newCtx.common.issues);\n                            },\n                            input: newCtx.data,\n                        }),\n                };\n            });\n        }\n        else {\n            return {\n                status: \"valid\",\n                value: result.status === \"valid\"\n                    ? result.value\n                    : this._def.catchValue({\n                        get error() {\n                            return new ZodError(newCtx.common.issues);\n                        },\n                        input: newCtx.data,\n                    }),\n            };\n        }\n    }\n    removeCatch() {\n        return this._def.innerType;\n    }\n}\nZodCatch.create = (type, params) => {\n    return new ZodCatch({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodCatch,\n        catchValue: typeof params.catch === \"function\" ? params.catch : () => params.catch,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNaN extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.nan) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.nan,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n}\nZodNaN.create = (params) => {\n    return new ZodNaN({\n        typeName: ZodFirstPartyTypeKind.ZodNaN,\n        ...processCreateParams(params),\n    });\n};\nexport const BRAND = Symbol(\"zod_brand\");\nexport class ZodBranded extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const data = ctx.data;\n        return this._def.type._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    unwrap() {\n        return this._def.type;\n    }\n}\nexport class ZodPipeline extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.common.async) {\n            const handleAsync = async () => {\n                const inResult = await this._def.in._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inResult.status === \"aborted\")\n                    return INVALID;\n                if (inResult.status === \"dirty\") {\n                    status.dirty();\n                    return DIRTY(inResult.value);\n                }\n                else {\n                    return this._def.out._parseAsync({\n                        data: inResult.value,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                }\n            };\n            return handleAsync();\n        }\n        else {\n            const inResult = this._def.in._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n            if (inResult.status === \"aborted\")\n                return INVALID;\n            if (inResult.status === \"dirty\") {\n                status.dirty();\n                return {\n                    status: \"dirty\",\n                    value: inResult.value,\n                };\n            }\n            else {\n                return this._def.out._parseSync({\n                    data: inResult.value,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n            }\n        }\n    }\n    static create(a, b) {\n        return new ZodPipeline({\n            in: a,\n            out: b,\n            typeName: ZodFirstPartyTypeKind.ZodPipeline,\n        });\n    }\n}\nexport class ZodReadonly extends ZodType {\n    _parse(input) {\n        const result = this._def.innerType._parse(input);\n        const freeze = (data) => {\n            if (isValid(data)) {\n                data.value = Object.freeze(data.value);\n            }\n            return data;\n        };\n        return isAsync(result) ? result.then((data) => freeze(data)) : freeze(result);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodReadonly.create = (type, params) => {\n    return new ZodReadonly({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodReadonly,\n        ...processCreateParams(params),\n    });\n};\n////////////////////////////////////////\n////////////////////////////////////////\n//////////                    //////////\n//////////      z.custom      //////////\n//////////                    //////////\n////////////////////////////////////////\n////////////////////////////////////////\nfunction cleanParams(params, data) {\n    const p = typeof params === \"function\" ? params(data) : typeof params === \"string\" ? { message: params } : params;\n    const p2 = typeof p === \"string\" ? { message: p } : p;\n    return p2;\n}\nexport function custom(check, _params = {}, \n/**\n * @deprecated\n *\n * Pass `fatal` into the params object instead:\n *\n * ```ts\n * z.string().custom((val) => val.length > 5, { fatal: false })\n * ```\n *\n */\nfatal) {\n    if (check)\n        return ZodAny.create().superRefine((data, ctx) => {\n            const r = check(data);\n            if (r instanceof Promise) {\n                return r.then((r) => {\n                    if (!r) {\n                        const params = cleanParams(_params, data);\n                        const _fatal = params.fatal ?? fatal ?? true;\n                        ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n                    }\n                });\n            }\n            if (!r) {\n                const params = cleanParams(_params, data);\n                const _fatal = params.fatal ?? fatal ?? true;\n                ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n            }\n            return;\n        });\n    return ZodAny.create();\n}\nexport { ZodType as Schema, ZodType as ZodSchema };\nexport const late = {\n    object: ZodObject.lazycreate,\n};\nexport var ZodFirstPartyTypeKind;\n(function (ZodFirstPartyTypeKind) {\n    ZodFirstPartyTypeKind[\"ZodString\"] = \"ZodString\";\n    ZodFirstPartyTypeKind[\"ZodNumber\"] = \"ZodNumber\";\n    ZodFirstPartyTypeKind[\"ZodNaN\"] = \"ZodNaN\";\n    ZodFirstPartyTypeKind[\"ZodBigInt\"] = \"ZodBigInt\";\n    ZodFirstPartyTypeKind[\"ZodBoolean\"] = \"ZodBoolean\";\n    ZodFirstPartyTypeKind[\"ZodDate\"] = \"ZodDate\";\n    ZodFirstPartyTypeKind[\"ZodSymbol\"] = \"ZodSymbol\";\n    ZodFirstPartyTypeKind[\"ZodUndefined\"] = \"ZodUndefined\";\n    ZodFirstPartyTypeKind[\"ZodNull\"] = \"ZodNull\";\n    ZodFirstPartyTypeKind[\"ZodAny\"] = \"ZodAny\";\n    ZodFirstPartyTypeKind[\"ZodUnknown\"] = \"ZodUnknown\";\n    ZodFirstPartyTypeKind[\"ZodNever\"] = \"ZodNever\";\n    ZodFirstPartyTypeKind[\"ZodVoid\"] = \"ZodVoid\";\n    ZodFirstPartyTypeKind[\"ZodArray\"] = \"ZodArray\";\n    ZodFirstPartyTypeKind[\"ZodObject\"] = \"ZodObject\";\n    ZodFirstPartyTypeKind[\"ZodUnion\"] = \"ZodUnion\";\n    ZodFirstPartyTypeKind[\"ZodDiscriminatedUnion\"] = \"ZodDiscriminatedUnion\";\n    ZodFirstPartyTypeKind[\"ZodIntersection\"] = \"ZodIntersection\";\n    ZodFirstPartyTypeKind[\"ZodTuple\"] = \"ZodTuple\";\n    ZodFirstPartyTypeKind[\"ZodRecord\"] = \"ZodRecord\";\n    ZodFirstPartyTypeKind[\"ZodMap\"] = \"ZodMap\";\n    ZodFirstPartyTypeKind[\"ZodSet\"] = \"ZodSet\";\n    ZodFirstPartyTypeKind[\"ZodFunction\"] = \"ZodFunction\";\n    ZodFirstPartyTypeKind[\"ZodLazy\"] = \"ZodLazy\";\n    ZodFirstPartyTypeKind[\"ZodLiteral\"] = \"ZodLiteral\";\n    ZodFirstPartyTypeKind[\"ZodEnum\"] = \"ZodEnum\";\n    ZodFirstPartyTypeKind[\"ZodEffects\"] = \"ZodEffects\";\n    ZodFirstPartyTypeKind[\"ZodNativeEnum\"] = \"ZodNativeEnum\";\n    ZodFirstPartyTypeKind[\"ZodOptional\"] = \"ZodOptional\";\n    ZodFirstPartyTypeKind[\"ZodNullable\"] = \"ZodNullable\";\n    ZodFirstPartyTypeKind[\"ZodDefault\"] = \"ZodDefault\";\n    ZodFirstPartyTypeKind[\"ZodCatch\"] = \"ZodCatch\";\n    ZodFirstPartyTypeKind[\"ZodPromise\"] = \"ZodPromise\";\n    ZodFirstPartyTypeKind[\"ZodBranded\"] = \"ZodBranded\";\n    ZodFirstPartyTypeKind[\"ZodPipeline\"] = \"ZodPipeline\";\n    ZodFirstPartyTypeKind[\"ZodReadonly\"] = \"ZodReadonly\";\n})(ZodFirstPartyTypeKind || (ZodFirstPartyTypeKind = {}));\n// requires TS 4.4+\nclass Class {\n    constructor(..._) { }\n}\nconst instanceOfType = (\n// const instanceOfType = <T extends new (...args: any[]) => any>(\ncls, params = {\n    message: `Input not instance of ${cls.name}`,\n}) => custom((data) => data instanceof cls, params);\nconst stringType = ZodString.create;\nconst numberType = ZodNumber.create;\nconst nanType = ZodNaN.create;\nconst bigIntType = ZodBigInt.create;\nconst booleanType = ZodBoolean.create;\nconst dateType = ZodDate.create;\nconst symbolType = ZodSymbol.create;\nconst undefinedType = ZodUndefined.create;\nconst nullType = ZodNull.create;\nconst anyType = ZodAny.create;\nconst unknownType = ZodUnknown.create;\nconst neverType = ZodNever.create;\nconst voidType = ZodVoid.create;\nconst arrayType = ZodArray.create;\nconst objectType = ZodObject.create;\nconst strictObjectType = ZodObject.strictCreate;\nconst unionType = ZodUnion.create;\nconst discriminatedUnionType = ZodDiscriminatedUnion.create;\nconst intersectionType = ZodIntersection.create;\nconst tupleType = ZodTuple.create;\nconst recordType = ZodRecord.create;\nconst mapType = ZodMap.create;\nconst setType = ZodSet.create;\nconst functionType = ZodFunction.create;\nconst lazyType = ZodLazy.create;\nconst literalType = ZodLiteral.create;\nconst enumType = ZodEnum.create;\nconst nativeEnumType = ZodNativeEnum.create;\nconst promiseType = ZodPromise.create;\nconst effectsType = ZodEffects.create;\nconst optionalType = ZodOptional.create;\nconst nullableType = ZodNullable.create;\nconst preprocessType = ZodEffects.createWithPreprocess;\nconst pipelineType = ZodPipeline.create;\nconst ostring = () => stringType().optional();\nconst onumber = () => numberType().optional();\nconst oboolean = () => booleanType().optional();\nexport const coerce = {\n    string: ((arg) => ZodString.create({ ...arg, coerce: true })),\n    number: ((arg) => ZodNumber.create({ ...arg, coerce: true })),\n    boolean: ((arg) => ZodBoolean.create({\n        ...arg,\n        coerce: true,\n    })),\n    bigint: ((arg) => ZodBigInt.create({ ...arg, coerce: true })),\n    date: ((arg) => ZodDate.create({ ...arg, coerce: true })),\n};\nexport { anyType as any, arrayType as array, bigIntType as bigint, booleanType as boolean, dateType as date, discriminatedUnionType as discriminatedUnion, effectsType as effect, enumType as enum, functionType as function, instanceOfType as instanceof, intersectionType as intersection, lazyType as lazy, literalType as literal, mapType as map, nanType as nan, nativeEnumType as nativeEnum, neverType as never, nullType as null, nullableType as nullable, numberType as number, objectType as object, oboolean, onumber, optionalType as optional, ostring, pipelineType as pipeline, preprocessType as preprocess, promiseType as promise, recordType as record, setType as set, strictObjectType as strictObject, stringType as string, symbolType as symbol, effectsType as transformer, tupleType as tuple, undefinedType as undefined, unionType as union, unknownType as unknown, voidType as void, };\nexport const NEVER = INVALID;\n", "import { z } from \"zod\";\n\n/**\n * Canonical day key: YYYY-MM-DD\n */\nexport const dayKeySchema = z\n  .string()\n  .regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Invalid day format. Expected YYYY-MM-DD.\");\n\nexport type DayKey = z.infer<typeof dayKeySchema>;\n\nexport const dayQuerySchema = z.object({\n  day: dayKeySchema,\n});\n\nexport type DayQuery = z.infer<typeof dayQuerySchema>;\n", "// lib/contracts/rawEvent.ts\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\n// -----------------------------\n// Primitives\n// -----------------------------\n\nexport const ymdDateStringSchema = z\n  .string()\n  .regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Invalid YYYY-MM-DD\");\n\nexport const isoDateTimeStringSchema = z\n  .string()\n  .min(1)\n  .refine((v) => !Number.isNaN(Date.parse(v)), \"Invalid ISO datetime string\");\n\n// NOTE: Keep provider/sourceType flexible for future integrations,\n// but keep the *payload+kind* strict to what Functions + Phase 1 support today.\nexport const rawEventSchemaVersionSchema = z.literal(1);\n\n/**\n * Phase 2 \u2014 Uncertainty state at event level.\n * Must be visible at event/day/timeline. Never silently upgraded.\n */\nexport const uncertaintyStateSchema = z.enum([\"complete\", \"incomplete\", \"uncertain\"]);\nexport type UncertaintyState = z.infer<typeof uncertaintyStateSchema>;\n\n/**\n * Phase 2 \u2014 Provenance/source of the event.\n * Backfill = logged after the fact; recordedAt differs from occurredAt.\n */\nexport const provenanceSchema = z.enum([\"manual\", \"device\", \"upload\", \"backfill\", \"correction\"]);\nexport type Provenance = z.infer<typeof provenanceSchema>;\n\n/**\n * Phase 2 \u2014 occurredAt: exact ISO datetime OR time window/range.\n * Never fake precision. Approximate time remains visible as approximate.\n */\nexport const occurredAtExactSchema = isoDateTimeStringSchema;\nexport const occurredAtRangeSchema = z\n  .object({\n    start: isoDateTimeStringSchema,\n    end: isoDateTimeStringSchema,\n  })\n  .strip()\n  .refine((r) => Date.parse(r.start) <= Date.parse(r.end), {\n    message: \"Range start must be <= end\",\n  });\nexport const occurredAtSchema = z.union([occurredAtExactSchema, occurredAtRangeSchema]);\nexport type OccurredAt = z.infer<typeof occurredAtSchema>;\n\n/**\n * Phase 2 \u2014 recordedAt: exact ISO datetime when the event was logged.\n * For backfill: recordedAt = now, occurredAt = past.\n */\nexport const recordedAtSchema = isoDateTimeStringSchema;\n\n/**\n * RawEvent kinds are the ingestion boundary taxonomy.\n *\n * Phase 1 rule:\n * - Canonical kinds exist here (sleep/steps/...)\n * - \"file\" is memory-only (upload artifact), not canonical, not normalized yet.\n *\n * Phase 2:\n * - \"incomplete\" is memory-only: \"something happened, details later\".\n */\nexport const rawEventKindSchema = z.enum([\n  \"sleep\",\n  \"steps\",\n  \"workout\",\n  \"weight\",\n  \"hrv\",\n  \"nutrition\",\n  \"strength_workout\",\n  \"file\",\n  \"incomplete\",\n]);\n\n/**\n * POST /ingest accepted response (shared by weight, strength_workout, etc.)\n */\nexport const ingestAcceptedResponseDtoSchema = z\n  .object({\n    ok: z.literal(true),\n    rawEventId: z.string().min(1),\n    day: dayKeySchema.optional(),\n    idempotentReplay: z.literal(true).optional(),\n  })\n  .strip();\n\nexport type IngestAcceptedResponseDto = z.infer<typeof ingestAcceptedResponseDtoSchema>;\n\n// -----------------------------\n// Payloads\n// -----------------------------\n\nconst manualWindowBaseSchema = z\n  .object({\n    start: isoDateTimeStringSchema,\n    end: isoDateTimeStringSchema,\n    timezone: z.string().min(1),\n    // day is optional; server derives dayKey canonically, but we may store it for convenience/backcompat\n    day: ymdDateStringSchema.optional(),\n  })\n  .strip();\n\n// Manual payloads (canonicalizable)\nconst manualSleepPayloadSchema = manualWindowBaseSchema\n  .extend({\n    totalMinutes: z.number().finite().nonnegative(),\n    efficiency: z.number().finite().min(0).max(1).nullable().optional(),\n    latencyMinutes: z.number().finite().nonnegative().nullable().optional(),\n    awakenings: z.number().finite().nonnegative().nullable().optional(),\n    isMainSleep: z.boolean(),\n  })\n  .strip();\n\nconst manualStepsPayloadSchema = manualWindowBaseSchema\n  .extend({\n    steps: z.number().finite().nonnegative(),\n    distanceKm: z.number().finite().nonnegative().nullable().optional(),\n    moveMinutes: z.number().finite().nonnegative().nullable().optional(),\n  })\n  .strip();\n\nconst manualWorkoutPayloadSchema = manualWindowBaseSchema\n  .extend({\n    sport: z.string().min(1),\n    intensity: z.enum([\"easy\", \"moderate\", \"hard\"]).optional(),\n    durationMinutes: z.number().finite().positive(),\n    trainingLoad: z.number().finite().nonnegative().nullable().optional(),\n  })\n  .strip();\n\nconst manualWeightPayloadSchema = z\n  .object({\n    time: isoDateTimeStringSchema,\n    timezone: z.string().min(1),\n    day: ymdDateStringSchema.optional(),\n    weightKg: z.number().finite().positive(),\n    bodyFatPercent: z.number().finite().min(0).max(100).nullable().optional(),\n  })\n  .strip();\n\nconst manualHrvPayloadSchema = z\n  .object({\n    time: isoDateTimeStringSchema,\n    timezone: z.string().min(1),\n    day: ymdDateStringSchema.optional(),\n    rmssdMs: z.number().finite().nonnegative().nullable().optional(),\n    sdnnMs: z.number().finite().nonnegative().nullable().optional(),\n    measurementType: z.enum([\"nightly\", \"spot\"]).optional(),\n  })\n  .strip();\n\nconst manualNutritionPayloadSchema = manualWindowBaseSchema\n  .extend({\n    totalKcal: z.number().finite().nonnegative(),\n    proteinG: z.number().finite().nonnegative(),\n    carbsG: z.number().finite().nonnegative(),\n    fatG: z.number().finite().nonnegative(),\n    fiberG: z.number().finite().nonnegative().nullable().optional(),\n  })\n  .strip();\n\nconst strengthWorkoutSetSchema = z\n  .object({\n    reps: z.number().finite().int().nonnegative(),\n    load: z.number().finite().nonnegative(),\n    unit: z.enum([\"lb\", \"kg\"]),\n    isWarmup: z.boolean().optional(),\n    rpe: z.number().finite().min(0).max(10).optional(),\n    rir: z.number().finite().min(0).max(10).optional(),\n    notes: z.string().max(256).optional(),\n  })\n  .strip()\n  .refine((s) => !(s.rpe !== undefined && s.rir !== undefined), {\n    message: \"rpe and rir cannot both be present\",\n  });\n\nconst strengthWorkoutExerciseSchema = z\n  .object({\n    name: z.string().min(1),\n    sets: z.array(strengthWorkoutSetSchema).min(1),\n  })\n  .strip();\n\nconst manualStrengthWorkoutPayloadSchema = z\n  .object({\n    startedAt: isoDateTimeStringSchema,\n    timeZone: z.string().min(1),\n    exercises: z.array(strengthWorkoutExerciseSchema).min(1),\n  })\n  .strip();\n\n/**\n * Phase 1: file upload artifact (NO parsing)\n *\n * Required properties:\n * - storageBucket + storagePath: verifiable reference to stored bytes\n * - sha256 + sizeBytes: integrity + replay/debug\n * - mimeType + originalFilename: user meaning + future parsing\n */\nconst manualFilePayloadSchema = z\n  .object({\n    storageBucket: z.string().min(1),\n    storagePath: z.string().min(1),\n    sha256: z.string().min(1),\n    sizeBytes: z.number().finite().int().nonnegative(),\n    mimeType: z.string().min(1),\n    originalFilename: z.string().min(1),\n  })\n  .strip();\n\n/**\n * Phase 2 \u2014 Incomplete event payload.\n * \"Something happened\" \u2014 minimal friction, no forced guessing.\n */\nconst manualIncompletePayloadSchema = z\n  .object({\n    note: z.string().max(256).optional(),\n  })\n  .strip();\n\n// Payload union keyed by kind (root kind controls payload choice)\nconst payloadByKindSchema = {\n  sleep: manualSleepPayloadSchema,\n  steps: manualStepsPayloadSchema,\n  workout: manualWorkoutPayloadSchema,\n  weight: manualWeightPayloadSchema,\n  hrv: manualHrvPayloadSchema,\n  nutrition: manualNutritionPayloadSchema,\n  strength_workout: manualStrengthWorkoutPayloadSchema,\n  file: manualFilePayloadSchema,\n  incomplete: manualIncompletePayloadSchema,\n} as const;\n\n// -----------------------------\n// RawEvent Firestore document\n// -----------------------------\n\nconst rawEventBaseSchema = z\n  .object({\n    schemaVersion: rawEventSchemaVersionSchema,\n    id: z.string().min(1),\n    userId: z.string().min(1),\n    sourceId: z.string().min(1),\n    provider: z.string().min(1),\n    sourceType: z.string().min(1),\n    kind: rawEventKindSchema,\n    receivedAt: isoDateTimeStringSchema,\n    observedAt: isoDateTimeStringSchema,\n    payload: z.unknown(),\n    // Phase 2 \u2014 optional; never silently upgrade uncertainty\n    recordedAt: isoDateTimeStringSchema.optional(),\n    occurredAt: occurredAtSchema.optional(),\n    provenance: provenanceSchema.optional(),\n    uncertaintyState: uncertaintyStateSchema.optional(),\n    contentUnknown: z.boolean().optional(),\n    // Phase 2 \u2014 correction provenance; original record is never overwritten\n    correctionOfRawEventId: z.string().min(1).optional(),\n  })\n  .strip();\n\n/**\n * Authoritative RawEvent Firestore document schema.\n *\n * - Validates root metadata\n * - Validates payload shape based on `kind`\n * - Keeps provider/sourceType flexible for future integrations\n */\nexport const rawEventDocSchema = rawEventBaseSchema.superRefine((val, ctx) => {\n  const kind = val.kind;\n  const payloadSchema = payloadByKindSchema[kind];\n\n  const parsed = payloadSchema.safeParse(val.payload);\n  if (!parsed.success) {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: `Invalid payload for kind=\"${kind}\"`,\n    });\n\n    // Attach flattened payload errors to improve logs/debugging\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: JSON.stringify(parsed.error.flatten()),\n    });\n  }\n});\n\nexport type RawEventDoc = z.infer<typeof rawEventBaseSchema> & {\n  payload:\n    | z.infer<typeof manualSleepPayloadSchema>\n    | z.infer<typeof manualStepsPayloadSchema>\n    | z.infer<typeof manualWorkoutPayloadSchema>\n    | z.infer<typeof manualWeightPayloadSchema>\n    | z.infer<typeof manualHrvPayloadSchema>\n    | z.infer<typeof manualNutritionPayloadSchema>\n    | z.infer<typeof manualStrengthWorkoutPayloadSchema>\n    | z.infer<typeof manualFilePayloadSchema>\n    | z.infer<typeof manualIncompletePayloadSchema>;\n};\n\n/**\n * Secondary export: payload schemas keyed by canonical kind.\n * This avoids naming collisions with other contract modules.\n */\nexport const rawEventPayloadByKindSchemas = {\n  sleep: manualSleepPayloadSchema,\n  steps: manualStepsPayloadSchema,\n  workout: manualWorkoutPayloadSchema,\n  weight: manualWeightPayloadSchema,\n  hrv: manualHrvPayloadSchema,\n  nutrition: manualNutritionPayloadSchema,\n  strength_workout: manualStrengthWorkoutPayloadSchema,\n  file: manualFilePayloadSchema,\n  incomplete: manualIncompletePayloadSchema,\n} as const;\n", "// lib/contracts/dailyFacts.ts\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\nconst confidenceSchema = z.record(z.string(), z.number().finite().min(0).max(1)).optional();\n\n// NOTE: meta.* is the readiness contract surface.\n// We keep top-level computedAt for backwards compatibility.\nconst computeMetaSchema = z\n  .object({\n    computedAt: isoString,\n    pipelineVersion: z.number().int().positive(),\n    source: z.record(z.string(), z.unknown()).optional(),\n  })\n  .strip();\n\nexport const dailyFactsDtoSchema = z\n  .object({\n    schemaVersion: z.literal(1),\n    userId: z.string().min(1),\n    date: dayKeySchema,\n\n    // existing\n    computedAt: isoString,\n\n    // new (contract)\n    meta: computeMetaSchema.optional(),\n\n    sleep: z.object({ totalMinutes: z.number().finite().optional() }).strip().optional(),\n    activity: z\n      .object({\n        steps: z.number().finite().optional(),\n        distanceKm: z.number().finite().optional(),\n        moveMinutes: z.number().finite().optional(),\n        trainingLoad: z.number().finite().optional(),\n      })\n      .strip()\n      .optional(),\n    recovery: z\n      .object({\n        hrvRmssd: z.number().finite().optional(),\n        hrvRmssdBaseline: z.number().finite().optional(),\n        hrvRmssdDeviation: z.number().finite().optional(),\n      })\n      .strip()\n      .optional(),\n    body: z\n      .object({\n        weightKg: z.number().finite().optional(),\n        bodyFatPercent: z.number().finite().optional(),\n      })\n      .strip()\n      .optional(),\n    nutrition: z\n      .object({\n        totalKcal: z.number().finite().optional(),\n        proteinG: z.number().finite().optional(),\n        carbsG: z.number().finite().optional(),\n        fatG: z.number().finite().optional(),\n      })\n      .strip()\n      .optional(),\n    strength: z\n      .object({\n        workoutsCount: z.number().int().nonnegative(),\n        totalSets: z.number().int().nonnegative(),\n        totalReps: z.number().int().nonnegative(),\n        totalVolumeByUnit: z.object({\n          lb: z.number().finite().nonnegative().optional(),\n          kg: z.number().finite().nonnegative().optional(),\n        }),\n      })\n      .strip()\n      .optional(),\n\n    confidence: confidenceSchema,\n  })\n  .strip();\n\nexport type DailyFactsDto = z.infer<typeof dailyFactsDtoSchema>;\n", "// lib/contracts/intelligenceContext.ts\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\nconst confidenceSchema = z.record(z.string(), z.number().finite().min(0).max(1)).optional();\n\nconst computeMetaSchema = z\n  .object({\n    computedAt: isoString,\n    pipelineVersion: z.number().int().positive(),\n    source: z.record(z.string(), z.unknown()).optional(),\n  })\n  .strip();\n\nexport const intelligenceContextDtoSchema = z\n  .object({\n    schemaVersion: z.literal(1),\n    version: z.string().min(1),\n\n    id: dayKeySchema,\n    userId: z.string().min(1),\n    date: dayKeySchema,\n\n    // existing\n    computedAt: isoString,\n\n    // new (contract)\n    meta: computeMetaSchema.optional(),\n\n    confidence: confidenceSchema,\n\n    facts: z\n      .object({\n        sleepTotalMinutes: z.number().finite().optional(),\n        steps: z.number().finite().optional(),\n        trainingLoad: z.number().finite().optional(),\n        hrvRmssd: z.number().finite().optional(),\n        hrvRmssdBaseline: z.number().finite().optional(),\n        hrvRmssdDeviation: z.number().finite().optional(),\n        weightKg: z.number().finite().optional(),\n        bodyFatPercent: z.number().finite().optional(),\n      })\n      .strip(),\n\n    insights: z\n      .object({\n        count: z.number().int(),\n        severities: z.record(z.string(), z.number().int()).optional(),\n        tags: z.array(z.string()),\n        kinds: z.array(z.string()),\n        ids: z.array(z.string()),\n      })\n      .strip(),\n\n    readiness: z\n      .object({\n        hasDailyFacts: z.boolean(),\n        hasInsights: z.boolean(),\n        domainMeetsConfidence: z.record(z.string(), z.boolean()).optional(),\n      })\n      .strip(),\n  })\n  .strip();\n\nexport type IntelligenceContextDto = z.infer<typeof intelligenceContextDtoSchema>;\n", "import { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\n\nexport const insightSeveritySchema = z.enum([\"info\", \"warning\", \"critical\"]);\n\nexport const insightEvidencePointDtoSchema = z\n  .object({\n    factPath: z.string().min(1),\n    value: z.union([z.number(), z.string(), z.boolean(), z.null()]),\n    threshold: z.number().optional(),\n    direction: z.enum([\"above\", \"below\", \"outside_range\"]).optional(),\n  })\n  .strip();\n\nexport const insightDtoSchema = z\n  .object({\n    schemaVersion: z.literal(1),\n    id: z.string().min(1),\n    userId: z.string().min(1),\n    date: dayKeySchema,\n    kind: z.string().min(1),\n    title: z.string().min(1),\n    message: z.string().min(1),\n    severity: insightSeveritySchema,\n    evidence: z.array(insightEvidencePointDtoSchema),\n    tags: z.array(z.string()).optional(),\n    createdAt: isoString,\n    updatedAt: isoString,\n    ruleVersion: z.string().min(1),\n  })\n  .strip();\n\nexport type InsightDto = z.infer<typeof insightDtoSchema>;\n\nexport const insightsResponseDtoSchema = z\n  .object({\n    day: dayKeySchema,\n    count: z.number().int().nonnegative(),\n    items: z.array(insightDtoSchema),\n  })\n  .strip();\n\nexport type InsightsResponseDto = z.infer<typeof insightsResponseDtoSchema>;\n", "// lib/contracts/derivedLedger.ts\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\nimport { dailyFactsDtoSchema } from \"./dailyFacts\";\nimport { intelligenceContextDtoSchema } from \"./intelligenceContext\";\nimport { insightsResponseDtoSchema } from \"./insights\";\n\nconst isoString = z.string().min(1);\n\nconst triggerSchema = z.union([\n  z\n    .object({\n      type: z.literal(\"realtime\"),\n      name: z.literal(\"onCanonicalEventCreated\"),\n      eventId: z.string().min(1),\n    })\n    .strip(),\n  z\n    .object({\n      type: z.literal(\"realtime\"),\n      name: z.literal(\"onRawEventCreated_factOnly\"),\n      eventId: z.string().min(1),\n    })\n    .strip(),\n  z\n    .object({\n      type: z.literal(\"scheduled\"),\n      name: z.string().min(1),\n      eventId: z.string().min(1),\n    })\n    .strip(),\n]);\n\nexport const derivedLedgerRunSummaryDtoSchema = z\n  .object({\n    schemaVersion: z.literal(1),\n    runId: z.string().min(1),\n    userId: z.string().min(1),\n    date: dayKeySchema,\n    computedAt: isoString,\n    pipelineVersion: z.number().int().positive(),\n    trigger: triggerSchema,\n    latestCanonicalEventAt: isoString.optional(),\n    outputs: z\n      .object({\n        hasDailyFacts: z.boolean(),\n        insightsCount: z.number().int().nonnegative(),\n        hasIntelligenceContext: z.boolean(),\n      })\n      .strip(),\n    createdAt: isoString, // API-normalized\n  })\n  .strip();\n\nexport type DerivedLedgerRunSummaryDto = z.infer<typeof derivedLedgerRunSummaryDtoSchema>;\n\nexport const derivedLedgerRunsResponseDtoSchema = z\n  .object({\n    day: dayKeySchema,\n    latestRunId: z.string().min(1).optional(),\n    runs: z.array(derivedLedgerRunSummaryDtoSchema),\n  })\n  .strip();\n\nexport type DerivedLedgerRunsResponseDto = z.infer<typeof derivedLedgerRunsResponseDtoSchema>;\n\nexport const derivedLedgerReplayResponseDtoSchema = z\n  .object({\n    day: dayKeySchema,\n    runId: z.string().min(1),\n    computedAt: isoString,\n    pipelineVersion: z.number().int().positive(),\n    trigger: triggerSchema,\n    latestCanonicalEventAt: isoString.optional(),\n\n    // Snapshots (nullable when missing)\n    dailyFacts: dailyFactsDtoSchema.optional(),\n    intelligenceContext: intelligenceContextDtoSchema.optional(),\n    insights: insightsResponseDtoSchema.optional(),\n  })\n  .strip();\n\nexport type DerivedLedgerReplayResponseDto = z.infer<typeof derivedLedgerReplayResponseDtoSchema>;\n", "// lib/contracts/dayTruth.ts\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\n\nexport const dayTruthDtoSchema = z\n  .object({\n    day: dayKeySchema,\n    eventsCount: z.number().int().nonnegative(),\n    latestCanonicalEventAt: isoString.nullable(),\n  })\n  .strip();\n\nexport type DayTruthDto = z.infer<typeof dayTruthDtoSchema>;\n", "// lib/contracts/failure.ts\n\n/**\n * Failure Memory DTOs (read-only UI surface).\n *\n * Source of truth: API runtime DTO validation (services/api).\n * Client must not invent semantics beyond these fields.\n */\n\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\n\nexport const failureDetailsDtoSchema = z.record(z.string(), z.unknown()).nullable();\nexport type FailureDetailsDto = z.infer<typeof failureDetailsDtoSchema>;\n\nexport const failureListItemDtoSchema = z\n  .object({\n    id: z.string().min(1),\n    type: z.string().min(1),\n    code: z.string().min(1),\n    message: z.string().min(1),\n    day: dayKeySchema,\n    createdAt: isoString,\n    timeZone: z.string().min(1).optional(),\n    observedAt: isoString.optional(),\n    rawEventId: z.string().min(1).optional(),\n    rawEventPath: z.string().min(1).optional(),\n    details: failureDetailsDtoSchema.optional(),\n  })\n  .strip();\n\nexport type FailureListItemDto = z.infer<typeof failureListItemDtoSchema>;\n\nexport const failureListResponseDtoSchema = z\n  .object({\n    items: z.array(failureListItemDtoSchema),\n    nextCursor: z.string().nullable(),\n  })\n  .strip();\n\nexport type FailureListResponseDto = z.infer<typeof failureListResponseDtoSchema>;\n", "import { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\n\n// Raw manual payload written into RawEvent payload.\n// NOTE: Server remains authoritative for day (it will compute/override).\nexport const manualWeightPayloadSchema = z\n  .object({\n    time: isoString,\n    timezone: z.string().min(1),\n\n    // Back-compat: some deployed APIs may still require day.\n    // We include it when present, but server should compute it itself.\n    day: dayKeySchema.optional(),\n\n    weightKg: z.number().finite().positive(),\n    bodyFatPercent: z.number().finite().min(0).max(100).nullable().optional(),\n  })\n  .strip();\n\nexport type ManualWeightPayload = z.infer<typeof manualWeightPayloadSchema>;\n\n// DTOs for POST /users/me/body/weight\nexport const logWeightRequestDtoSchema = manualWeightPayloadSchema;\nexport type LogWeightRequestDto = z.infer<typeof logWeightRequestDtoSchema>;\n\nexport const logWeightResponseDtoSchema = z\n  .object({\n    ok: z.literal(true),\n    rawEventId: z.string().min(1),\n    day: dayKeySchema,\n  })\n  .strip();\n\nexport type LogWeightResponseDto = z.infer<typeof logWeightResponseDtoSchema>;\n", "// lib/contracts/preferences.ts\nimport { z } from \"zod\";\n\nexport const massUnitSchema = z.enum([\"lb\", \"kg\"]);\nexport type MassUnit = z.infer<typeof massUnitSchema>;\n\nexport const timezoneModeSchema = z.enum([\"recorded\", \"current\", \"explicit\"]);\nexport type TimezoneMode = z.infer<typeof timezoneModeSchema>;\n\n/**\n * Phase 1 view preferences.\n *\n * Invariants:\n * - Preferences only affect presentation (units/timezone bucketing).\n * - Canonical truth remains stored in canonical units (e.g., kg) and immutable day keys.\n */\nexport const preferencesSchema = z\n  .object({\n    units: z\n      .object({\n        mass: massUnitSchema,\n      })\n      .strip(),\n\n    timezone: z\n      .object({\n        mode: timezoneModeSchema,\n        // Required only when mode === \"explicit\"\n        explicitIana: z.string().min(1).optional(),\n      })\n      .strip(),\n  })\n  .strip()\n  .superRefine((val, ctx) => {\n    if (val.timezone.mode === \"explicit\" && !val.timezone.explicitIana) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        path: [\"timezone\", \"explicitIana\"],\n        message: \"explicitIana is required when timezone.mode is 'explicit'\",\n      });\n    }\n  });\n\nexport type Preferences = z.infer<typeof preferencesSchema>;\n\n/**\n * Phase 1 defaults.\n *\n * Product decision:\n * - US-default weight display uses pounds.\n */\nexport const defaultPreferences = (): Preferences => ({\n  units: { mass: \"lb\" },\n  timezone: { mode: \"recorded\" },\n});\n", "// lib/contracts/labResults.ts\nimport { z } from \"zod\";\n\nconst isoDatetimeString = z.string().datetime();\n\nexport const biomarkerReadingDtoSchema = z\n  .object({\n    name: z.string().min(1),\n    value: z.number().finite(),\n    unit: z.string().min(1),\n  })\n  .strip();\n\nexport const labResultDtoSchema = z\n  .object({\n    schemaVersion: z.literal(1),\n    id: z.string().min(1),\n    userId: z.string().min(1),\n    collectedAt: isoDatetimeString,\n    sourceRawEventId: z.string().min(1).optional(),\n    biomarkers: z.array(biomarkerReadingDtoSchema).min(1),\n    createdAt: isoDatetimeString,\n    updatedAt: isoDatetimeString,\n  })\n  .strip();\n\nexport const labResultsListResponseDtoSchema = z\n  .object({\n    ok: z.literal(true),\n    items: z.array(labResultDtoSchema),\n    nextCursor: z.string().nullable(),\n  })\n  .strip();\n\nexport const createLabResultRequestDtoSchema = z\n  .object({\n    collectedAt: isoDatetimeString,\n    sourceRawEventId: z.string().min(1).optional(),\n    biomarkers: z.array(biomarkerReadingDtoSchema).min(1),\n  })\n  .strip();\n\nexport const createLabResultResponseDtoSchema = z\n  .object({\n    ok: z.literal(true),\n    id: z.string().min(1),\n    idempotentReplay: z.literal(true).optional(),\n  })\n  .strip();\n\nexport type BiomarkerReadingDto = z.infer<typeof biomarkerReadingDtoSchema>;\nexport type LabResultDto = z.infer<typeof labResultDtoSchema>;\nexport type LabResultsListResponseDto = z.infer<typeof labResultsListResponseDtoSchema>;\nexport type CreateLabResultRequestDto = z.infer<typeof createLabResultRequestDtoSchema>;\nexport type CreateLabResultResponseDto = z.infer<typeof createLabResultResponseDtoSchema>;\n", "// lib/contracts/retrieval.ts\n/**\n * Sprint 1 \u2014 Retrieval Surfaces (Library Backbone)\n *\n * Zod schemas for list/query endpoints:\n * - GET /users/me/raw-events\n * - GET /users/me/events\n * - GET /users/me/timeline\n * - GET /users/me/lineage\n */\n\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\nimport {\n  rawEventKindSchema,\n  uncertaintyStateSchema,\n  provenanceSchema,\n} from \"./rawEvent\";\n\nconst isoDateTimeSchema = z\n  .string()\n  .min(1)\n  .refine((v) => !Number.isNaN(Date.parse(v)), \"Invalid ISO datetime string\");\n\n// -----------------------------\n// RawEvent list item (minimal for list/query)\n// -----------------------------\n\nexport const rawEventListItemSchema = z\n  .object({\n    id: z.string().min(1),\n    userId: z.string().min(1),\n    sourceId: z.string().min(1),\n    kind: rawEventKindSchema,\n    observedAt: isoDateTimeSchema,\n    receivedAt: isoDateTimeSchema,\n    schemaVersion: z.literal(1),\n    // Phase 2 \u2014 uncertainty visibility\n    recordedAt: isoDateTimeSchema.optional(),\n    provenance: provenanceSchema.optional(),\n    uncertaintyState: uncertaintyStateSchema.optional(),\n    contentUnknown: z.boolean().optional(),\n    // Phase 2 \u2014 correction provenance\n    correctionOfRawEventId: z.string().min(1).optional(),\n  })\n  .strip();\n\nexport type RawEventListItem = z.infer<typeof rawEventListItemSchema>;\n\nexport const rawEventsListResponseDtoSchema = z\n  .object({\n    items: z.array(rawEventListItemSchema),\n    nextCursor: z.string().nullable(),\n  })\n  .strip();\n\nexport type RawEventsListResponseDto = z.infer<typeof rawEventsListResponseDtoSchema>;\n\n// -----------------------------\n// CanonicalEvent list item\n// Source: mapRawEventToCanonical.ts / writeCanonicalEventImmutable.ts\n// observedAt semantic for canonical = start (primary time)\n// -----------------------------\n\nexport const canonicalEventKindSchema = z.enum([\n  \"sleep\",\n  \"steps\",\n  \"workout\",\n  \"weight\",\n  \"hrv\",\n  \"nutrition\",\n  \"strength_workout\",\n]);\n\nexport const canonicalEventListItemSchema = z\n  .object({\n    id: z.string().min(1),\n    userId: z.string().min(1),\n    sourceId: z.string().min(1),\n    kind: canonicalEventKindSchema,\n    start: isoDateTimeSchema,\n    end: isoDateTimeSchema,\n    day: dayKeySchema,\n    timezone: z.string().min(1),\n    createdAt: isoDateTimeSchema,\n    updatedAt: isoDateTimeSchema,\n    schemaVersion: z.literal(1),\n  })\n  .strip();\n\nexport type CanonicalEventListItem = z.infer<typeof canonicalEventListItemSchema>;\n\nexport const canonicalEventsListResponseDtoSchema = z\n  .object({\n    items: z.array(canonicalEventListItemSchema),\n    nextCursor: z.string().nullable(),\n  })\n  .strip();\n\nexport type CanonicalEventsListResponseDto = z.infer<typeof canonicalEventsListResponseDtoSchema>;\n\n// -----------------------------\n// Timeline day summary\n// -----------------------------\n\n/** Phase 2 \u2014 Day completeness state for truth visibility */\nexport const dayCompletenessStateSchema = z.enum([\n  \"complete\",\n  \"partial\",\n  \"incomplete\",\n  \"empty\",\n]);\nexport type DayCompletenessState = z.infer<typeof dayCompletenessStateSchema>;\n\n/** Phase 2 \u2014 Rollup of uncertainty states present in the day (complete | incomplete | uncertain) */\nexport const uncertaintyStateRollupSchema = z\n  .object({\n    hasComplete: z.boolean().optional(),\n    hasIncomplete: z.boolean().optional(),\n    hasUncertain: z.boolean().optional(),\n  })\n  .strip();\n\nexport type UncertaintyStateRollup = z.infer<typeof uncertaintyStateRollupSchema>;\n\n/**\n * Sprint 3 \u2014 Deterministic missing reasons (\"what's missing\") for completeness explanation.\n * Human-readable strings, deterministic ordering, computed on server.\n */\nexport const missingReasonsSchema = z.array(z.string().min(1)).default([]);\nexport type MissingReasons = z.infer<typeof missingReasonsSchema>;\n\nexport const timelineDaySchema = z\n  .object({\n    day: dayKeySchema,\n    canonicalCount: z.number().int().nonnegative(),\n    hasDailyFacts: z.boolean(),\n    hasInsights: z.boolean(),\n    hasIntelligenceContext: z.boolean(),\n    hasDerivedLedger: z.boolean(),\n    // Phase 2 \u2014 uncertainty visibility at day level\n    incompleteCount: z.number().int().nonnegative().optional(),\n    hasIncompleteEvents: z.boolean().optional(),\n    dayCompletenessState: dayCompletenessStateSchema.optional(),\n    uncertaintyStateRollup: uncertaintyStateRollupSchema.optional(),\n    // Sprint 3 \u2014 deterministic \"what's missing\" (human-readable, server-computed)\n    missingReasons: missingReasonsSchema.optional(),\n  })\n  .strip();\n\nexport type TimelineDay = z.infer<typeof timelineDaySchema>;\n\nexport const timelineResponseDtoSchema = z\n  .object({\n    days: z.array(timelineDaySchema),\n  })\n  .strip();\n\nexport type TimelineResponseDto = z.infer<typeof timelineResponseDtoSchema>;\n\n// -----------------------------\n// Lineage: raw \u2192 canonical \u2192 derived mapping\n// -----------------------------\n\nexport const lineageResponseDtoSchema = z\n  .object({\n    rawEventIds: z.array(z.string().min(1)),\n    canonicalEventId: z.string().min(1).nullable(),\n    derivedLedgerRuns: z.array(\n      z.object({\n        day: dayKeySchema,\n        runId: z.string().min(1),\n        computedAt: isoDateTimeSchema,\n      }),\n    ),\n  })\n  .strip();\n\nexport type LineageResponseDto = z.infer<typeof lineageResponseDtoSchema>;\n\n// -----------------------------\n// Query param schemas (fail-closed)\n// -----------------------------\n\n/** start/end: YYYY-MM-DD or ISO datetime */\nconst dayOrIsoSchema = z\n  .string()\n  .min(1)\n  .refine(\n    (v) =>\n      /^\\d{4}-\\d{2}-\\d{2}$/.test(v) || !Number.isNaN(Date.parse(v)),\n    \"Must be YYYY-MM-DD or valid ISO datetime\",\n  );\n\nexport const rawEventsListQuerySchema = z\n  .object({\n    start: dayOrIsoSchema.optional(),\n    end: dayOrIsoSchema.optional(),\n    kinds: z\n      .string()\n      .optional()\n      .transform((v) => (v ? v.split(\",\").map((k) => k.trim()).filter(Boolean) : undefined)),\n    // Phase 2 \u2014 Library search filters (deterministic)\n    provenance: z\n      .string()\n      .optional()\n      .transform((v) => (v ? v.split(\",\").map((k) => k.trim()).filter(Boolean) : undefined)),\n    uncertaintyState: z\n      .string()\n      .optional()\n      .transform((v) => (v ? v.split(\",\").map((k) => k.trim()).filter(Boolean) : undefined)),\n    q: z.string().optional(), // keyword: filters payload.note for incomplete; id substring\n    cursor: z.string().optional(),\n    limit: z.coerce.number().int().min(1).max(100).default(50),\n  })\n  .strip();\n\nexport const canonicalEventsListQuerySchema = z\n  .object({\n    start: dayOrIsoSchema.optional(),\n    end: dayOrIsoSchema.optional(),\n    kinds: z\n      .string()\n      .optional()\n      .transform((v) => (v ? v.split(\",\").map((k) => k.trim()).filter(Boolean) : undefined)),\n    cursor: z.string().optional(),\n    limit: z.coerce.number().int().min(1).max(100).default(50),\n  })\n  .strip();\n\nexport const timelineQuerySchema = z\n  .object({\n    start: dayKeySchema,\n    end: dayKeySchema,\n  })\n  .strip();\n\nexport const lineageQuerySchema = z\n  .object({\n    canonicalEventId: z.string().min(1).optional(),\n    day: dayKeySchema.optional(),\n    kind: z.string().min(1).optional(),\n    observedAt: isoDateTimeSchema.optional(),\n  })\n  .strip()\n  .refine(\n    (v) => {\n      if (v.canonicalEventId) return true;\n      return !!(v.day && v.kind && v.observedAt);\n    },\n    { message: \"Must provide canonicalEventId OR (day + kind + observedAt)\" },\n  );\n", "// lib/contracts/uploads.ts\n/**\n * Uploads presence (read-only UI surface).\n * GET /users/me/uploads\n */\nimport { z } from \"zod\";\n\nconst isoString = z.string().min(1);\n\nexport const uploadsPresenceLatestDtoSchema = z\n  .object({\n    rawEventId: z.string().min(1),\n    observedAt: isoString,\n    receivedAt: isoString,\n    originalFilename: z.string().min(1).optional(),\n    mimeType: z.string().min(1).optional(),\n  })\n  .strip();\n\nexport const uploadsPresenceResponseDtoSchema = z\n  .object({\n    ok: z.literal(true),\n    count: z.number().int().nonnegative(),\n    latest: uploadsPresenceLatestDtoSchema.nullable(),\n  })\n  .strip();\n\nexport type UploadsPresenceLatestDto = z.infer<typeof uploadsPresenceLatestDtoSchema>;\nexport type UploadsPresenceResponseDto = z.infer<typeof uploadsPresenceResponseDtoSchema>;\n", "/**\n * Phase 1 Lock #3 \u2014 Canonical readiness vocabulary.\n *\n * The readiness vocabulary is exactly: missing | partial | ready | error\n *\n * All readiness-producing code MUST use these values. No drift.\n * CI blocks: loading, empty, invalid, not-ready, unknown, unready, pending, coming_soon.\n */\nimport { z } from \"zod\";\n\nexport const readinessSchema = z.enum([\"missing\", \"partial\", \"ready\", \"error\"]);\nexport type Readiness = z.infer<typeof readinessSchema>;\n\nexport const CANONICAL_READINESS_VALUES: readonly Readiness[] = [\"missing\", \"partial\", \"ready\", \"error\"];\n\nexport const DISALLOWED_READINESS_STRINGS = [\n  \"loading\",\n  \"empty\",\n  \"invalid\",\n  \"not-ready\",\n  \"unknown\",\n  \"unready\",\n  \"pending\",\n  \"coming_soon\",\n] as const;\n", "/**\n * Phase 1 Lock #6 \u2014 Canonical export job model.\n *\n * Export lifecycle: queued \u2192 running \u2192 succeeded | failed\n */\nimport { z } from \"zod\";\n\nexport const exportJobStatusSchema = z.enum([\"queued\", \"running\", \"succeeded\", \"failed\"]);\nexport type ExportJobStatus = z.infer<typeof exportJobStatusSchema>;\n\nexport const exportRequestResponseDtoSchema = z.object({\n  ok: z.literal(true),\n  status: z.enum([\"queued\"]),\n  requestId: z.string().min(1),\n});\nexport type ExportRequestResponseDto = z.infer<typeof exportRequestResponseDtoSchema>;\n\nexport const exportJobArtifactSchema = z.object({\n  artifactId: z.string().min(1),\n  contentType: z.string().min(1),\n  sizeBytes: z.number().int().nonnegative().nullable(),\n  schemaVersion: z.number().int().positive().optional(),\n});\nexport type ExportJobArtifact = z.infer<typeof exportJobArtifactSchema>;\n\nexport const exportJobDocSchema = z.object({\n  uid: z.string().min(1),\n  requestId: z.string().min(1),\n  requestedAt: z.string().nullable(),\n  status: exportJobStatusSchema,\n  updatedAt: z.unknown().optional(),\n  artifact: exportJobArtifactSchema.optional(),\n  error: z.string().optional(),\n  completedAt: z.unknown().optional(),\n  startedAt: z.unknown().optional(),\n});\nexport type ExportJobDoc = z.infer<typeof exportJobDocSchema>;\n\nexport const exportArtifactPayloadSchema = z.object({\n  schemaVersion: z.number().int().positive(),\n  kind: z.string().min(1),\n  uid: z.string().min(1),\n  requestId: z.string().min(1),\n  requestedAt: z.string().nullable(),\n  generatedAt: z.string(),\n  data: z.object({\n    profile: z.unknown().optional(),\n    collections: z.record(z.array(z.record(z.unknown()))),\n  }),\n});\nexport type ExportArtifactPayload = z.infer<typeof exportArtifactPayloadSchema>;\n", "// lib/contracts/healthScore.ts\n// Phase 1.5 Sprint 1 \u2014 Health Score Model v1.0 (derived truth contract)\n\nimport { z } from \"zod\";\nimport { dayKeySchema } from \"./day\";\n\nconst isoString = z.string().min(1);\n\nexport const healthScoreTierSchema = z.enum([\"excellent\", \"good\", \"fair\", \"poor\"]);\nexport type HealthScoreTier = z.infer<typeof healthScoreTierSchema>;\n\nexport const healthScoreStatusSchema = z.enum([\n  \"stable\",\n  \"attention_required\",\n  \"insufficient_data\",\n]);\nexport type HealthScoreStatus = z.infer<typeof healthScoreStatusSchema>;\n\nconst domainScoreSchema = z\n  .object({\n    score: z.number().min(0).max(100),\n    tier: healthScoreTierSchema,\n    missing: z.array(z.string()),\n  })\n  .strip();\n\nexport const healthScoreDomainScoresSchema = z\n  .object({\n    recovery: domainScoreSchema,\n    training: domainScoreSchema,\n    nutrition: domainScoreSchema,\n    body: domainScoreSchema,\n  })\n  .strip();\n\nconst inputsSummarySchema = z\n  .object({\n    hasDailyFacts: z.boolean(),\n    historyDaysUsed: z.number().int().nonnegative(),\n  })\n  .strip();\n\n/**\n * Health Score document schema (users/{uid}/healthScores/{dayKey}).\n * Server-computed only; client read-only.\n */\nexport const healthScoreDocSchema = z\n  .object({\n    schemaVersion: z.literal(1),\n    modelVersion: z.literal(\"1.0\"),\n    date: dayKeySchema,\n    compositeScore: z.number().min(0).max(100),\n    compositeTier: healthScoreTierSchema,\n    domainScores: healthScoreDomainScoresSchema,\n    status: healthScoreStatusSchema,\n    computedAt: isoString,\n    pipelineVersion: z.number().int().positive(),\n    inputs: inputsSummarySchema,\n  })\n  .strip();\n\nexport type HealthScoreDoc = z.infer<typeof healthScoreDocSchema>;\nexport type HealthScoreDomainScores = z.infer<typeof healthScoreDomainScoresSchema>;\n", "// services/functions/src/validation/rawEvent.ts\n\nimport type { RawEvent } from \"../types/health\";\nimport { rawEventDocSchema } from \"@oli/contracts\";\n\n/**\n * Backwards-compatible parser result for existing pipeline callers.\n * (Your code expects `parsed.value`.)\n */\nexport type ParseRawEventResult =\n  | { ok: true; value: RawEvent }\n  | { ok: false; reason: \"INVALID_RAW_EVENT_CONTRACT\"; issues: unknown };\n\n/**\n * Contract-first validation:\n * - Validates raw Firestore doc against authoritative schema\n * - Prevents drift/corruption\n */\nexport const parseRawEventContract = (data: unknown) => {\n  const parsed = rawEventDocSchema.safeParse(data);\n  if (!parsed.success) {\n    return { ok: false as const, issues: parsed.error.flatten() };\n  }\n  return { ok: true as const, data: parsed.data };\n};\n\n/**\n * \u2705 Compatibility wrapper used throughout the functions pipeline.\n * Keeps the rest of the pipeline unchanged while enforcing the contract.\n */\nexport const parseRawEvent = (data: unknown): ParseRawEventResult => {\n  const contract = parseRawEventContract(data);\n  if (!contract.ok) {\n    return { ok: false, reason: \"INVALID_RAW_EVENT_CONTRACT\", issues: contract.issues };\n  }\n\n  return { ok: true, value: contract.data as RawEvent };\n};\n", "// services/functions/src/normalization/writeCanonicalEventImmutable.ts\n\nimport crypto from \"node:crypto\"; // \u2705 ADD\nimport * as logger from \"firebase-functions/logger\";\nimport { admin, db } from \"../firebaseAdmin\";\nimport type { CanonicalEvent } from \"../types/health\";\nimport { canonicalEquals, canonicalHash } from \"./canonicalImmutability\";\n\nexport type WriteCanonicalResult =\n  | { ok: true; mode: \"created\" | \"identical_noop\" }\n  | {\n      ok: false;\n      mode: \"conflict\";\n      existingHash: string;\n      incomingHash: string;\n      integrityViolationPath: string;\n    };\n\nfunction deterministicIntegrityViolationId(input: {\n  userId: string;\n  canonicalId: string;\n  sourceRawEventId: string;\n  existingHash: string;\n  incomingHash: string;\n}): string {\n  // Deterministic, replay-safe doc id:\n  // retries/duplicate triggers will attempt to create the same doc id and\n  // therefore cannot spam integrity evidence.\n  const payload = JSON.stringify(input);\n  return crypto.createHash(\"sha256\").update(payload).digest(\"hex\");\n}\n\nexport async function writeCanonicalEventImmutable(params: {\n  userId: string;\n  canonical: CanonicalEvent;\n  sourceRawEventId: string;\n  sourceRawEventPath: string;\n}): Promise<WriteCanonicalResult> {\n  const { userId, canonical, sourceRawEventId, sourceRawEventPath } = params;\n\n  const ref = db.collection(\"users\").doc(userId).collection(\"events\").doc(canonical.id);\n\n  return db.runTransaction(async (tx) => {\n    const snap = await tx.get(ref);\n\n    if (!snap.exists) {\n      tx.create(ref, canonical);\n      return { ok: true, mode: \"created\" } as const;\n    }\n\n    const existing = snap.data() as CanonicalEvent;\n\n    if (canonicalEquals(existing, canonical)) {\n      return { ok: true, mode: \"identical_noop\" } as const;\n    }\n\n    const existingHash = canonicalHash(existing);\n    const incomingHash = canonicalHash(canonical);\n\n    logger.error(\"Canonical immutability violation: attempted overwrite with different content\", {\n      userId,\n      canonicalId: canonical.id,\n      sourceRawEventId,\n      sourceRawEventPath,\n      existingHash,\n      incomingHash,\n    });\n\n    const integrityId = deterministicIntegrityViolationId({\n      userId,\n      canonicalId: canonical.id,\n      sourceRawEventId,\n      existingHash,\n      incomingHash,\n    });\n\n    const integrityRef = db\n      .collection(\"users\")\n      .doc(userId)\n      .collection(\"integrityViolations\")\n      .doc(integrityId);\n\n    // Create-only evidence. If the same conflict is retried, doc already exists -> tx.create fails.\n    // We treat that as \"evidence already recorded\" and still return conflict.\n    try {\n      tx.create(integrityRef, {\n        type: \"CANONICAL_IMMUTABILITY_CONFLICT\" as const,\n        userId,\n        canonicalId: canonical.id,\n        sourceRawEventId,\n        sourceRawEventPath,\n        existingHash,\n        incomingHash,\n        createdAt: admin.firestore.FieldValue.serverTimestamp(),\n      });\n    } catch {\n      // NOTE: Firestore will throw at commit time if doc exists.\n      // We intentionally do not branch on it here; the caller still receives conflict.\n      // The evidence is either created now or already existed.\n    }\n\n    return {\n      ok: false,\n      mode: \"conflict\",\n      existingHash,\n      incomingHash,\n      integrityViolationPath: integrityRef.path,\n    } as const;\n  });\n}", "// services/functions/src/normalization/canonicalImmutability.ts\n\nimport crypto from \"node:crypto\";\nimport type { CanonicalEvent } from \"../types/health\";\n\n/**\n * Stable stringify for deterministic hashing/comparison.\n * - Sorts object keys recursively\n * - Preserves array order\n */\nexport function stableStringify(value: unknown): string {\n  if (value === null) return \"null\";\n\n  const t = typeof value;\n\n  if (t === \"string\" || t === \"number\" || t === \"boolean\") {\n    return JSON.stringify(value);\n  }\n\n  if (Array.isArray(value)) {\n    return `[${value.map(stableStringify).join(\",\")}]`;\n  }\n\n  if (t === \"object\") {\n    const obj = value as Record<string, unknown>;\n    const keys = Object.keys(obj).sort();\n    const parts = keys.map((k) => `${JSON.stringify(k)}:${stableStringify(obj[k])}`);\n    return `{${parts.join(\",\")}}`;\n  }\n\n  // symbols/functions/undefined shouldn't appear in CanonicalEvent; stringify safely anyway\n  return JSON.stringify(String(value));\n}\n\nexport function canonicalHash(canonical: CanonicalEvent): string {\n  const s = stableStringify(canonical);\n  return crypto.createHash(\"sha256\").update(s).digest(\"hex\");\n}\n\nexport function canonicalEquals(a: CanonicalEvent, b: CanonicalEvent): boolean {\n  // Fast path via stable stringify (deterministic)\n  return stableStringify(a) === stableStringify(b);\n}\n", "// services/functions/src/ingestion/rawEventDedupe.ts\n\nimport { createHash } from \"crypto\";\nimport * as logger from \"firebase-functions/logger\";\nimport { admin, db } from \"../firebaseAdmin\";\nimport { stableStringify } from \"./stableJson\";\nimport { parseRawEventContract } from \"../validation/rawEvent\";\n\ntype ContractRawEvent = Extract<\n  ReturnType<typeof parseRawEventContract>,\n  { ok: true }\n>[\"data\"];\n\ntype DedupeIndexDoc = {\n  dedupeId: string;\n  firstRawEventId: string;\n  provider: string;\n  sourceType: string;\n  sourceId: string;\n  kind: ContractRawEvent[\"kind\"];\n  observedAt: string;\n  payloadHash: string;\n  createdAt: admin.firestore.FieldValue;\n};\n\nfunction sha256Hex(input: string): string {\n  return createHash(\"sha256\").update(input).digest(\"hex\");\n}\n\nfunction computePayloadHash(raw: ContractRawEvent): string {\n  // Phase 1: file payload includes sha256 of stored bytes \u2014 use that directly.\n  if (raw.kind === \"file\") {\n    const p = raw.payload as { sha256: string };\n    return p.sha256;\n  }\n  // Deterministic hash of validated payload object\n  return sha256Hex(stableStringify(raw.payload));\n}\n\nfunction computeDedupeId(raw: ContractRawEvent, payloadHash: string): string {\n  // Tight tuple: provider + sourceType + sourceId + kind + observedAt + payloadHash\n  return sha256Hex(\n    [\n      raw.provider,\n      raw.sourceType,\n      raw.sourceId,\n      raw.kind,\n      raw.observedAt,\n      payloadHash,\n    ].join(\"|\"),\n  );\n}\n\nexport async function upsertRawEventDedupeEvidence(params: {\n  userId: string;\n  rawEvent: unknown; // accept unknown and validate contract-first inside\n}): Promise<\n  | { ok: true; mode: \"first_seen\"; dedupeId: string; payloadHash: string }\n  | {\n      ok: true;\n      mode: \"duplicate\";\n      dedupeId: string;\n      payloadHash: string;\n      firstRawEventId: string;\n      integrityViolationPath: string;\n    }\n  | { ok: false; reason: \"INVALID_RAW_EVENT_CONTRACT\" }\n> {\n  const { userId, rawEvent } = params;\n\n  const parsed = parseRawEventContract(rawEvent);\n  if (!parsed.ok) {\n    // Do not throw; caller decides whether to drop/log. We just signal invalid.\n    return { ok: false, reason: \"INVALID_RAW_EVENT_CONTRACT\" } as const;\n  }\n\n  const evt = parsed.data;\n\n  const payloadHash = computePayloadHash(evt);\n  const dedupeId = computeDedupeId(evt, payloadHash);\n\n  const dedupeRef = db\n    .collection(\"users\")\n    .doc(userId)\n    .collection(\"ingestionDedupe\")\n    .doc(dedupeId);\n\n  const integrityRef = db\n    .collection(\"users\")\n    .doc(userId)\n    .collection(\"integrityViolations\")\n    .doc();\n\n  return db.runTransaction(async (tx) => {\n    const existing = await tx.get(dedupeRef);\n\n    if (!existing.exists) {\n      const doc: DedupeIndexDoc = {\n        dedupeId,\n        firstRawEventId: evt.id,\n        provider: evt.provider,\n        sourceType: evt.sourceType,\n        sourceId: evt.sourceId,\n        kind: evt.kind,\n        observedAt: evt.observedAt,\n        payloadHash,\n        createdAt: admin.firestore.FieldValue.serverTimestamp(),\n      };\n\n      tx.create(dedupeRef, doc);\n      return { ok: true, mode: \"first_seen\", dedupeId, payloadHash } as const;\n    }\n\n    const firstRawEventId =\n      (existing.data() as { firstRawEventId?: string }).firstRawEventId ??\n      \"UNKNOWN\";\n\n    tx.create(integrityRef, {\n      type: \"RAW_EVENT_DUPLICATE\" as const,\n      userId,\n      dedupeId,\n      firstRawEventId,\n      duplicateRawEventId: evt.id,\n      provider: evt.provider,\n      sourceType: evt.sourceType,\n      sourceId: evt.sourceId,\n      kind: evt.kind,\n      observedAt: evt.observedAt,\n      payloadHash,\n      createdAt: admin.firestore.FieldValue.serverTimestamp(),\n    });\n\n    logger.warn(\"RawEvent duplicate detected (semantic duplicate tuple + payloadHash)\", {\n      userId,\n      dedupeId,\n      firstRawEventId,\n      duplicateRawEventId: evt.id,\n      provider: evt.provider,\n      sourceType: evt.sourceType,\n      sourceId: evt.sourceId,\n      kind: evt.kind,\n      observedAt: evt.observedAt,\n      payloadHash,\n      integrityViolationPath: integrityRef.path,\n    });\n\n    return {\n      ok: true,\n      mode: \"duplicate\",\n      dedupeId,\n      payloadHash,\n      firstRawEventId,\n      integrityViolationPath: integrityRef.path,\n    } as const;\n  });\n}", "// services/functions/src/ingestion/stableJson.ts\n\n/**\n * Deterministic JSON stringify with stable key ordering.\n * Purpose: hashing payloads for replay/duplicate detection.\n * Note: Zod payload schemas use .strip(), so payloads should already be plain data.\n */\nexport function stableStringify(value: unknown): string {\n    return JSON.stringify(sortRecursively(value));\n  }\n  \n  function sortRecursively(value: unknown): unknown {\n    if (Array.isArray(value)) {\n      return value.map(sortRecursively);\n    }\n    if (value && typeof value === \"object\") {\n      const obj = value as Record<string, unknown>;\n      const keys = Object.keys(obj).sort();\n      const out: Record<string, unknown> = {};\n      for (const k of keys) out[k] = sortRecursively(obj[k]);\n      return out;\n    }\n    return value;\n  }", "// services/functions/src/failures/writeFailureImmutable.ts\n\nimport crypto from \"node:crypto\";\nimport { admin, db } from \"../firebaseAdmin\";\nimport { stableStringify } from \"../ingestion/stableJson\";\n\n/**\n * Failure source: which subsystem produced the failure.\n */\nexport type FailureSource = \"ingestion\" | \"normalization\" | \"pipeline\";\n\n/**\n * Input for writing an immutable failure record.\n * details must be bounded and safe (no raw payload dumps, no tokens).\n */\nexport type FailureInput = {\n  userId: string;\n  source: FailureSource;\n  stage: string;\n  reasonCode: string;\n  message: string;\n  day: string; // YYYY-MM-DD\n  rawEventId?: string;\n  canonicalEventId?: string;\n  requestId?: string;\n  /** Bounded, safe details (no secrets, no raw payloads) */\n  details?: Record<string, unknown>;\n};\n\ntype FailureDoc = FailureInput & {\n  createdAt: unknown;\n};\n\n/**\n * Deterministic failureId from identity tuple.\n * Same tuple => same id (idempotent create-or-assert).\n */\nfunction computeFailureId(input: FailureInput): string {\n  const tuple = {\n    userId: input.userId,\n    source: input.source,\n    stage: input.stage,\n    reasonCode: input.reasonCode,\n    day: input.day,\n    rawEventId: input.rawEventId ?? null,\n    canonicalEventId: input.canonicalEventId ?? null,\n    requestId: input.requestId ?? null,\n  };\n  const serialized = stableStringify(tuple);\n  return crypto.createHash(\"sha256\").update(serialized).digest(\"hex\").slice(0, 32);\n}\n\n/**\n * Write an immutable failure record.\n * Create-or-assert-identical: if doc exists and identical => no-op.\n * If exists and different => create second record with suffix hash (never overwrite).\n */\nexport async function writeFailureImmutable(\n  ctx: { requestId?: string },\n  input: FailureInput,\n): Promise<{ id: string }> {\n  const baseId = computeFailureId(input);\n  const failuresRef = db.collection(\"users\").doc(input.userId).collection(\"failures\");\n\n  const doc: FailureDoc = {\n    ...input,\n    createdAt: admin.firestore.FieldValue.serverTimestamp(),\n  };\n\n  const baseRef = failuresRef.doc(baseId);\n\n  return db.runTransaction(async (tx) => {\n    const snap = await tx.get(baseRef);\n\n    if (!snap.exists) {\n      tx.create(baseRef, doc);\n      return { id: baseId };\n    }\n\n    const existing = snap.data() as FailureDoc;\n    const incomingStable = stableStringify({\n      ...input,\n      createdAt: null,\n    });\n    const existingStable = stableStringify({\n      ...existing,\n      createdAt: null,\n    });\n\n    if (incomingStable === existingStable) {\n      return { id: baseId };\n    }\n\n    // Exists and different: create second record with suffix (never overwrite)\n    const suffixPayload = stableStringify({\n      ...input,\n      existingCreatedAt: existing.createdAt,\n      attemptAt: new Date().toISOString(),\n    });\n\n    const suffixHash = crypto.createHash(\"sha256\").update(suffixPayload).digest(\"hex\").slice(0, 8);\n    const altId = `${baseId}_${suffixHash}`;\n    const altRef = failuresRef.doc(altId);\n\n    tx.create(altRef, doc);\n    return { id: altId };\n  });\n}\n", "// services/functions/src/dailyFacts/aggregateDailyFacts.ts\n\nimport type {\n  CanonicalEvent,\n  DailyFacts,\n  DailyActivityFacts,\n  DailyBodyFacts,\n  DailyRecoveryFacts,\n  DailySleepFacts,\n  DailyStrengthFacts,\n  IsoDateTimeString,\n  YmdDateString,\n  SleepCanonicalEvent,\n  StepsCanonicalEvent,\n  WorkoutCanonicalEvent,\n  WeightCanonicalEvent,\n  HrvCanonicalEvent,\n  StrengthWorkoutCanonicalEvent,\n} from '../types/health';\n\nconst isNumber = (value: unknown): value is number =>\n  typeof value === 'number' && Number.isFinite(value);\n\nconst average = (values: number[]): number | undefined => {\n  if (values.length === 0) return undefined;\n  const sum = values.reduce((acc, v) => acc + v, 0);\n  return sum / values.length;\n};\n\n// -----------------------------------------------------------------------------\n// Kind filters (keeps downstream code fully typed)\n// -----------------------------------------------------------------------------\n\nconst isSleepEvent = (e: CanonicalEvent): e is SleepCanonicalEvent => e.kind === 'sleep';\nconst isStepsEvent = (e: CanonicalEvent): e is StepsCanonicalEvent => e.kind === 'steps';\nconst isWorkoutEvent = (e: CanonicalEvent): e is WorkoutCanonicalEvent => e.kind === 'workout';\nconst isWeightEvent = (e: CanonicalEvent): e is WeightCanonicalEvent => e.kind === 'weight';\nconst isHrvEvent = (e: CanonicalEvent): e is HrvCanonicalEvent => e.kind === 'hrv';\nconst isStrengthWorkoutEvent = (\n  e: CanonicalEvent,\n): e is StrengthWorkoutCanonicalEvent => e.kind === 'strength_workout';\n\n// -----------------------------------------------------------------------------\n// Builders\n// -----------------------------------------------------------------------------\n\nconst buildSleepFacts = (events: CanonicalEvent[]): DailySleepFacts | undefined => {\n  const sleepEvents = events.filter(isSleepEvent);\n  if (sleepEvents.length === 0) return undefined;\n\n  const facts: DailySleepFacts = {};\n\n  const totalMinutes = sleepEvents.reduce((sum, e) => sum + e.totalMinutes, 0);\n  if (totalMinutes > 0) {\n    facts.totalMinutes = totalMinutes;\n  }\n\n  const mainSleepMinutes = sleepEvents.reduce(\n    (sum, e) => (e.isMainSleep ? sum + e.totalMinutes : sum),\n    0,\n  );\n  if (mainSleepMinutes > 0) {\n    facts.mainSleepMinutes = mainSleepMinutes;\n  }\n\n  const efficiencies = sleepEvents.map((e) => e.efficiency).filter(isNumber);\n  const avgEff = average(efficiencies);\n  if (avgEff !== undefined) {\n    facts.efficiency = avgEff;\n  }\n\n  const latencies = sleepEvents.map((e) => e.latencyMinutes).filter(isNumber);\n  const avgLatency = average(latencies);\n  if (avgLatency !== undefined) {\n    facts.latencyMinutes = avgLatency;\n  }\n\n  const awakenings = sleepEvents\n    .map((e) => e.awakenings)\n    .filter(isNumber)\n    .reduce((sum, v) => sum + v, 0);\n\n  if (awakenings > 0) {\n    facts.awakenings = awakenings;\n  }\n\n  return Object.keys(facts).length > 0 ? facts : undefined;\n};\n\nconst buildActivityFacts = (events: CanonicalEvent[]): DailyActivityFacts | undefined => {\n  const stepsEvents = events.filter(isStepsEvent);\n  const workoutEvents = events.filter(isWorkoutEvent);\n\n  if (stepsEvents.length === 0 && workoutEvents.length === 0) return undefined;\n\n  const facts: DailyActivityFacts = {};\n\n  const steps = stepsEvents.reduce((sum, e) => sum + e.steps, 0);\n  if (steps > 0) {\n    facts.steps = steps;\n  }\n\n  const distanceKm = stepsEvents\n    .map((e) => e.distanceKm)\n    .filter(isNumber)\n    .reduce((sum, v) => sum + v, 0);\n  if (distanceKm > 0) {\n    facts.distanceKm = distanceKm;\n  }\n\n  const moveMinutes = stepsEvents\n    .map((e) => e.moveMinutes)\n    .filter(isNumber)\n    .reduce((sum, v) => sum + v, 0);\n  if (moveMinutes > 0) {\n    facts.moveMinutes = moveMinutes;\n  }\n\n  const trainingLoad = workoutEvents\n    .map((e) => e.trainingLoad)\n    .filter(isNumber)\n    .reduce((sum, v) => sum + v, 0);\n  if (trainingLoad > 0) {\n    facts.trainingLoad = trainingLoad;\n  }\n\n  return Object.keys(facts).length > 0 ? facts : undefined;\n};\n\nconst buildBodyFacts = (events: CanonicalEvent[]): DailyBodyFacts | undefined => {\n  const weightEvents = events.filter(isWeightEvent);\n  if (weightEvents.length === 0) return undefined;\n\n  // latest measurement wins (lexicographic ISO timestamp sort is safe here)\n  const latest = [...weightEvents].sort((a, b) => (a.start < b.start ? -1 : a.start > b.start ? 1 : 0))[\n    weightEvents.length - 1\n  ];\n\n  if (!latest) return undefined;\n\n  const facts: DailyBodyFacts = {\n    weightKg: latest.weightKg,\n  };\n\n  if (isNumber(latest.bodyFatPercent)) {\n    facts.bodyFatPercent = latest.bodyFatPercent;\n  }\n\n  return facts;\n};\n\nconst buildRecoveryFacts = (events: CanonicalEvent[]): DailyRecoveryFacts | undefined => {\n  const hrvEvents = events.filter(isHrvEvent);\n  if (hrvEvents.length === 0) return undefined;\n\n  const facts: DailyRecoveryFacts = {};\n\n  const rmssd = hrvEvents.map((e) => e.rmssdMs).filter(isNumber);\n  const avgRmssd = average(rmssd);\n  if (avgRmssd !== undefined) {\n    facts.hrvRmssd = avgRmssd;\n  }\n\n  // sdnnMs not promoted to DailyFacts in v1 (reserved)\n  // restingHeartRate/readinessScore reserved for future sources/rules.\n\n  return Object.keys(facts).length > 0 ? facts : undefined;\n};\n\nconst buildStrengthFacts = (\n  events: CanonicalEvent[],\n): DailyStrengthFacts | undefined => {\n  const strengthEvents = events.filter(isStrengthWorkoutEvent);\n  if (strengthEvents.length === 0) return undefined;\n\n  let totalSets = 0;\n  let totalReps = 0;\n  const totalVolumeByUnit: { lb?: number; kg?: number } = {};\n\n  for (const ev of strengthEvents) {\n    for (const set of ev.exercises) {\n      totalSets += 1;\n      totalReps += set.reps;\n      const volume = set.reps * set.load;\n      if (set.unit === 'lb') {\n        totalVolumeByUnit.lb = (totalVolumeByUnit.lb ?? 0) + volume;\n      } else {\n        totalVolumeByUnit.kg = (totalVolumeByUnit.kg ?? 0) + volume;\n      }\n    }\n  }\n\n  const facts: DailyStrengthFacts = {\n    workoutsCount: strengthEvents.length,\n    totalSets,\n    totalReps,\n    totalVolumeByUnit,\n  };\n\n  return facts;\n};\n\n// -----------------------------------------------------------------------------\n// Public API\n// -----------------------------------------------------------------------------\n\nexport interface AggregateDailyFactsInput {\n  userId: string;\n  date: YmdDateString;\n  computedAt: IsoDateTimeString;\n  events: CanonicalEvent[];\n  /**\n   * Optional body facts from fact-only raw events (e.g. weight).\n   * Used when no canonical weight events exist for the day.\n   * Constitutional: we compute derived truth from non-event inputs.\n   */\n  factOnlyBody?: DailyBodyFacts;\n}\n\n/**\n * Aggregate CanonicalEvents for a single user + day into a DailyFacts document.\n *\n * - Pure and deterministic given the input.\n * - Uses CanonicalEvents for most domains; factOnlyBody for body when no canonical weight.\n * - Safe for scheduled jobs and reprocessing pipelines.\n */\nexport const aggregateDailyFactsForDay = (input: AggregateDailyFactsInput): DailyFacts => {\n  const { userId, date, computedAt, events, factOnlyBody } = input;\n\n  const sleep = buildSleepFacts(events);\n  const activity = buildActivityFacts(events);\n  const body = buildBodyFacts(events) ?? factOnlyBody;\n  const recovery = buildRecoveryFacts(events);\n  const strength = buildStrengthFacts(events);\n\n  const dailyFacts: DailyFacts = {\n    userId,\n    date,\n    schemaVersion: 1,\n    computedAt,\n  };\n\n  if (sleep) dailyFacts.sleep = sleep;\n  if (activity) dailyFacts.activity = activity;\n  if (recovery) dailyFacts.recovery = recovery;\n  if (body) dailyFacts.body = body;\n  if (strength) dailyFacts.strength = strength;\n\n  return dailyFacts;\n};\n", "// services/functions/src/dailyFacts/enrichDailyFacts.ts\n\nimport type {\n  DailyFacts,\n  DailyActivityFacts,\n  DailyRecoveryFacts,\n  DailyDomainConfidence,\n} from '../types/health';\n\nconst isNumber = (value: unknown): value is number =>\n  typeof value === 'number' && Number.isFinite(value);\n\nconst average = (values: number[]): number | undefined => {\n  if (values.length === 0) return undefined;\n  const sum = values.reduce((acc, v) => acc + v, 0);\n  return sum / values.length;\n};\n\nexport interface EnrichDailyFactsInput {\n  /**\n   * The DailyFacts object computed for the current target date.\n   * This is the document we will enrich with baselines and rolling averages.\n   */\n  today: DailyFacts;\n\n  /**\n   * Previous DailyFacts documents for this user.\n   * Caller should ensure these represent recent days (ideally up to the last 6 days).\n   */\n  history: DailyFacts[];\n}\n\nconst hasAnyTruthyKey = (obj: Record<string, unknown> | undefined): boolean => {\n  if (!obj) return false;\n  return Object.values(obj).some((v) => v !== undefined && v !== null);\n};\n\nconst activityHasSignal = (a: DailyActivityFacts | undefined): boolean => {\n  if (!a) return false;\n  return (\n    isNumber(a.steps) ||\n    isNumber(a.distanceKm) ||\n    isNumber(a.moveMinutes) ||\n    isNumber(a.trainingLoad)\n  );\n};\n\nconst recoveryHasSignal = (r: DailyRecoveryFacts | undefined): boolean => {\n  if (!r) return false;\n  return isNumber(r.hrvRmssd) || isNumber(r.restingHeartRate) || isNumber(r.readinessScore);\n};\n\nconst clamp01 = (value: number): number => {\n  if (value < 0) return 0;\n  if (value > 1) return 1;\n  return value;\n};\n\n/**\n * Enrich a DailyFacts document with:\n * - 7-day rolling averages for steps and trainingLoad\n * - HRV baseline and relative deviation\n * - Domain-level confidence scores (0\u20131) based on 7-day coverage\n *\n * Pure + deterministic. Idempotent (overwrites derived fields).\n */\nexport const enrichDailyFactsWithBaselinesAndAverages = (\n  input: EnrichDailyFactsInput,\n): DailyFacts => {\n  const { today, history } = input;\n\n  // Shallow copy. We only create nested objects if we need to write derived fields.\n  const enriched: DailyFacts = { ...today };\n\n  // ---------------------------------------------------------------------------\n  // Rolling averages (requires at least 1 prior day)\n  // ---------------------------------------------------------------------------\n\n  const hasPrior = history.length > 0;\n  if (hasPrior) {\n    const windowFacts: DailyFacts[] = [...history, today];\n\n    const stepsValues = windowFacts\n      .map((f) => f.activity?.steps)\n      .filter(isNumber);\n\n    const trainingLoadValues = windowFacts\n      .map((f) => f.activity?.trainingLoad)\n      .filter(isNumber);\n\n    const avgSteps = average(stepsValues);\n    const avgTrainingLoad = average(trainingLoadValues);\n\n    if (avgSteps !== undefined || avgTrainingLoad !== undefined) {\n      const baseActivity: DailyActivityFacts | undefined = enriched.activity\n        ? { ...enriched.activity }\n        : undefined;\n\n      const nextActivity: DailyActivityFacts = baseActivity ?? {};\n\n      if (avgSteps !== undefined) nextActivity.stepsAvg7d = avgSteps;\n      if (avgTrainingLoad !== undefined) nextActivity.trainingLoadAvg7d = avgTrainingLoad;\n\n      enriched.activity = nextActivity;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // HRV baseline + deviation (baseline from history only)\n  // ---------------------------------------------------------------------------\n\n  const hrvHistoryValues = history\n    .map((f) => f.recovery?.hrvRmssd)\n    .filter(isNumber);\n\n  const baseline = average(hrvHistoryValues);\n\n  if (baseline !== undefined) {\n    const baseRecovery: DailyRecoveryFacts | undefined = enriched.recovery\n      ? { ...enriched.recovery }\n      : undefined;\n\n    const nextRecovery: DailyRecoveryFacts = baseRecovery ?? {};\n\n    nextRecovery.hrvRmssdBaseline = baseline;\n\n    const todayHrv = nextRecovery.hrvRmssd;\n    if (isNumber(todayHrv) && baseline !== 0) {\n      nextRecovery.hrvRmssdDeviation = (todayHrv - baseline) / baseline;\n    }\n\n    enriched.recovery = nextRecovery;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Domain-level confidence (0\u20131)\n  // - Coverage is measured over a FIXED 7-day window (Sprint 5 semantics)\n  // - Missing days count as \"no data\" (so divisor stays 7)\n  // - Presence is based on meaningful signal, not just object existence\n  // ---------------------------------------------------------------------------\n\n  const windowSize = 7;\n  const window = [...history, today].slice(-windowSize);\n\n  const computeCoverage = (isPresent: (f: DailyFacts) => boolean): number | undefined => {\n    if (window.length === 0) return undefined;\n\n    const present = window.reduce((count, f) => (isPresent(f) ? count + 1 : count), 0);\n    if (present === 0) return undefined;\n\n    return clamp01(present / windowSize);\n  };\n\n  const sleepConfidence = computeCoverage((f) =>\n    hasAnyTruthyKey(f.sleep as unknown as Record<string, unknown> | undefined),\n  );\n  const activityConfidence = computeCoverage((f) => activityHasSignal(f.activity));\n  const recoveryConfidence = computeCoverage((f) => recoveryHasSignal(f.recovery));\n  const bodyConfidence = computeCoverage((f) =>\n    hasAnyTruthyKey(f.body as unknown as Record<string, unknown> | undefined),\n  );\n\n  if (\n    sleepConfidence !== undefined ||\n    activityConfidence !== undefined ||\n    recoveryConfidence !== undefined ||\n    bodyConfidence !== undefined\n  ) {\n    const baseConfidence: DailyDomainConfidence | undefined = enriched.confidence\n      ? { ...enriched.confidence }\n      : undefined;\n\n    const nextConfidence: DailyDomainConfidence = baseConfidence ?? {};\n\n    if (sleepConfidence !== undefined) nextConfidence.sleep = sleepConfidence;\n    if (activityConfidence !== undefined) nextConfidence.activity = activityConfidence;\n    if (recoveryConfidence !== undefined) nextConfidence.recovery = recoveryConfidence;\n    if (bodyConfidence !== undefined) nextConfidence.body = bodyConfidence;\n\n    enriched.confidence = nextConfidence;\n  }\n\n  return enriched;\n};\n", "// services/functions/src/insights/intelligenceContext.ts\n\nimport type { DailyFacts, DailyDomainConfidence, YmdDateString } from '../types/health';\n\n/**\n * Sprint 6 \u2014 Intelligence Context (Facts \u2192 Insights)\n *\n * Purpose:\n * - Provide a deterministic, pure, typed context object for the Insight rules engine.\n * - Centralize confidence gating, safe numeric helpers, and common derived comparisons.\n * - Strictly uses DailyFacts as input (no Firestore/Admin/I/O).\n *\n * Notes:\n * - DailyFacts enrichment (7d avgs, HRV baselines, domain confidence) is done upstream.\n * - This context is NOT a stored schema; it is an internal, deterministic construct.\n * - This file must remain recomputable and versionable.\n */\n\nexport const INTELLIGENCE_CONTEXT_VERSION = 'intelligence-context-v1.0.0' as const;\n\n/**\n * Conservative gating threshold.\n * If a domain\u2019s confidence is below this threshold, we avoid producing insights\n * that depend on that domain (prevents low-quality / low-coverage conclusions).\n */\nexport const DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD = 0.5 as const;\n\nexport type DomainKey = keyof NonNullable<DailyFacts['confidence']>;\n\n/**\n * Input for building the intelligence context.\n * - `today` is the target date\u2019s facts (typically already enriched).\n * - `history` is recent prior days (recommended: up to 6 previous days).\n */\nexport interface BuildIntelligenceContextInput {\n  today: DailyFacts;\n  history: DailyFacts[];\n  /**\n   * Optional override for confidence gating.\n   * If omitted, DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD is used.\n   */\n  domainConfidenceThreshold?: number;\n}\n\n/**\n * The canonical context object used by insight rules.\n */\nexport interface IntelligenceContext {\n  /** Version for auditability and future migrations of logic */\n  version: typeof INTELLIGENCE_CONTEXT_VERSION;\n\n  userId: string;\n  date: YmdDateString;\n\n  /** The target day facts (source of truth for rule evaluation) */\n  today: DailyFacts;\n\n  /**\n   * Prior daily facts used for \u201Crecent history\u201D checks.\n   * Caller may pass unsorted; we normalize deterministically.\n   */\n  history: readonly DailyFacts[];\n\n  /**\n   * A normalized window containing up to 7 days: history + today.\n   * Deterministically sorted ascending by date.\n   */\n  window7d: readonly DailyFacts[];\n\n  /** Confidence gating threshold in effect */\n  domainConfidenceThreshold: number;\n\n  /** Helpers */\n  confidence: {\n    get: (domain: DomainKey) => number | undefined;\n    meetsThreshold: (domain: DomainKey) => boolean;\n  };\n\n  numbers: {\n    isFiniteNumber: (value: unknown) => value is number;\n    clamp01: (value: number) => number;\n  };\n\n  facts: {\n    sleepTotalMinutes: () => number | undefined;\n    steps: () => number | undefined;\n    trainingLoad: () => number | undefined;\n    stepsAvg7d: () => number | undefined;\n    trainingLoadAvg7d: () => number | undefined;\n\n    hrvRmssd: () => number | undefined;\n    hrvRmssdBaseline: () => number | undefined;\n    hrvRmssdDeviation: () => number | undefined;\n\n    weightKg: () => number | undefined;\n    bodyFatPercent: () => number | undefined;\n  };\n\n  comparisons: {\n    delta: (current: number | undefined, reference: number | undefined) => number | undefined;\n    ratio: (current: number | undefined, reference: number | undefined) => number | undefined;\n  };\n}\n\nconst isFiniteNumber = (value: unknown): value is number =>\n  typeof value === 'number' && Number.isFinite(value);\n\nconst clamp01 = (value: number): number => {\n  if (value < 0) return 0;\n  if (value > 1) return 1;\n  return value;\n};\n\nconst sortByDateAsc = (facts: DailyFacts[]): DailyFacts[] =>\n  [...facts].sort((a, b) => {\n    // YYYY-MM-DD string compare is safe lexicographically\n    if (a.date < b.date) return -1;\n    if (a.date > b.date) return 1;\n    return 0;\n  });\n\nconst getDomainConfidence = (\n  confidence: DailyDomainConfidence | undefined,\n  domain: DomainKey,\n): number | undefined => {\n  const value = confidence?.[domain];\n  return isFiniteNumber(value) ? clamp01(value) : undefined;\n};\n\nconst safeNumber = (value: unknown): number | undefined => (isFiniteNumber(value) ? value : undefined);\n\nconst buildWindow7d = (history: DailyFacts[], today: DailyFacts): DailyFacts[] => {\n  // Deterministically dedupe by date keeping the last occurrence per date,\n  // then ensure today is included.\n  const map = new Map<YmdDateString, DailyFacts>();\n  for (const item of history) {\n    map.set(item.date, item);\n  }\n  map.set(today.date, today);\n\n  const deduped = Array.from(map.values());\n  const sorted = sortByDateAsc(deduped);\n\n  // Keep only the most recent 7 days ending at today (if present).\n  if (sorted.length <= 7) return sorted;\n  return sorted.slice(sorted.length - 7);\n};\n\n/**\n * Build the deterministic IntelligenceContext used by insight rules.\n */\nexport const buildIntelligenceContext = (input: BuildIntelligenceContextInput): IntelligenceContext => {\n  const raw =\n    typeof input.domainConfidenceThreshold === 'number'\n      ? input.domainConfidenceThreshold\n      : DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD;\n\n  const domainConfidenceThreshold = clamp01(Number.isFinite(raw) ? raw : DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD);\n\n  const historySorted = sortByDateAsc(input.history);\n  const window7d = buildWindow7d(historySorted, input.today);\n\n  return {\n    version: INTELLIGENCE_CONTEXT_VERSION,\n    userId: input.today.userId,\n    date: input.today.date,\n    today: input.today,\n    history: historySorted,\n    window7d,\n    domainConfidenceThreshold,\n\n    confidence: {\n      get: (domain: DomainKey) => getDomainConfidence(input.today.confidence, domain),\n      meetsThreshold: (domain: DomainKey) => {\n        const score = getDomainConfidence(input.today.confidence, domain);\n        // Conservative + consistent with rules.ts:\n        // If confidence is missing, do NOT generate domain-dependent insights.\n        if (score === undefined) return false;\n        return score >= domainConfidenceThreshold;\n      },\n    },\n\n    numbers: {\n      isFiniteNumber,\n      clamp01,\n    },\n\n    facts: {\n      sleepTotalMinutes: () => safeNumber(input.today.sleep?.totalMinutes),\n      steps: () => safeNumber(input.today.activity?.steps),\n      trainingLoad: () => safeNumber(input.today.activity?.trainingLoad),\n      stepsAvg7d: () => safeNumber(input.today.activity?.stepsAvg7d),\n      trainingLoadAvg7d: () => safeNumber(input.today.activity?.trainingLoadAvg7d),\n\n      hrvRmssd: () => safeNumber(input.today.recovery?.hrvRmssd),\n      hrvRmssdBaseline: () => safeNumber(input.today.recovery?.hrvRmssdBaseline),\n      hrvRmssdDeviation: () => safeNumber(input.today.recovery?.hrvRmssdDeviation),\n\n      weightKg: () => safeNumber(input.today.body?.weightKg),\n      bodyFatPercent: () => safeNumber(input.today.body?.bodyFatPercent),\n    },\n\n    comparisons: {\n      delta: (current, reference) => {\n        if (!isFiniteNumber(current) || !isFiniteNumber(reference)) return undefined;\n        return current - reference;\n      },\n      ratio: (current, reference) => {\n        if (!isFiniteNumber(current) || !isFiniteNumber(reference)) return undefined;\n        if (reference === 0) return undefined;\n        return current / reference;\n      },\n    },\n  };\n};\n", "// services/functions/src/insights/rules.ts\n\nimport type { DailyFacts, Insight, InsightSeverity, IsoDateTimeString } from '../types/health';\nimport { buildIntelligenceContext } from './intelligenceContext';\n\n/**\n * v2 input (Sprint 6): context-aware, supports historical window.\n */\nexport interface InsightRuleInputV2 {\n  userId: string;\n  date: string; // YmdDateString (kept as string to avoid circular types)\n  today: DailyFacts;\n  history: DailyFacts[];\n  now: IsoDateTimeString;\n}\n\n/**\n * v1 input (legacy): single-day facts only.\n * We still support this so older callers don't break.\n */\nexport interface InsightRuleInputV1 {\n  userId: string;\n  date: string; // YmdDateString\n  facts: DailyFacts;\n  now: IsoDateTimeString;\n}\n\nexport type InsightRuleInput = InsightRuleInputV2 | InsightRuleInputV1;\n\nconst isV2Input = (input: InsightRuleInput): input is InsightRuleInputV2 =>\n  (input as InsightRuleInputV2).today !== undefined;\n\n/**\n * Deterministic ID for a given rule + day.\n * Ensures re-runs overwrite the same Insight document.\n */\nconst buildInsightId = (date: string, kind: string): string => `${date}_${kind}`;\n\nconst buildBaseInsight = (params: {\n  userId: string;\n  date: string;\n  now: IsoDateTimeString;\n  kind: string;\n  severity: InsightSeverity;\n  title: string;\n  message: string;\n  tags: string[];\n}): Insight => {\n  const { userId, date, now, kind, severity, title, message, tags } = params;\n  const id = buildInsightId(date, kind);\n\n  return {\n    id,\n    userId,\n    date,\n    kind,\n    title,\n    message,\n    severity,\n    evidence: [],\n    tags,\n    createdAt: now,\n    updatedAt: now,\n    // Bump because rules are evaluated through IntelligenceContext (Sprint 6)\n    ruleVersion: 'baseline-insights-v1.2.0',\n    schemaVersion: 1,\n  };\n};\n\n// -----------------------------------------------------------------------------\n// Rules (evaluated via IntelligenceContext)\n// -----------------------------------------------------------------------------\n\nconst generateSleepInsights = (params: {\n  userId: string;\n  date: string;\n  now: IsoDateTimeString;\n  ctx: ReturnType<typeof buildIntelligenceContext>;\n}): Insight[] => {\n  const { userId, date, now, ctx } = params;\n\n  if (!ctx.confidence.meetsThreshold('sleep')) return [];\n\n  const totalMinutes = ctx.facts.sleepTotalMinutes();\n  if (totalMinutes === undefined) return [];\n\n  const thresholdMinutes = 420;\n  if (totalMinutes >= thresholdMinutes) return [];\n\n  const hours = totalMinutes / 60;\n  const title = 'Low sleep duration';\n  const message = `You slept about ${hours.toFixed(\n    1,\n  )} hours, which is below the recommended 7+ hours. Consider prioritizing an earlier bedtime or reducing pre-sleep screen time.`;\n\n  const insight = buildBaseInsight({\n    userId,\n    date,\n    now,\n    kind: 'low_sleep_duration',\n    severity: 'warning',\n    title,\n    message,\n    tags: ['sleep', 'recovery'],\n  });\n\n  insight.evidence.push({\n    factPath: 'sleep.totalMinutes',\n    value: totalMinutes,\n    threshold: thresholdMinutes,\n    direction: 'below',\n  });\n\n  return [insight];\n};\n\nconst generateStepsInsights = (params: {\n  userId: string;\n  date: string;\n  now: IsoDateTimeString;\n  ctx: ReturnType<typeof buildIntelligenceContext>;\n}): Insight[] => {\n  const { userId, date, now, ctx } = params;\n\n  if (!ctx.confidence.meetsThreshold('activity')) return [];\n\n  const steps = ctx.facts.steps();\n  if (steps === undefined) return [];\n\n  const threshold = 8000;\n  if (steps >= threshold) return [];\n\n  const title = 'Low daily movement';\n  const message = `You logged ${steps.toLocaleString()} steps, below the target of ${threshold.toLocaleString()}. Try adding a short walk or movement break tomorrow.`;\n\n  const insight = buildBaseInsight({\n    userId,\n    date,\n    now,\n    kind: 'low_steps',\n    severity: 'info',\n    title,\n    message,\n    tags: ['activity', 'movement'],\n  });\n\n  insight.evidence.push({\n    factPath: 'activity.steps',\n    value: steps,\n    threshold,\n    direction: 'below',\n  });\n\n  return [insight];\n};\n\nconst generateTrainingLoadInsights = (params: {\n  userId: string;\n  date: string;\n  now: IsoDateTimeString;\n  ctx: ReturnType<typeof buildIntelligenceContext>;\n}): Insight[] => {\n  const { userId, date, now, ctx } = params;\n\n  if (!ctx.confidence.meetsThreshold('activity')) return [];\n\n  const load = ctx.facts.trainingLoad();\n  if (load === undefined) return [];\n\n  const threshold = 150;\n  if (load <= threshold) return [];\n\n  const title = 'High training load';\n  const message = `Your training load (${load.toFixed(\n    0,\n  )}) was high today. Make sure you have enough recovery planned over the next 24\u201348 hours.`;\n\n  const insight = buildBaseInsight({\n    userId,\n    date,\n    now,\n    kind: 'high_training_load',\n    severity: 'warning',\n    title,\n    message,\n    tags: ['training', 'recovery'],\n  });\n\n  insight.evidence.push({\n    factPath: 'activity.trainingLoad',\n    value: load,\n    threshold,\n    direction: 'above',\n  });\n\n  return [insight];\n};\n\nconst generateHrvInsights = (params: {\n  userId: string;\n  date: string;\n  now: IsoDateTimeString;\n  ctx: ReturnType<typeof buildIntelligenceContext>;\n}): Insight[] => {\n  const { userId, date, now, ctx } = params;\n\n  if (!ctx.confidence.meetsThreshold('recovery')) return [];\n\n  const hrv = ctx.facts.hrvRmssd();\n  if (hrv === undefined) return [];\n\n  const threshold = 50;\n  if (hrv >= threshold) return [];\n\n  const title = 'Low HRV today';\n  const message = `Your HRV (RMSSD) was ${hrv.toFixed(\n    0,\n  )} ms today, which may indicate higher stress or lower recovery. Consider prioritizing sleep, hydration, and light movement.`;\n\n  const insight = buildBaseInsight({\n    userId,\n    date,\n    now,\n    kind: 'low_hrv',\n    severity: 'info',\n    title,\n    message,\n    tags: ['recovery', 'hrv'],\n  });\n\n  insight.evidence.push({\n    factPath: 'recovery.hrvRmssd',\n    value: hrv,\n    threshold,\n    direction: 'below',\n  });\n\n  return [insight];\n};\n\n// -----------------------------------------------------------------------------\n// Public API\n// -----------------------------------------------------------------------------\n\n/**\n * Generate all baseline insights for a given day.\n *\n * Sprint 6:\n * - Builds an IntelligenceContext from (today, history)\n * - Runs rules against the context (safe getters + centralized confidence gating)\n *\n * Deterministic:\n * - Insight IDs are date+kind\n * - Re-runs overwrite same documents\n */\nexport const generateInsightsForDailyFacts = (input: InsightRuleInput): Insight[] => {\n  const userId = input.userId;\n  const date = input.date;\n  const now = input.now;\n\n  const today = isV2Input(input) ? input.today : input.facts;\n  const history = isV2Input(input) ? input.history : [];\n\n  const ctx = buildIntelligenceContext({ today, history });\n\n  return [\n    ...generateSleepInsights({ userId, date, now, ctx }),\n    ...generateStepsInsights({ userId, date, now, ctx }),\n    ...generateTrainingLoadInsights({ userId, date, now, ctx }),\n    ...generateHrvInsights({ userId, date, now, ctx }),\n  ];\n};\n", "// services/functions/src/intelligence/buildDailyIntelligenceContext.ts\n\nimport type {\n    DailyFacts,\n    DailyDomainConfidence,\n    Insight,\n    InsightSeverity,\n    IsoDateTimeString,\n    YmdDateString,\n  } from '../types/health';\n  \n  export const DAILY_INTELLIGENCE_CONTEXT_VERSION = 'daily-intelligence-context-v1.0.0' as const;\n  \n  export type DomainKey = keyof NonNullable<DailyFacts['confidence']>;\n  \n  export interface BuildDailyIntelligenceContextInput {\n    userId: string;\n    date: YmdDateString;\n    computedAt: IsoDateTimeString;\n  \n    today: DailyFacts;\n  \n    /**\n     * Optional for strict TS ergonomics.\n     * Callers that don't have a history window available can omit it.\n     * When omitted, it is treated as an empty window.\n     */\n    history?: DailyFacts[];\n  \n    insightsForDay: Insight[];\n  \n    /**\n     * Confidence gating threshold used for readiness flags.\n     * If omitted, we treat missing confidence as \"unknown\" and do not block readiness.\n     */\n    domainConfidenceThreshold?: number;\n  }\n  \n  export interface DailyIntelligenceContextDoc {\n    schemaVersion: 1;\n    version: typeof DAILY_INTELLIGENCE_CONTEXT_VERSION;\n  \n    id: YmdDateString;\n    userId: string;\n    date: YmdDateString;\n  \n    computedAt: IsoDateTimeString;\n  \n    facts: {\n      sleepTotalMinutes?: number;\n      steps?: number;\n      trainingLoad?: number;\n  \n      hrvRmssd?: number;\n      hrvRmssdBaseline?: number;\n      hrvRmssdDeviation?: number;\n  \n      weightKg?: number;\n      bodyFatPercent?: number;\n    };\n  \n    /**\n     * Optional due to exactOptionalPropertyTypes:\n     * Only include when confidence exists (do NOT set to undefined).\n     */\n    confidence?: DailyDomainConfidence;\n  \n    insights: {\n      count: number;\n      bySeverity: Record<InsightSeverity, number>;\n      tags: string[];\n      kinds: string[];\n      ids: string[];\n    };\n  \n    readiness: {\n      hasDailyFacts: boolean;\n      hasInsights: boolean;\n      domainMeetsConfidence: Partial<Record<DomainKey, boolean>>;\n    };\n  }\n  \n  const DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD = 0.5 as const;\n  \n  const isFiniteNumber = (value: unknown): value is number =>\n    typeof value === 'number' && Number.isFinite(value);\n  \n  const clamp01 = (value: number): number => {\n    if (value < 0) return 0;\n    if (value > 1) return 1;\n    return value;\n  };\n  \n  const getDomainConfidence = (\n    confidence: DailyDomainConfidence | undefined,\n    domain: DomainKey,\n  ): number | undefined => {\n    const v = confidence?.[domain];\n    return isFiniteNumber(v) ? clamp01(v) : undefined;\n  };\n  \n  const uniqueSorted = (values: string[]): string[] => {\n    const set = new Set<string>();\n    for (const v of values) {\n      const trimmed = v.trim();\n      if (trimmed.length > 0) set.add(trimmed);\n    }\n    return Array.from(set).sort((a, b) => a.localeCompare(b));\n  };\n  \n  const emptySeverityCounts = (): Record<InsightSeverity, number> => ({\n    info: 0,\n    warning: 0,\n    critical: 0,\n  });\n  \n  const countBySeverity = (insights: Insight[]): Record<InsightSeverity, number> => {\n    const out = emptySeverityCounts();\n    for (const i of insights) {\n      if (i.severity === 'info' || i.severity === 'warning' || i.severity === 'critical') {\n        out[i.severity] += 1;\n      }\n    }\n    return out;\n  };\n  \n  /**\n   * Build a deterministic DailyIntelligenceContext document for a given user+day.\n   * - Pure function (no Firestore/admin I/O)\n   * - Safe under exactOptionalPropertyTypes by OMITTING absent optional fields.\n   */\n  export const buildDailyIntelligenceContextDoc = (\n    input: BuildDailyIntelligenceContextInput,\n  ): DailyIntelligenceContextDoc => {\n    // Keep the variable even if not used yet (Sprint 7 evolution).\n    // Important: default for strict TS callers.\n    const history: DailyFacts[] = input.history ?? [];\n    void history;\n  \n    const thresholdRaw =\n      typeof input.domainConfidenceThreshold === 'number'\n        ? input.domainConfidenceThreshold\n        : DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD;\n  \n    const domainConfidenceThreshold = Number.isFinite(thresholdRaw)\n      ? thresholdRaw\n      : DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD;\n  \n    const domainMeetsConfidence: Partial<Record<DomainKey, boolean>> = {};\n    const conf = input.today.confidence;\n  \n    if (conf) {\n      (Object.keys(conf) as DomainKey[]).forEach((domain) => {\n        const score = getDomainConfidence(conf, domain);\n        domainMeetsConfidence[domain] = score === undefined ? true : score >= domainConfidenceThreshold;\n      });\n    }\n  \n    // IMPORTANT for exactOptionalPropertyTypes:\n    // - Do NOT set keys to undefined\n    // - Only add keys when values are finite numbers\n    const facts: DailyIntelligenceContextDoc['facts'] = {};\n  \n    const sleepTotalMinutes = input.today.sleep?.totalMinutes;\n    if (isFiniteNumber(sleepTotalMinutes)) facts.sleepTotalMinutes = sleepTotalMinutes;\n  \n    const steps = input.today.activity?.steps;\n    if (isFiniteNumber(steps)) facts.steps = steps;\n  \n    const trainingLoad = input.today.activity?.trainingLoad;\n    if (isFiniteNumber(trainingLoad)) facts.trainingLoad = trainingLoad;\n  \n    const hrvRmssd = input.today.recovery?.hrvRmssd;\n    if (isFiniteNumber(hrvRmssd)) facts.hrvRmssd = hrvRmssd;\n  \n    const hrvRmssdBaseline = input.today.recovery?.hrvRmssdBaseline;\n    if (isFiniteNumber(hrvRmssdBaseline)) facts.hrvRmssdBaseline = hrvRmssdBaseline;\n  \n    const hrvRmssdDeviation = input.today.recovery?.hrvRmssdDeviation;\n    if (isFiniteNumber(hrvRmssdDeviation)) facts.hrvRmssdDeviation = hrvRmssdDeviation;\n  \n    const weightKg = input.today.body?.weightKg;\n    if (isFiniteNumber(weightKg)) facts.weightKg = weightKg;\n  \n    const bodyFatPercent = input.today.body?.bodyFatPercent;\n    if (isFiniteNumber(bodyFatPercent)) facts.bodyFatPercent = bodyFatPercent;\n  \n    const tags: string[] = [];\n    const kinds: string[] = [];\n    const ids: string[] = [];\n  \n    for (const ins of input.insightsForDay) {\n      ids.push(ins.id);\n      kinds.push(ins.kind);\n  \n      // tags may be optional under exactOptionalPropertyTypes\n      const insTags = ins.tags ?? [];\n      for (const t of insTags) tags.push(t);\n    }\n  \n    // Build WITHOUT confidence first (so we never set confidence: undefined)\n    const doc: DailyIntelligenceContextDoc = {\n      schemaVersion: 1,\n      version: DAILY_INTELLIGENCE_CONTEXT_VERSION,\n  \n      id: input.date,\n      userId: input.userId,\n      date: input.date,\n  \n      computedAt: input.computedAt,\n  \n      facts,\n  \n      insights: {\n        count: input.insightsForDay.length,\n        bySeverity: countBySeverity(input.insightsForDay),\n        tags: uniqueSorted(tags),\n        kinds: uniqueSorted(kinds),\n        ids: uniqueSorted(ids),\n      },\n  \n      readiness: {\n        hasDailyFacts: true,\n        hasInsights: input.insightsForDay.length > 0,\n        domainMeetsConfidence,\n      },\n    };\n  \n    // Only include confidence if it exists\n    if (input.today.confidence) {\n      doc.confidence = input.today.confidence;\n    }\n  \n    return doc;\n  };\n  \n  /**\n   * Backward-compatible export so other Sprint 7 files can keep importing:\n   *   import { buildDailyIntelligenceContext } from './buildDailyIntelligenceContext';\n   */\n  export const buildDailyIntelligenceContext = buildDailyIntelligenceContextDoc;\n  ", "// services/functions/src/pipeline/pipelineMeta.ts\n\nimport type { IsoDateTimeString, PipelineMeta } from \"../types/health\";\n\nexport const PIPELINE_VERSION = 1 as const;\n\nexport const buildPipelineMeta = (args: {\n  computedAt: IsoDateTimeString;\n  source?: Record<string, unknown>;\n}): PipelineMeta => ({\n  computedAt: args.computedAt,\n  pipelineVersion: PIPELINE_VERSION,\n  ...(args.source ? { source: args.source } : {}),\n});", "// services/functions/src/pipeline/derivedLedger.ts\n\nimport crypto from \"node:crypto\";\nimport { Timestamp } from \"firebase-admin/firestore\";\nimport type { DocumentReference, Firestore } from \"firebase-admin/firestore\";\n\nexport type IsoDateTimeString = string;\nexport type YmdDateString = string;\n\ntype Trigger =\n  | { type: \"realtime\"; name: \"onCanonicalEventCreated\"; eventId: string }\n  | { type: \"realtime\"; name: \"onRawEventCreated_factOnly\"; eventId: string }\n  | { type: \"scheduled\"; name: string; eventId: string };\n\ntype SnapshotKind = \"dailyFacts\" | \"intelligenceContext\" | \"healthScore\";\n\ntype LedgerRunRecord = {\n  schemaVersion: 1;\n  runId: string;\n  userId: string;\n  date: YmdDateString;\n\n  computedAt: IsoDateTimeString;\n  pipelineVersion: number;\n\n  trigger: Trigger;\n\n  // \u201Cwhat was known\u201D truth anchor for replay/debug\n  latestCanonicalEventAt?: IsoDateTimeString;\n\n  outputs: {\n    hasDailyFacts: boolean;\n    insightsCount: number;\n    hasIntelligenceContext: boolean;\n    hasHealthScore: boolean;\n  };\n\n  createdAt: Timestamp;\n};\n\ntype SnapshotDoc<T> = {\n  schemaVersion: 1;\n  kind: string;\n  hash: string;\n  createdAt: Timestamp;\n  data: T;\n};\n\nfunction stableStringify(value: unknown): string {\n  const seen = new WeakSet<object>();\n\n  const normalize = (v: unknown): unknown => {\n    if (v === null) return null;\n    if (typeof v !== \"object\") return v;\n\n    // arrays preserve order\n    if (Array.isArray(v)) return v.map(normalize);\n\n    const obj = v as Record<string, unknown>;\n    if (seen.has(obj)) throw new Error(\"stableStringify: circular structure\");\n    seen.add(obj);\n\n    const out: Record<string, unknown> = {};\n    for (const k of Object.keys(obj).sort()) {\n      out[k] = normalize(obj[k]);\n    }\n    return out;\n  };\n\n  return JSON.stringify(normalize(value));\n}\n\nfunction sha256Hex(input: string): string {\n  return crypto.createHash(\"sha256\").update(input).digest(\"hex\");\n}\n\nfunction sanitizeDocId(id: string): string {\n  // Firestore doc ids cannot contain \"/\" and should be reasonably short.\n  return id.replace(/\\//g, \"_\");\n}\n\nasync function createOrAssertIdentical<T extends object>(ref: DocumentReference, doc: T): Promise<void> {\n  await ref.firestore.runTransaction(async (tx) => {\n    const snap = await tx.get(ref);\n    if (!snap.exists) {\n      tx.create(ref, doc);\n      return;\n    }\n\n    const existing = snap.data();\n    const a = stableStringify(existing);\n    const b = stableStringify(doc);\n\n    if (a !== b) {\n      throw new Error(\n        `Derived ledger immutability violation: attempted to overwrite ${ref.path} with different content.`,\n      );\n    }\n    // identical: no-op\n  });\n}\n\nfunction tryGetString(obj: Record<string, unknown> | undefined, key: string): string | undefined {\n  const v = obj?.[key];\n  return typeof v === \"string\" && v.length > 0 ? v : undefined;\n}\n\n/**\n * Deterministic ledger run id builder for schedulers/retries.\n * (onSchedule ScheduledEvent does not provide a stable .id field.)\n */\nexport function makeLedgerRunIdFromSeed(prefix: string, seed: string): string {\n  const h = sha256Hex(seed).slice(0, 32);\n  return sanitizeDocId(`${prefix}_${h}`);\n}\n\nexport async function writeDerivedLedgerRun(args: {\n  db: Firestore;\n  userId: string;\n  date: YmdDateString;\n  runId: string;\n\n  computedAt: IsoDateTimeString;\n  pipelineVersion: number;\n\n  trigger: Trigger;\n\n  // optional anchor\n  latestCanonicalEventAt?: IsoDateTimeString;\n\n  // snapshots (optional per job)\n  dailyFacts?: object;\n  intelligenceContext?: object;\n  insights?: object[];\n  healthScore?: object;\n}): Promise<void> {\n  const {\n    db,\n    userId,\n    date,\n    runId,\n    computedAt,\n    pipelineVersion,\n    trigger,\n    latestCanonicalEventAt,\n    dailyFacts,\n    intelligenceContext,\n    insights,\n    healthScore,\n  } = args;\n\n  const userRef = db.collection(\"users\").doc(userId);\n\n  // Pointer doc (mutable) \u2013 allowed: this is \"latest pointer\", not historical truth.\n  const dayPointerRef = userRef.collection(\"derivedLedger\").doc(date);\n\n  // Append-only run doc + snapshots\n  const runRef = dayPointerRef.collection(\"runs\").doc(runId);\n  const snapshotsRef = runRef.collection(\"snapshots\");\n\n  const now = Timestamp.now();\n\n  // NOTE: exactOptionalPropertyTypes=true \u2192 omit optional props when undefined\n  const runRecord: LedgerRunRecord = {\n    schemaVersion: 1,\n    runId,\n    userId,\n    date,\n    computedAt,\n    pipelineVersion,\n    trigger,\n    ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n    outputs: {\n      hasDailyFacts: Boolean(dailyFacts),\n      insightsCount: Array.isArray(insights) ? insights.length : 0,\n      hasIntelligenceContext: Boolean(intelligenceContext),\n      hasHealthScore: Boolean(healthScore),\n    },\n    createdAt: now,\n  };\n\n  // 1) Run record (append-only)\n  await createOrAssertIdentical(runRef, runRecord);\n\n  // 2) Snapshots (append-only)\n  const writeSnapshot = async (kind: SnapshotKind, data: object): Promise<void> => {\n    const body = stableStringify(data);\n    const hash = sha256Hex(body);\n    const snapDoc: SnapshotDoc<object> = {\n      schemaVersion: 1,\n      kind,\n      hash,\n      createdAt: now,\n      data,\n    };\n    await createOrAssertIdentical(snapshotsRef.doc(kind), snapDoc);\n  };\n\n  if (dailyFacts) await writeSnapshot(\"dailyFacts\", dailyFacts);\n  if (intelligenceContext) await writeSnapshot(\"intelligenceContext\", intelligenceContext);\n  if (healthScore) await writeSnapshot(\"healthScore\", healthScore);\n\n  if (Array.isArray(insights) && insights.length > 0) {\n    const insightsCol = snapshotsRef.doc(\"insights\").collection(\"items\");\n    for (const insight of insights) {\n      const insightObj = insight as Record<string, unknown>;\n      const insightId =\n        tryGetString(insightObj, \"id\") ?? sha256Hex(stableStringify(insightObj)).slice(0, 24);\n\n      const body = stableStringify(insightObj);\n      const hash = sha256Hex(body);\n\n      const snapDoc: SnapshotDoc<Record<string, unknown>> = {\n        schemaVersion: 1,\n        kind: \"insight\",\n        hash,\n        createdAt: now,\n        data: insightObj,\n      };\n\n      await createOrAssertIdentical(insightsCol.doc(sanitizeDocId(insightId)), snapDoc);\n    }\n  }\n\n  // 3) Update pointer doc (mutable \u201Clatest\u201D pointer) \u2014 authoritative overwrite (NO merge)\n  await dayPointerRef.set({\n    schemaVersion: 1,\n    userId,\n    date,\n    latestRunId: runId,\n    latestComputedAt: computedAt,\n    pipelineVersion,\n    trigger,\n    updatedAt: now,\n  });\n}", "// services/functions/src/healthScore/computeHealthScoreV1.ts\n// Phase 1.5 Sprint 1 \u2014 Health Score Model v1.0 (pure, deterministic)\n\nimport type { DailyFacts, IsoDateTimeString, YmdDateString } from \"../types/health\";\n\nexport type HealthScoreTier = \"excellent\" | \"good\" | \"fair\" | \"poor\";\nexport type HealthScoreStatus = \"stable\" | \"attention_required\" | \"insufficient_data\";\n\nexport interface DomainScoreResult {\n  score: number;\n  tier: HealthScoreTier;\n  missing: string[];\n}\n\nexport interface HealthScoreInput {\n  userId: string;\n  date: YmdDateString;\n  today: DailyFacts;\n  history: DailyFacts[];\n  computedAt: IsoDateTimeString;\n  pipelineVersion: number;\n}\n\nexport interface HealthScoreResult {\n  schemaVersion: 1;\n  modelVersion: \"1.0\";\n  date: YmdDateString;\n  compositeScore: number;\n  compositeTier: HealthScoreTier;\n  domainScores: {\n    recovery: DomainScoreResult;\n    training: DomainScoreResult;\n    nutrition: DomainScoreResult;\n    body: DomainScoreResult;\n  };\n  status: HealthScoreStatus;\n  computedAt: IsoDateTimeString;\n  pipelineVersion: number;\n  inputs: {\n    hasDailyFacts: boolean;\n    historyDaysUsed: number;\n  };\n}\n\nconst isFiniteNumber = (v: unknown): v is number =>\n  typeof v === \"number\" && Number.isFinite(v);\n\nfunction scoreToTier(score: number): HealthScoreTier {\n  if (score >= 80) return \"excellent\";\n  if (score >= 60) return \"good\";\n  if (score >= 40) return \"fair\";\n  return \"poor\";\n}\n\nfunction clamp0_100(n: number): number {\n  if (n < 0) return 0;\n  if (n > 100) return 100;\n  return n;\n}\n\n/**\n * Recovery domain: readiness (0\u2013100) or HRV RMSSD (10\u2013120 ms \u2192 0\u2013100).\n * Deterministic, no interpretation layer.\n */\nfunction recoveryDomain(today: DailyFacts): DomainScoreResult {\n  const r = today.recovery;\n  const missing: string[] = [];\n\n  if (isFiniteNumber(r?.readinessScore)) {\n    const score = clamp0_100(r!.readinessScore!);\n    return { score, tier: scoreToTier(score), missing };\n  }\n  if (isFiniteNumber(r?.hrvRmssd)) {\n    // 10\u2013120 ms \u2192 0\u2013100 linear (conservative band)\n    const score = clamp0_100(((r!.hrvRmssd! - 10) / 110) * 100);\n    return { score, tier: scoreToTier(score), missing };\n  }\n  if (r) missing.push(\"readiness\", \"hrv\");\n  else missing.push(\"recovery_data\");\n  return { score: 0, tier: \"poor\", missing };\n}\n\n/**\n * Training domain: steps (0\u201312k \u2192 0\u2013100) or training load (0\u2013400 \u2192 0\u2013100) or move (0\u201360 min \u2192 0\u2013100).\n * Take best available signal; deterministic.\n */\nfunction trainingDomain(today: DailyFacts): DomainScoreResult {\n  const a = today.activity;\n  const missing: string[] = [];\n  let score = 0;\n\n  if (isFiniteNumber(a?.steps)) {\n    score = Math.max(score, clamp0_100((a!.steps! / 12000) * 100));\n  } else missing.push(\"steps\");\n  if (isFiniteNumber(a?.trainingLoad)) {\n    score = Math.max(score, clamp0_100((a!.trainingLoad! / 400) * 100));\n  } else missing.push(\"training_load\");\n  if (isFiniteNumber(a?.moveMinutes)) {\n    score = Math.max(score, clamp0_100((a!.moveMinutes! / 60) * 100));\n  } else if (!missing.includes(\"steps\") && !missing.includes(\"training_load\")) missing.push(\"move_minutes\");\n\n  if (score === 0 && today.strength && today.strength.totalSets > 0) {\n    score = 50; // strength-only day: fixed 50\n    return { score, tier: scoreToTier(score), missing: [] };\n  }\n  if (score === 0) missing.push(\"activity_data\");\n  return { score, tier: scoreToTier(score), missing };\n}\n\n/**\n * Nutrition domain: completeness of macro data (0\u20134 fields \u2192 0\u2013100).\n */\nfunction nutritionDomain(today: DailyFacts): DomainScoreResult {\n  const n = today.nutrition;\n  const missing: string[] = [];\n  let count = 0;\n  if (isFiniteNumber(n?.totalKcal)) count++;\n  else missing.push(\"total_kcal\");\n  if (isFiniteNumber(n?.proteinG)) count++;\n  else missing.push(\"protein_g\");\n  if (isFiniteNumber(n?.carbsG)) count++;\n  else missing.push(\"carbs_g\");\n  if (isFiniteNumber(n?.fatG)) count++;\n  else missing.push(\"fat_g\");\n  const score = count === 0 ? 0 : clamp0_100((count / 4) * 100);\n  if (count === 0) missing.push(\"nutrition_data\");\n  return { score, tier: scoreToTier(score), missing };\n}\n\n/**\n * Body domain: presence of weight or body composition.\n */\nfunction bodyDomain(today: DailyFacts): DomainScoreResult {\n  const b = today.body;\n  const missing: string[] = [];\n  if (isFiniteNumber(b?.weightKg) || isFiniteNumber(b?.bodyFatPercent)) {\n    return { score: 100, tier: \"excellent\", missing };\n  }\n  missing.push(\"weight\");\n  return { score: 0, tier: \"poor\", missing };\n}\n\n/**\n * Composite = average of four domain scores (equal weight).\n * Status: insufficient_data when no daily facts; attention_required when fair/poor; else stable.\n */\nexport function computeHealthScoreV1(input: HealthScoreInput): HealthScoreResult {\n  const { date, today, history, computedAt, pipelineVersion } = input;\n\n  const recovery = recoveryDomain(today);\n  const training = trainingDomain(today);\n  const nutrition = nutritionDomain(today);\n  const body = bodyDomain(today);\n\n  const compositeScore = Math.round(\n    (recovery.score + training.score + nutrition.score + body.score) / 4,\n  );\n  const compositeTier = scoreToTier(compositeScore);\n\n  let status: HealthScoreStatus = \"stable\";\n  if (compositeTier === \"poor\" || compositeTier === \"fair\") status = \"attention_required\";\n  const hasAnyData =\n    recovery.score > 0 ||\n    training.score > 0 ||\n    nutrition.score > 0 ||\n    body.score > 0;\n  if (!hasAnyData) status = \"insufficient_data\";\n\n  return {\n    schemaVersion: 1,\n    modelVersion: \"1.0\",\n    date,\n    compositeScore,\n    compositeTier,\n    domainScores: { recovery, training, nutrition, body },\n    status,\n    computedAt,\n    pipelineVersion,\n    inputs: {\n      hasDailyFacts: true,\n      historyDaysUsed: history.length,\n    },\n  };\n}\n", "// services/functions/src/healthScore/writeHealthScoreImmutable.ts\n// Phase 1.5 Sprint 1 \u2014 create-or-assert-identical for healthScores/{dayKey}\n\nimport type { Firestore } from \"firebase-admin/firestore\";\nimport type { HealthScoreResult } from \"./computeHealthScoreV1\";\n\nfunction stableStringify(value: unknown): string {\n  const seen = new WeakSet<object>();\n\n  const normalize = (v: unknown): unknown => {\n    if (v === null) return null;\n    if (typeof v !== \"object\") return v;\n    if (Array.isArray(v)) return v.map(normalize);\n\n    const obj = v as Record<string, unknown>;\n    if (seen.has(obj)) throw new Error(\"stableStringify: circular structure\");\n    seen.add(obj);\n\n    const out: Record<string, unknown> = {};\n    for (const k of Object.keys(obj).sort()) {\n      out[k] = normalize(obj[k]);\n    }\n    return out;\n  };\n\n  return JSON.stringify(normalize(value));\n}\n\n/** Canonical form for immutability: exclude computedAt so replay runs with same inputs are identical. */\nfunction canonicalForComparison(doc: Record<string, unknown>): string {\n  const { computedAt: _c, ...rest } = doc;\n  return stableStringify(rest);\n}\n\n/**\n * Write health score document immutably: create if missing, else assert identical (by canonical content).\n * computedAt is excluded from comparison so multiple pipeline runs with same inputs are idempotent.\n * Throws on attempt to overwrite with different logical content (replay-safe, deterministic).\n */\nexport async function writeHealthScoreImmutable(args: {\n  db: Firestore;\n  userId: string;\n  dayKey: string;\n  doc: HealthScoreResult;\n}): Promise<void> {\n  const { db, userId, dayKey, doc } = args;\n  const ref = db.collection(\"users\").doc(userId).collection(\"healthScores\").doc(dayKey);\n  const payload = doc as unknown as Record<string, unknown>;\n\n  await db.runTransaction(async (tx) => {\n    const snap = await tx.get(ref);\n\n    if (!snap.exists) {\n      tx.set(ref, payload);\n      return;\n    }\n\n    const existing = snap.data() as Record<string, unknown> | undefined;\n    const a = canonicalForComparison(existing ?? {});\n    const b = canonicalForComparison(payload);\n\n    if (a !== b) {\n      throw new Error(\n        `Health score immutability violation: attempted to overwrite ${ref.path} with different content.`,\n      );\n    }\n  });\n}\n", "// services/functions/src/pipeline/recomputeForDay.ts\n\n/**\n * Shared recompute pipeline for derived truth (dailyFacts, insights, intelligenceContext).\n * Used by:\n * - onRawEventCreated (fact-only trigger)\n * - HTTP admin recompute (delegates to same logic)\n *\n * Idempotent: overwrites are allowed for derived truth.\n */\n\nimport type { Firestore } from \"firebase-admin/firestore\";\nimport type {\n  CanonicalEvent,\n  DailyFacts,\n  DailyBodyFacts,\n  Insight,\n  IsoDateTimeString,\n  YmdDateString,\n} from \"../types/health\";\nimport { aggregateDailyFactsForDay } from \"../dailyFacts/aggregateDailyFacts\";\nimport { enrichDailyFactsWithBaselinesAndAverages } from \"../dailyFacts/enrichDailyFacts\";\nimport { generateInsightsForDailyFacts } from \"../insights/rules\";\nimport { buildDailyIntelligenceContext } from \"../intelligence/buildDailyIntelligenceContext\";\nimport { buildPipelineMeta } from \"./pipelineMeta\";\nimport { makeLedgerRunIdFromSeed, writeDerivedLedgerRun } from \"./derivedLedger\";\nimport { computeHealthScoreV1 } from \"../healthScore/computeHealthScoreV1\";\nimport { writeHealthScoreImmutable } from \"../healthScore/writeHealthScoreImmutable\";\n\nconst parseIntStrict = (value: string): number | null => {\n  if (!/^\\d+$/.test(value)) return null;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst parseYmdUtc = (ymd: YmdDateString): Date => {\n  const parts = ymd.split(\"-\");\n  if (parts.length !== 3) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  const y = parseIntStrict(parts[0] ?? \"\");\n  const m = parseIntStrict(parts[1] ?? \"\");\n  const d = parseIntStrict(parts[2] ?? \"\");\n  if (y === null || m === null || d === null) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  return new Date(Date.UTC(y, m - 1, d));\n};\n\nconst addDaysUtc = (ymd: YmdDateString, deltaDays: number): YmdDateString => {\n  const base = parseYmdUtc(ymd);\n  const next = new Date(base.getTime() + deltaDays * 24 * 60 * 60 * 1000);\n  const yy = next.getUTCFullYear();\n  const mm = (next.getUTCMonth() + 1).toString().padStart(2, \"0\");\n  const dd = next.getUTCDate().toString().padStart(2, \"0\");\n  return `${yy}-${mm}-${dd}`;\n};\n\nexport interface RecomputeForDayInput {\n  db: Firestore;\n  userId: string;\n  dayKey: YmdDateString;\n  /** Body facts from fact-only raw events (e.g. weight). When provided, merged into dailyFacts when no canonical weight events exist. */\n  factOnlyBody?: DailyBodyFacts;\n  trigger: { type: \"factOnly\"; rawEventId: string } | { type: \"realtime\"; eventId: string } | { type: \"admin\"; source: string };\n}\n\n/**\n * Recompute derived truth for a single user+day: dailyFacts, insights, intelligenceContext.\n * Idempotent; overwrites are allowed.\n */\nexport async function recomputeDerivedTruthForDay(input: RecomputeForDayInput): Promise<void> {\n  const { db, userId, dayKey, factOnlyBody, trigger } = input;\n  const computedAt: IsoDateTimeString = new Date().toISOString();\n\n  const userRef = db.collection(\"users\").doc(userId);\n\n  // Load canonical events for the day\n  const eventsSnap = await userRef.collection(\"events\").where(\"day\", \"==\", dayKey).get();\n  const eventsForDay = eventsSnap.docs.map((d) => d.data() as CanonicalEvent);\n\n  const latestCanonicalEventAt: IsoDateTimeString | undefined =\n    eventsForDay.reduce<IsoDateTimeString | undefined>((max, ev) => {\n      const t = ev.updatedAt ?? (ev as { createdAt?: string }).createdAt;\n      if (!t) return max;\n      if (!max) return t;\n      return t > max ? t : max;\n    }, undefined);\n\n  // Truth anchor for readiness (fact-only may have no canonical events)\n  const truthAnchor = latestCanonicalEventAt ?? computedAt;\n\n  const baseDailyFacts = aggregateDailyFactsForDay({\n    userId,\n    date: dayKey,\n    computedAt,\n    events: eventsForDay,\n    ...(factOnlyBody ? { factOnlyBody } : {}),\n  });\n\n  const startHistoryDate = addDaysUtc(dayKey, -6);\n  const historySnap = await userRef\n    .collection(\"dailyFacts\")\n    .where(\"date\", \">=\", startHistoryDate)\n    .where(\"date\", \"<\", dayKey)\n    .get();\n\n  const historyFacts = historySnap.docs.map((d) => d.data() as DailyFacts);\n\n  const enrichedDailyFacts = enrichDailyFactsWithBaselinesAndAverages({\n    today: baseDailyFacts,\n    history: historyFacts,\n  });\n\n  const dailyFactsWithMeta = {\n    ...enrichedDailyFacts,\n    meta: buildPipelineMeta({\n      computedAt: truthAnchor,\n      source: {\n        eventsForDay: eventsForDay.length,\n        ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n        ...(factOnlyBody ? { factOnlyBody: true } : {}),\n      },\n    }),\n  };\n\n  await userRef.collection(\"dailyFacts\").doc(dayKey).set(dailyFactsWithMeta);\n\n  const insights: Insight[] = generateInsightsForDailyFacts({\n    userId,\n    date: dayKey,\n    today: enrichedDailyFacts,\n    history: historyFacts,\n    now: computedAt,\n  });\n\n  for (const insight of insights) {\n    await userRef.collection(\"insights\").doc(insight.id).set(insight);\n  }\n\n  const ctxDoc = buildDailyIntelligenceContext({\n    userId,\n    date: dayKey,\n    computedAt,\n    today: enrichedDailyFacts,\n    insightsForDay: insights,\n  });\n\n  const ctxWithMeta = {\n    ...ctxDoc,\n    meta: buildPipelineMeta({\n      computedAt: truthAnchor,\n      source: {\n        eventsForDay: eventsForDay.length,\n        insightsWritten: insights.length,\n        ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n      },\n    }),\n  };\n\n  await userRef.collection(\"intelligenceContext\").doc(dayKey).set(ctxWithMeta);\n\n  const healthScoreDoc = computeHealthScoreV1({\n    userId,\n    date: dayKey,\n    today: enrichedDailyFacts,\n    history: historyFacts,\n    computedAt,\n    pipelineVersion: 1,\n  });\n  await writeHealthScoreImmutable({\n    db,\n    userId,\n    dayKey,\n    doc: healthScoreDoc,\n  });\n\n  const runIdSeed =\n    trigger.type === \"factOnly\"\n      ? `factOnly_${trigger.rawEventId}_${dayKey}`\n      : trigger.type === \"realtime\"\n        ? `onCanonicalEventCreated_${trigger.eventId}_${dayKey}`\n        : `admin_${trigger.source}_${dayKey}`;\n\n  const runId = makeLedgerRunIdFromSeed(\"rt\", runIdSeed);\n\n  await writeDerivedLedgerRun({\n    db,\n    userId,\n    date: dayKey,\n    runId,\n    computedAt,\n    pipelineVersion: 1,\n    trigger:\n      trigger.type === \"factOnly\"\n        ? { type: \"realtime\", name: \"onRawEventCreated_factOnly\", eventId: trigger.rawEventId }\n        : trigger.type === \"realtime\"\n          ? { type: \"realtime\", name: \"onCanonicalEventCreated\", eventId: trigger.eventId }\n          : { type: \"scheduled\", name: trigger.source, eventId: runId },\n    ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n    dailyFacts: dailyFactsWithMeta as unknown as object,\n    intelligenceContext: ctxWithMeta as unknown as object,\n    insights: insights as unknown as object[],\n    healthScore: healthScoreDoc as unknown as object,\n  });\n}\n", "// services/functions/src/realtime/onCanonicalEventCreated.ts\n\nimport { onDocumentCreated } from \"firebase-functions/v2/firestore\";\nimport * as logger from \"firebase-functions/logger\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type { CanonicalEvent, DailyFacts, Insight, IsoDateTimeString, YmdDateString } from \"../types/health\";\n\nimport { aggregateDailyFactsForDay } from \"../dailyFacts/aggregateDailyFacts\";\nimport { enrichDailyFactsWithBaselinesAndAverages } from \"../dailyFacts/enrichDailyFacts\";\n\nimport { generateInsightsForDailyFacts } from \"../insights/rules\";\nimport { buildDailyIntelligenceContext } from \"../intelligence/buildDailyIntelligenceContext\";\n\nimport { buildPipelineMeta } from \"../pipeline/pipelineMeta\";\nimport { computeLatencyMs, shouldWarnLatency } from \"../pipeline/pipelineLatency\";\n\nimport { makeLedgerRunIdFromSeed, writeDerivedLedgerRun } from \"../pipeline/derivedLedger\";\n\nconst FUNCTION_REGION = \"us-central1\";\nconst RUNTIME_SERVICE_ACCOUNT = \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\";\n\nconst toYmdUtc = (date: Date): YmdDateString => {\n  const year = date.getUTCFullYear();\n  const month = (date.getUTCMonth() + 1).toString().padStart(2, \"0\");\n  const day = date.getUTCDate().toString().padStart(2, \"0\");\n  return `${year.toString().padStart(4, \"0\")}-${month}-${day}`;\n};\n\nconst parseIntStrict = (value: string): number | null => {\n  if (!/^\\d+$/.test(value)) return null;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst parseYmdUtc = (ymd: YmdDateString): Date => {\n  const parts = ymd.split(\"-\");\n  if (parts.length !== 3) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  const y = parseIntStrict(parts[0] ?? \"\");\n  const m = parseIntStrict(parts[1] ?? \"\");\n  const d = parseIntStrict(parts[2] ?? \"\");\n  if (y === null || m === null || d === null) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  return new Date(Date.UTC(y, m - 1, d));\n};\n\nconst addDaysUtc = (ymd: YmdDateString, deltaDays: number): YmdDateString => {\n  const base = parseYmdUtc(ymd);\n  const next = new Date(base.getTime() + deltaDays * 24 * 60 * 60 * 1000);\n  return toYmdUtc(next);\n};\n\nexport const onCanonicalEventCreated = onDocumentCreated(\n  {\n    document: \"users/{userId}/events/{eventId}\",\n    region: FUNCTION_REGION,\n    serviceAccount: RUNTIME_SERVICE_ACCOUNT,\n  },\n  async (event) => {\n    const userId = String(event.params.userId);\n    const eventId = String(event.params.eventId);\n\n    const canonical = event.data?.data() as CanonicalEvent | undefined;\n    if (!canonical) {\n      logger.warn(\"onCanonicalEventCreated: missing canonical event data\", { userId, eventId });\n      return;\n    }\n\n    const day = canonical.day as YmdDateString;\n    const computedAt: IsoDateTimeString = new Date().toISOString();\n\n    logger.info(\"Realtime recompute started\", { userId, eventId, day, kind: canonical.kind });\n\n    const userRef = db.collection(\"users\").doc(userId);\n\n    // Canonical events for this day (truth anchor)\n    const eventsSnap = await userRef.collection(\"events\").where(\"day\", \"==\", day).get();\n    const eventsForDay = eventsSnap.docs.map((d) => d.data() as CanonicalEvent);\n\n    const latestCanonicalEventAt: IsoDateTimeString | undefined =\n      eventsForDay.reduce<IsoDateTimeString | undefined>((max, ev) => {\n        const t = ev.updatedAt ?? ev.createdAt;\n        if (!t) return max;\n        if (!max) return t;\n        return t > max ? t : max;\n      }, undefined) ?? undefined;\n\n    // DailyFacts for this day\n    const baseDailyFacts: DailyFacts = aggregateDailyFactsForDay({\n      userId,\n      date: day,\n      computedAt,\n      events: eventsForDay,\n    });\n\n    // Prior 6 days for enrichment\n    const startHistoryDate = addDaysUtc(day, -6);\n    const historySnap = await userRef\n      .collection(\"dailyFacts\")\n      .where(\"date\", \">=\", startHistoryDate)\n      .where(\"date\", \"<\", day)\n      .get();\n\n    const historyFacts = historySnap.docs.map((d) => d.data() as DailyFacts);\n\n    const enrichedDailyFacts = enrichDailyFactsWithBaselinesAndAverages({\n      today: baseDailyFacts,\n      history: historyFacts,\n    });\n\n    const dailyFactsWithMeta = {\n      ...enrichedDailyFacts,\n      meta: buildPipelineMeta({\n        computedAt,\n        source: {\n          eventsForDay: eventsForDay.length,\n          ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n        },\n      }),\n    };\n\n    // \u2705 Authoritative write (NO merge)\n    await userRef.collection(\"dailyFacts\").doc(day).set(dailyFactsWithMeta);\n\n    // Insights\n    const insights: Insight[] = generateInsightsForDailyFacts({\n      userId,\n      date: day,\n      today: enrichedDailyFacts,\n      history: historyFacts,\n      now: computedAt,\n    });\n\n    for (const insight of insights) {\n      // \u2705 Authoritative write (NO merge)\n      await userRef.collection(\"insights\").doc(insight.id).set(insight);\n    }\n\n    // Intelligence Context\n    const ctxDoc = buildDailyIntelligenceContext({\n      userId,\n      date: day,\n      computedAt,\n      today: enrichedDailyFacts,\n      insightsForDay: insights,\n    });\n\n    // \u2705 Truth anchor for readiness: latest canonical event time (fallback to computedAt)\n    const ctxComputedAt = latestCanonicalEventAt ?? computedAt;\n\n    const ctxWithMeta = {\n      ...ctxDoc,\n      meta: buildPipelineMeta({\n        computedAt: ctxComputedAt,\n        source: {\n          eventsForDay: eventsForDay.length,\n          insightsWritten: insights.length,\n          ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n        },\n      }),\n    };\n\n    // \u2705 Authoritative write (NO merge)\n    await userRef.collection(\"intelligenceContext\").doc(day).set(ctxWithMeta);\n\n    // Derived Ledger run (append-only, retry-safe)\n    const runId = makeLedgerRunIdFromSeed(\"rt\", `onCanonicalEventCreated_${eventId}_${day}`);\n    const pipelineVersion = 1;\n\n    await writeDerivedLedgerRun({\n      db,\n      userId,\n      date: day,\n      runId,\n      computedAt,\n      pipelineVersion,\n      trigger: { type: \"realtime\", name: \"onCanonicalEventCreated\", eventId },\n      ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n      dailyFacts: dailyFactsWithMeta as unknown as object,\n      intelligenceContext: ctxWithMeta as unknown as object,\n      insights: insights as unknown as object[],\n    });\n\n    // Latency logging (only if we have an anchor)\n    if (latestCanonicalEventAt) {\n      const latencyMs = computeLatencyMs(computedAt, latestCanonicalEventAt);\n      const warnAfterSec = 30;\n\n      if (shouldWarnLatency(latencyMs, warnAfterSec)) {\n        logger.warn(\"Pipeline latency high (canonical\u2192derived)\", { userId, day, latencyMs, warnAfterSec });\n      } else {\n        logger.info(\"Pipeline latency (canonical\u2192derived)\", { userId, day, latencyMs });\n      }\n    }\n\n    logger.info(\"Realtime recompute completed\", {\n      userId,\n      day,\n      eventsForDay: eventsForDay.length,\n      insightsWritten: insights.length,\n    });\n  },\n);", "// services/functions/src/pipeline/pipelineLatency.ts\n\nexport const computeLatencyMs = (computedAtIso: string, latestCanonicalEventAtIso: string | null): number | null => {\n    if (!latestCanonicalEventAtIso) return null;\n    const a = Date.parse(computedAtIso);\n    const b = Date.parse(latestCanonicalEventAtIso);\n    if (!Number.isFinite(a) || !Number.isFinite(b)) return null;\n    return a - b;\n  };\n  \n  export const shouldWarnLatency = (latencyMs: number | null, warnAfterSec: number): boolean => {\n    if (latencyMs === null) return false;\n    return latencyMs > warnAfterSec * 1000;\n  };\n  ", "// services/functions/src/dailyFacts/onDailyFactsRecomputeScheduled.ts\n\nimport { onSchedule } from \"firebase-functions/v2/scheduler\";\nimport * as logger from \"firebase-functions/logger\";\nimport type { WriteBatch } from \"firebase-admin/firestore\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type { CanonicalEvent, DailyFacts, IsoDateTimeString, YmdDateString } from \"../types/health\";\n\nimport { aggregateDailyFactsForDay } from \"./aggregateDailyFacts\";\nimport { enrichDailyFactsWithBaselinesAndAverages } from \"./enrichDailyFacts\";\n\nimport { buildPipelineMeta } from \"../pipeline/pipelineMeta\";\nimport { computeLatencyMs, shouldWarnLatency } from \"../pipeline/pipelineLatency\";\n\nimport { makeLedgerRunIdFromSeed, writeDerivedLedgerRun } from \"../pipeline/derivedLedger\";\nimport { writeFailureImmutable } from \"../failures/writeFailureImmutable\";\n\nconst toYmdUtc = (date: Date): YmdDateString => {\n  const year = date.getUTCFullYear();\n  const month = date.getUTCMonth() + 1;\n  const day = date.getUTCDate();\n  return `${year.toString().padStart(4, \"0\")}-${month.toString().padStart(2, \"0\")}-${day.toString().padStart(2, \"0\")}`;\n};\n\nconst parseIntStrict = (value: string): number | null => {\n  if (!/^\\d+$/.test(value)) return null;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst parseYmdUtc = (ymd: YmdDateString): Date => {\n  const parts = ymd.split(\"-\");\n  if (parts.length !== 3) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  const y = parseIntStrict(parts[0] ?? \"\");\n  const m = parseIntStrict(parts[1] ?? \"\");\n  const d = parseIntStrict(parts[2] ?? \"\");\n  if (y === null || m === null || d === null) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  return new Date(Date.UTC(y, m - 1, d));\n};\n\nconst addDaysUtc = (ymd: YmdDateString, deltaDays: number): YmdDateString => {\n  const base = parseYmdUtc(ymd);\n  const next = new Date(base.getTime() + deltaDays * 24 * 60 * 60 * 1000);\n  return toYmdUtc(next);\n};\n\nconst getYesterdayUtcYmd = (): YmdDateString => {\n  const now = new Date();\n  return toYmdUtc(new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() - 1)));\n};\n\nconst commitBatches = async (batches: WriteBatch[]): Promise<void> => {\n  for (const batch of batches) await batch.commit();\n};\n\nexport const onDailyFactsRecomputeScheduled = onSchedule(\n  {\n    schedule: \"0 3 * * *\",\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  },\n  async (event) => {\n    const targetDate = getYesterdayUtcYmd();\n    const computedAt: IsoDateTimeString = new Date().toISOString();\n\n    logger.info(\"DailyFacts recompute started\", { targetDate });\n\n    // We iterate users directly (avoid global collectionGroup writes assumptions)\n    const usersSnap = await db.collection(\"users\").select().get();\n    if (usersSnap.empty) {\n      logger.info(\"No users found; skipping DailyFacts recompute\", { targetDate });\n      return;\n    }\n\n    const MAX_OPS_PER_BATCH = 360;\n    const batches: WriteBatch[] = [];\n    let currentBatch = db.batch();\n    let currentOps = 0;\n\n    let usersProcessed = 0;\n    let docsWritten = 0;\n    let usersWithNoEvents = 0;\n\n    // Stable seed for this scheduled invocation (ScheduledEvent has no .id)\n    const runIdBase = makeLedgerRunIdFromSeed(\n      \"sch_dailyFacts\",\n      `${String(event.jobName ?? \"dailyFacts\")}_${String(event.scheduleTime ?? computedAt)}_${targetDate}`,\n    );\n    const triggerEventId = `${String(event.jobName ?? \"dailyFacts\")}_${String(event.scheduleTime ?? computedAt)}`;\n\n    const startHistoryDate = addDaysUtc(targetDate, -6);\n\n    for (const userDoc of usersSnap.docs) {\n      const userId = userDoc.id;\n      const userRef = db.collection(\"users\").doc(userId);\n\n      try {\n        // Canonical events for this day\n        const eventsSnap = await userRef.collection(\"events\").where(\"day\", \"==\", targetDate).get();\n        const eventsForDay = eventsSnap.docs.map((d) => d.data() as CanonicalEvent);\n\n        if (eventsForDay.length === 0) {\n          usersWithNoEvents += 1;\n        }\n\n        const latestCanonicalEventAt: IsoDateTimeString | undefined =\n          eventsForDay.reduce<IsoDateTimeString | undefined>((max, ev) => {\n            const t = ev.updatedAt ?? ev.createdAt;\n            if (!t) return max;\n            if (!max) return t;\n            return t > max ? t : max;\n          }, undefined) ?? undefined;\n\n        const baseDailyFacts: DailyFacts = aggregateDailyFactsForDay({\n          userId,\n          date: targetDate,\n          computedAt,\n          events: eventsForDay,\n        });\n\n        const historySnap = await userRef\n          .collection(\"dailyFacts\")\n          .where(\"date\", \">=\", startHistoryDate)\n          .where(\"date\", \"<\", targetDate)\n          .get();\n\n        const historyFacts = historySnap.docs.map((d) => d.data() as DailyFacts);\n\n        const enriched = enrichDailyFactsWithBaselinesAndAverages({\n          today: baseDailyFacts,\n          history: historyFacts,\n        });\n\n        const dailyFactsWithMeta = {\n          ...enriched,\n          meta: buildPipelineMeta({\n            computedAt: latestCanonicalEventAt ?? computedAt,\n            source: {\n              eventsForDay: eventsForDay.length,\n              ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n            },\n          }),\n        };\n\n        if (currentOps >= MAX_OPS_PER_BATCH) {\n          batches.push(currentBatch);\n          currentBatch = db.batch();\n          currentOps = 0;\n        }\n\n        currentBatch.set(userRef.collection(\"dailyFacts\").doc(targetDate), dailyFactsWithMeta);\n        currentOps += 1;\n\n        const runId = `${runIdBase}_${userId}`;\n        const pipelineVersion = 1;\n\n        await writeDerivedLedgerRun({\n          db,\n          userId,\n          date: targetDate,\n          runId,\n          computedAt,\n          pipelineVersion,\n          trigger: { type: \"scheduled\", name: \"onDailyFactsRecomputeScheduled\", eventId: triggerEventId },\n          ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n          dailyFacts: dailyFactsWithMeta as unknown as object,\n        });\n\n        if (latestCanonicalEventAt) {\n          const latencyMs = computeLatencyMs(computedAt, latestCanonicalEventAt);\n          const warnAfterSec = 30;\n\n          if (shouldWarnLatency(latencyMs, warnAfterSec)) {\n            logger.warn(\"Pipeline latency high (canonical\u2192dailyFacts)\", {\n              userId,\n              date: targetDate,\n              latencyMs,\n              warnAfterSec,\n            });\n          } else {\n            logger.info(\"Pipeline latency (canonical\u2192dailyFacts)\", { userId, date: targetDate, latencyMs });\n          }\n        }\n\n        usersProcessed += 1;\n        docsWritten += 1;\n      } catch (err) {\n        logger.error(\"Pipeline failure (dailyFacts.compute)\", {\n          userId,\n          date: targetDate,\n          error: err instanceof Error ? err.message : String(err),\n        });\n        try {\n          await writeFailureImmutable(\n            { requestId: triggerEventId },\n            {\n              userId,\n              source: \"pipeline\",\n              stage: \"dailyFacts.compute\",\n              reasonCode: \"DERIVE_FAILED\",\n              message: err instanceof Error ? err.message : String(err),\n              day: targetDate,\n              requestId: triggerEventId,\n              details: { _: \"pipeline_error\" },\n            },\n          );\n        } catch (failErr) {\n          logger.error(\"Failed to write failure record (pipeline)\", {\n            userId,\n            error: failErr instanceof Error ? failErr.message : String(failErr),\n          });\n        }\n      }\n    }\n\n    if (currentOps > 0) batches.push(currentBatch);\n    if (batches.length > 0) await commitBatches(batches);\n\n    logger.info(\"DailyFacts recompute completed\", {\n      targetDate,\n      usersProcessed,\n      docsWritten,\n      usersWithNoEvents,\n      batchesCommitted: batches.length,\n    });\n  },\n);\n", "// services/functions/src/insights/onInsightsRecomputeScheduled.ts\n\nimport { onSchedule } from \"firebase-functions/v2/scheduler\";\nimport * as logger from \"firebase-functions/logger\";\nimport type { WriteBatch } from \"firebase-admin/firestore\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type { DailyFacts, IsoDateTimeString, YmdDateString } from \"../types/health\";\nimport { generateInsightsForDailyFacts } from \"./rules\";\n\nimport { makeLedgerRunIdFromSeed, writeDerivedLedgerRun } from \"../pipeline/derivedLedger\";\n\ntype PipelineMetaLike = {\n  pipelineVersion?: number;\n  source?: Record<string, unknown>;\n};\n\nfunction readPipelineMetaLike(value: unknown): PipelineMetaLike | null {\n  if (!value || typeof value !== \"object\") return null;\n  const rec = value as Record<string, unknown>;\n  const meta = rec[\"meta\"];\n  if (!meta || typeof meta !== \"object\") return null;\n  const m = meta as Record<string, unknown>;\n\n  const pipelineVersion = typeof m[\"pipelineVersion\"] === \"number\" ? m[\"pipelineVersion\"] : undefined;\n  const source =\n    typeof m[\"source\"] === \"object\" && m[\"source\"] !== null ? (m[\"source\"] as Record<string, unknown>) : undefined;\n\n    return {\n      ...(pipelineVersion !== undefined ? { pipelineVersion } : {}),\n      ...(source !== undefined ? { source } : {}),\n    };    \n}\n\nfunction readLatestCanonicalEventAtFromMeta(value: unknown): string | undefined {\n  const meta = readPipelineMetaLike(value);\n  if (!meta?.source) return undefined;\n  const v = meta.source[\"latestCanonicalEventAt\"];\n  return typeof v === \"string\" ? v : undefined;\n}\n\nconst toYmdUtc = (date: Date): YmdDateString => {\n  const year = date.getUTCFullYear();\n  const month = date.getUTCMonth() + 1;\n  const day = date.getUTCDate();\n  return `${year.toString().padStart(4, \"0\")}-${month.toString().padStart(2, \"0\")}-${day\n    .toString()\n    .padStart(2, \"0\")}`;\n};\n\nconst parseIntStrict = (value: string): number | null => {\n  if (!/^\\d+$/.test(value)) return null;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst parseYmdUtc = (ymd: YmdDateString): Date => {\n  const parts = ymd.split(\"-\");\n  if (parts.length !== 3) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  const y = parseIntStrict(parts[0] ?? \"\");\n  const m = parseIntStrict(parts[1] ?? \"\");\n  const d = parseIntStrict(parts[2] ?? \"\");\n  if (y === null || m === null || d === null) throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  return new Date(Date.UTC(y, m - 1, d));\n};\n\nconst addDaysUtc = (ymd: YmdDateString, deltaDays: number): YmdDateString => {\n  const base = parseYmdUtc(ymd);\n  const next = new Date(base.getTime() + deltaDays * 24 * 60 * 60 * 1000);\n  return toYmdUtc(next);\n};\n\nconst getYesterdayUtcYmd = (): YmdDateString => {\n  const now = new Date();\n  return toYmdUtc(new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() - 1)));\n};\n\nconst buildWindowDatesInclusive = (endDate: YmdDateString, windowSizeDays: number): YmdDateString[] => {\n  const dates: YmdDateString[] = [];\n  for (let i = windowSizeDays - 1; i >= 0; i--) dates.push(addDaysUtc(endDate, -i));\n  return dates;\n};\n\nconst sortByDateAsc = (a: DailyFacts, b: DailyFacts): number => {\n  if (a.date < b.date) return -1;\n  if (a.date > b.date) return 1;\n  return 0;\n};\n\nconst commitBatches = async (batches: WriteBatch[]): Promise<void> => {\n  for (const batch of batches) await batch.commit();\n};\n\nexport const onInsightsRecomputeScheduled = onSchedule(\n  {\n    schedule: \"15 3 * * *\",\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  },\n  async (event) => {\n    const targetDate = getYesterdayUtcYmd();\n    const now: IsoDateTimeString = new Date().toISOString();\n\n    const windowDates = buildWindowDatesInclusive(targetDate, 7);\n\n    logger.info(\"Insights recompute started\", { targetDate, windowDates });\n\n    const dailyFactsSnapshot = await db.collectionGroup(\"dailyFacts\").where(\"date\", \"==\", targetDate).get();\n    if (dailyFactsSnapshot.empty) {\n      logger.info(\"No DailyFacts found for target date\", { targetDate });\n      return;\n    }\n\n    const MAX_OPS_PER_BATCH = 350;\n    const batches: WriteBatch[] = [];\n    let currentBatch = db.batch();\n    let currentOps = 0;\n\n    let usersProcessed = 0;\n    let insightsWritten = 0;\n    let usersWithNoHistory = 0;\n\n    // Stable-ish seed for this scheduled invocation (ScheduledEvent has no .id)\n    const runIdBase = makeLedgerRunIdFromSeed(\n      \"sch_insights\",\n      `${String(event.jobName ?? \"insights\")}_${String(event.scheduleTime ?? now)}_${targetDate}`,\n    );\n\n    const triggerEventId = `${String(event.jobName ?? \"insights\")}_${String(event.scheduleTime ?? now)}`;\n\n    for (const doc of dailyFactsSnapshot.docs) {\n      const userId = doc.ref.parent.parent?.id;\n      if (!userId) {\n        logger.warn(\"Skipping DailyFacts doc with unexpected path\", { path: doc.ref.path });\n        continue;\n      }\n\n      const todayFacts = doc.data() as DailyFacts;\n      if (!todayFacts || todayFacts.userId !== userId || todayFacts.date !== targetDate) {\n        logger.warn(\"Skipping DailyFacts doc with inconsistent data\", {\n          path: doc.ref.path,\n          userIdFromPath: userId,\n          userIdFromDoc: todayFacts?.userId,\n          dateFromDoc: todayFacts?.date,\n          targetDate,\n        });\n        continue;\n      }\n\n      const userRef = db.collection(\"users\").doc(userId);\n\n      const windowSnap = await userRef.collection(\"dailyFacts\").where(\"date\", \"in\", windowDates).get();\n      const windowFacts = windowSnap.docs.map((d) => d.data() as DailyFacts).sort(sortByDateAsc);\n\n      const today = windowFacts.find((f) => f.date === targetDate) ?? todayFacts;\n      const history = windowFacts.filter((f) => f.date !== targetDate);\n\n      if (history.length === 0) usersWithNoHistory += 1;\n\n      const insights = generateInsightsForDailyFacts({\n        userId,\n        date: targetDate,\n        today,\n        history,\n        now,\n      });\n\n      usersProcessed += 1;\n\n      // Always write a ledger run even if no insights (\u201Cno insights were known\u201D)\n      const runId = `${runIdBase}_${userId}`;\n\n      // Anchor (best available): dailyFacts meta source.latestCanonicalEventAt if present\n      const latestCanonicalEventAt = readLatestCanonicalEventAtFromMeta(todayFacts);\n\n      const pipelineVersion = readPipelineMetaLike(todayFacts)?.pipelineVersion ?? 1;\n\n      await writeDerivedLedgerRun({\n        db,\n        userId,\n        date: targetDate,\n        runId,\n        computedAt: now,\n        pipelineVersion,\n        trigger: { type: \"scheduled\", name: \"onInsightsRecomputeScheduled\", eventId: triggerEventId },\n        ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n        insights,\n      });\n\n      if (insights.length === 0) continue;\n\n      const insightsCol = userRef.collection(\"insights\");\n\n      for (const insight of insights) {\n        if (currentOps >= MAX_OPS_PER_BATCH) {\n          batches.push(currentBatch);\n          currentBatch = db.batch();\n          currentOps = 0;\n        }\n\n        currentBatch.set(insightsCol.doc(insight.id), insight);\n        currentOps += 1;\n        insightsWritten += 1;\n      }\n    }\n\n    if (currentOps > 0) batches.push(currentBatch);\n    if (batches.length > 0) await commitBatches(batches);\n\n    logger.info(\"Insights recompute completed\", {\n      targetDate,\n      usersProcessed,\n      usersWithNoHistory,\n      insightsWritten,\n      batchesCommitted: batches.length,\n    });\n  },\n);\n", "// services/functions/src/intelligence/onDailyIntelligenceContextRecomputeScheduled.ts\n\nimport { onSchedule } from \"firebase-functions/v2/scheduler\";\nimport * as logger from \"firebase-functions/logger\";\nimport type { WriteBatch } from \"firebase-admin/firestore\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type { CanonicalEvent, DailyFacts, Insight, IsoDateTimeString, YmdDateString } from \"../types/health\";\nimport { buildDailyIntelligenceContext } from \"./buildDailyIntelligenceContext\";\n\nimport { buildPipelineMeta } from \"../pipeline/pipelineMeta\";\nimport { computeLatencyMs, shouldWarnLatency } from \"../pipeline/pipelineLatency\";\n\nimport { makeLedgerRunIdFromSeed, writeDerivedLedgerRun } from \"../pipeline/derivedLedger\";\n\ntype PipelineMetaLike = {\n  pipelineVersion?: number;\n  source?: Record<string, unknown>;\n};\n\nfunction readPipelineMetaLike(value: unknown): PipelineMetaLike | null {\n  if (!value || typeof value !== \"object\") return null;\n  const rec = value as Record<string, unknown>;\n  const meta = rec[\"meta\"];\n  if (!meta || typeof meta !== \"object\") return null;\n  const m = meta as Record<string, unknown>;\n\n  const pipelineVersion = typeof m[\"pipelineVersion\"] === \"number\" ? m[\"pipelineVersion\"] : undefined;\n  const source =\n    typeof m[\"source\"] === \"object\" && m[\"source\"] !== null ? (m[\"source\"] as Record<string, unknown>) : undefined;\n\n    return {\n      ...(pipelineVersion !== undefined ? { pipelineVersion } : {}),\n      ...(source !== undefined ? { source } : {}),\n    };    \n}\n\nconst toYmdUtc = (date: Date): YmdDateString => {\n  const year = date.getUTCFullYear();\n  const month = date.getUTCMonth() + 1;\n  const day = date.getUTCDate();\n  return `${year.toString().padStart(4, \"0\")}-${month.toString().padStart(2, \"0\")}-${day\n    .toString()\n    .padStart(2, \"0\")}`;\n};\n\nconst getYesterdayUtcYmd = (): YmdDateString => {\n  const now = new Date();\n  return toYmdUtc(new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() - 1)));\n};\n\nconst commitBatches = async (batches: WriteBatch[]): Promise<void> => {\n  for (const batch of batches) await batch.commit();\n};\n\nexport const onDailyIntelligenceContextRecomputeScheduled = onSchedule(\n  {\n    schedule: \"30 3 * * *\",\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  },\n  async (event) => {\n    const targetDate = getYesterdayUtcYmd();\n    const computedAt: IsoDateTimeString = new Date().toISOString();\n\n    logger.info(\"DailyIntelligenceContext recompute started\", { targetDate });\n\n    const dailyFactsSnapshot = await db.collectionGroup(\"dailyFacts\").where(\"date\", \"==\", targetDate).get();\n    if (dailyFactsSnapshot.empty) {\n      logger.info(\"No DailyFacts found for target date\", { targetDate });\n      return;\n    }\n\n    const MAX_OPS_PER_BATCH = 360;\n    const batches: WriteBatch[] = [];\n    let currentBatch = db.batch();\n    let currentOps = 0;\n\n    let usersProcessed = 0;\n    let docsWritten = 0;\n\n    // Stable-ish seed for this scheduled invocation (ScheduledEvent has no .id)\n    const runIdBase = makeLedgerRunIdFromSeed(\n      \"sch_ctx\",\n      `${String(event.jobName ?? \"ctx\")}_${String(event.scheduleTime ?? computedAt)}_${targetDate}`,\n    );\n\n    const triggerEventId = `${String(event.jobName ?? \"ctx\")}_${String(event.scheduleTime ?? computedAt)}`;\n\n    for (const doc of dailyFactsSnapshot.docs) {\n      const userId = doc.ref.parent.parent?.id;\n      if (!userId) {\n        logger.warn(\"Skipping DailyFacts doc with unexpected path\", { path: doc.ref.path });\n        continue;\n      }\n\n      const today = doc.data() as DailyFacts;\n      if (!today || today.userId !== userId || today.date !== targetDate) {\n        logger.warn(\"Skipping DailyFacts doc with inconsistent data\", {\n          path: doc.ref.path,\n          userIdFromPath: userId,\n          userIdFromDoc: today?.userId,\n          dateFromDoc: today?.date,\n          targetDate,\n        });\n        continue;\n      }\n\n      const userRef = db.collection(\"users\").doc(userId);\n\n      const insightsSnap = await userRef.collection(\"insights\").where(\"date\", \"==\", targetDate).get();\n      const insightsForDay = insightsSnap.docs.map((d) => d.data() as Insight);\n\n      const eventsSnap = await userRef.collection(\"events\").where(\"day\", \"==\", targetDate).get();\n      const eventsForDay = eventsSnap.docs.map((d) => d.data() as CanonicalEvent);\n\n      const latestCanonicalEventAt: IsoDateTimeString =\n        eventsForDay.reduce<IsoDateTimeString | null>((max, ev) => {\n          const t = ev.updatedAt ?? ev.createdAt;\n          if (!t) return max;\n          if (!max) return t;\n          return t > max ? t : max;\n        }, null) ?? computedAt;\n\n      const intelligenceDoc = buildDailyIntelligenceContext({\n        userId,\n        date: targetDate,\n        computedAt,\n        today,\n        insightsForDay,\n      });\n\n      const intelligenceWithMeta = {\n        ...intelligenceDoc,\n        meta: buildPipelineMeta({\n          computedAt: latestCanonicalEventAt,\n          source: {\n            eventsForDay: eventsForDay.length,\n            insightsWritten: insightsForDay.length,\n          },\n        }),\n      };\n\n      if (currentOps >= MAX_OPS_PER_BATCH) {\n        batches.push(currentBatch);\n        currentBatch = db.batch();\n        currentOps = 0;\n      }\n\n      const outRef = userRef.collection(\"intelligenceContext\").doc(targetDate);\n      currentBatch.set(outRef, intelligenceWithMeta);\n      currentOps += 1;\n\n      // \u2705 Ledger run (retry-safe per scheduler seed + user)\n      const runId = `${runIdBase}_${userId}`;\n\n      const todayPipelineVersion = readPipelineMetaLike(today)?.pipelineVersion ?? 1;\n      const intelligencePipelineVersion = readPipelineMetaLike(intelligenceWithMeta)?.pipelineVersion ?? undefined;\n      const pipelineVersion = intelligencePipelineVersion ?? todayPipelineVersion;\n\n      await writeDerivedLedgerRun({\n        db,\n        userId,\n        date: targetDate,\n        runId,\n        computedAt,\n        pipelineVersion,\n        trigger: { type: \"scheduled\", name: \"onDailyIntelligenceContextRecomputeScheduled\", eventId: triggerEventId },\n        ...(latestCanonicalEventAt ? { latestCanonicalEventAt } : {}),\n        intelligenceContext: intelligenceWithMeta,\n      });\n\n      const latencyMs = computeLatencyMs(computedAt, latestCanonicalEventAt);\n      const warnAfterSec = 30;\n\n      if (shouldWarnLatency(latencyMs, warnAfterSec)) {\n        logger.warn(\"Pipeline latency high (canonical\u2192context)\", { userId, date: targetDate, latencyMs, warnAfterSec });\n      } else {\n        logger.info(\"Pipeline latency (canonical\u2192context)\", { userId, date: targetDate, latencyMs });\n      }\n\n      usersProcessed += 1;\n      docsWritten += 1;\n    }\n\n    if (currentOps > 0) batches.push(currentBatch);\n    await commitBatches(batches);\n\n    logger.info(\"DailyIntelligenceContext recompute completed\", {\n      targetDate,\n      usersProcessed,\n      docsWritten,\n      batchesCommitted: batches.length,\n    });\n  },\n);\n", "// services/functions/src/account/onAccountDeleteRequested.ts\n\nimport { onMessagePublished } from \"firebase-functions/v2/pubsub\";\nimport { logger } from \"firebase-functions\";\nimport { getAuth } from \"firebase-admin/auth\";\nimport { getFirestore, FieldValue } from \"firebase-admin/firestore\";\n\nconst TOPIC = \"account.delete.v1\";\n\n// Global lifecycle collection (NOT under /users/{uid})\nconst ACCOUNT_DELETIONS_COLLECTION = \"accountDeletions\";\n\ntype AccountDeleteMessage = {\n  uid: string;\n  requestId?: string;\n  requestedAt?: string;\n};\n\nconst assertUid = (uid: unknown): uid is string => typeof uid === \"string\" && uid.trim().length > 0;\n\nfunction deletionDocRef(db: FirebaseFirestore.Firestore, uid: string, requestId: string) {\n  // Single doc per (uid, requestId) for idempotency & observability.\n  // Keep IDs short + safe (Firestore disallows \"/\")\n  const id = `${uid}_${requestId}`.replace(/\\//g, \"_\");\n  return db.collection(ACCOUNT_DELETIONS_COLLECTION).doc(id);\n}\n\nasync function deleteUserFirestoreSubtree(db: FirebaseFirestore.Firestore, uid: string) {\n  const userRef = db.collection(\"users\").doc(uid);\n\n  // \u2705 Verified: profile exists (functions index writes users/{uid}/profile/general)\n  // Keep accountDeletion here to clean up any legacy docs from earlier versions.\n  const collections = [\"profile\", \"rawEvents\", \"events\", \"dailyFacts\", \"insights\", \"intelligenceContext\", \"healthScores\", \"accountDeletion\"] as const;\n\n  for (const col of collections) {\n    await db.recursiveDelete(userRef.collection(col));\n  }\n\n  await userRef.delete().catch(() => {\n    /* ignore already-deleted */\n  });\n}\n\nasync function deleteAuthUser(uid: string) {\n  const auth = getAuth();\n  try {\n    await auth.deleteUser(uid);\n  } catch (err: unknown) {\n    const msg = err instanceof Error ? err.message : String(err);\n    if (msg.toLowerCase().includes(\"user-not-found\")) return;\n    throw err;\n  }\n}\n\n/**\n * Account deletion executor\n *\n * Guarantees:\n * - user-scoped deletes only (data removed under /users/{uid})\n * - idempotent (safe retries)\n * - observable lifecycle state (stored outside user subtree)\n */\nexport const onAccountDeleteRequested = onMessagePublished(\n  {\n    topic: TOPIC,\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  },\n  async (event) => {\n    const payload = event.data?.message?.json as unknown;\n\n    if (!payload || typeof payload !== \"object\") {\n      logger.error(\"account.delete: invalid payload\");\n      return;\n    }\n\n    const { uid, requestId = event.id, requestedAt } = payload as AccountDeleteMessage;\n\n    if (!assertUid(uid)) {\n      logger.error(\"account.delete: invalid uid\", { uid });\n      return;\n    }\n\n    const db = getFirestore();\n    const ref = deletionDocRef(db, uid, requestId);\n\n    // Idempotency guard\n    const snap = await ref.get();\n    if (snap.exists && snap.data()?.status === \"completed\") {\n      logger.info(\"account.delete: already completed, skipping\", { uid, requestId });\n      return;\n    }\n\n    // Mark in-progress\n    await ref.set(\n      {\n        uid,\n        requestId,\n        requestedAt: requestedAt ?? null,\n        status: \"in_progress\",\n        startedAt: FieldValue.serverTimestamp(),\n        updatedAt: FieldValue.serverTimestamp(),\n      },\n      { merge: true },\n    );\n\n    try {\n      logger.info(\"account.delete: deleting firestore subtree\", { uid, requestId });\n      await deleteUserFirestoreSubtree(db, uid);\n\n      logger.info(\"account.delete: deleting auth user\", { uid, requestId });\n      await deleteAuthUser(uid);\n\n      await ref.set(\n        {\n          status: \"completed\",\n          completedAt: FieldValue.serverTimestamp(),\n          updatedAt: FieldValue.serverTimestamp(),\n        },\n        { merge: true },\n      );\n\n      logger.info(\"account.delete: completed\", { uid, requestId });\n    } catch (err) {\n      logger.error(\"account.delete: failed\", { uid, requestId, err });\n\n      await ref.set(\n        {\n          status: \"failed\",\n          error: err instanceof Error ? err.message : String(err),\n          updatedAt: FieldValue.serverTimestamp(),\n        },\n        { merge: true },\n      );\n\n      throw err; // let Pub/Sub retry\n    }\n  },\n);", "// services/functions/src/account/onAccountExportRequested.ts\n\nimport { onMessagePublished } from \"firebase-functions/v2/pubsub\";\nimport { logger } from \"firebase-functions\";\nimport { FieldValue, getFirestore } from \"firebase-admin/firestore\";\nimport { getStorage } from \"firebase-admin/storage\";\n\nconst TOPIC = \"exports.requests.v1\";\n\n// Global lifecycle collection (NOT under /users/{uid})\nconst ACCOUNT_EXPORTS_COLLECTION = \"accountExports\";\n\n// Confirmed to exist in staging runtime evidence.\n// Hard default keeps deployment deterministic.\nconst DEFAULT_EXPORTS_BUCKET = \"oli-staging-fdbba-staging-data-exports\";\n\ntype AccountExportMessage = {\n  uid: string;\n  requestId?: string;\n  requestedAt?: string;\n};\n\nconst assertUid = (uid: unknown): uid is string => typeof uid === \"string\" && uid.trim().length > 0;\n\nfunction exportDocRef(db: FirebaseFirestore.Firestore, uid: string, requestId: string) {\n  // Single doc per (uid, requestId) for idempotency & observability.\n  // Keep IDs short + safe (Firestore disallows \"/\")\n  const id = `${uid}_${requestId}`.replace(/\\//g, \"_\");\n  return db.collection(ACCOUNT_EXPORTS_COLLECTION).doc(id);\n}\n\nasync function readCollectionAll(\n  db: FirebaseFirestore.Firestore,\n  path: string,\n): Promise<Record<string, unknown>[]> {\n  const snap = await db.collection(path).get();\n  return snap.docs.map((d) => ({\n    id: d.id,\n    ...(d.data() as Record<string, unknown>),\n  }));\n}\n\n/**\n * Account export executor\n *\n * Guarantees:\n * - user-scoped data read only\n * - idempotent\n * - observable lifecycle (queued \u2192 in_progress \u2192 completed|failed)\n * - writes GCS artifact + pointer in Firestore\n *\n * NOTE:\n * Lifecycle doc is stored outside /users/{uid} so account deletion cannot resurrect user subtree.\n */\nexport const onAccountExportRequested = onMessagePublished(\n  {\n    topic: TOPIC,\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n  },\n  async (event) => {\n    const payload = event.data?.message?.json as unknown;\n\n    if (!payload || typeof payload !== \"object\") {\n      logger.error(\"account.export: invalid payload\");\n      return;\n    }\n\n    const { uid, requestId = event.id, requestedAt } = payload as AccountExportMessage;\n\n    if (!assertUid(uid)) {\n      logger.error(\"account.export: invalid uid\", { uid });\n      return;\n    }\n\n    const db = getFirestore();\n    const ref = exportDocRef(db, uid, requestId);\n\n    // Idempotency guard\n    const snap = await ref.get();\n    if (snap.exists && snap.data()?.status === \"completed\") {\n      logger.info(\"account.export: already completed\", { uid, requestId });\n      return;\n    }\n\n    // Mark in progress\n    await ref.set(\n      {\n        uid,\n        requestId,\n        requestedAt: requestedAt ?? null,\n        status: \"in_progress\",\n        startedAt: FieldValue.serverTimestamp(),\n        updatedAt: FieldValue.serverTimestamp(),\n      },\n      { merge: true },\n    );\n\n    try {\n      const bucketName = process.env.EXPORTS_BUCKET?.trim() || DEFAULT_EXPORTS_BUCKET;\n\n      logger.info(\"account.export: collecting data\", {\n        uid,\n        requestId,\n        bucketName,\n      });\n\n      const profileGeneralSnap = await db.doc(`users/${uid}/profile/general`).get();\n      const profileGeneral = profileGeneralSnap.exists ? profileGeneralSnap.data() : null;\n\n      const collections = [\"rawEvents\", \"events\", \"dailyFacts\", \"insights\", \"intelligenceContext\", \"healthScores\"] as const;\n\n      const data: Record<string, unknown> = {\n        profile: { general: profileGeneral },\n        collections: {},\n      };\n\n      for (const col of collections) {\n        (data.collections as Record<string, unknown>)[col] = await readCollectionAll(db, `users/${uid}/${col}`);\n      }\n\n      const artifact = {\n        schemaVersion: 1,\n        kind: \"account.export.v1\",\n        uid,\n        requestId,\n        requestedAt: requestedAt ?? null,\n        generatedAt: new Date().toISOString(),\n        data,\n      };\n\n      const objectPath = `exports/${uid}/${requestId}.json`;\n      const storage = getStorage();\n      const bucket = storage.bucket(bucketName);\n      const file = bucket.file(objectPath);\n\n      const body = Buffer.from(JSON.stringify(artifact), \"utf8\");\n\n      logger.info(\"account.export: writing artifact\", {\n        uid,\n        requestId,\n        objectPath,\n        bytes: body.length,\n      });\n\n      await file.save(body, {\n        resumable: false,\n        contentType: \"application/json; charset=utf-8\",\n        metadata: {\n          metadata: {\n            uid,\n            requestId,\n            kind: \"account.export.v1\",\n          },\n        },\n      });\n\n      const [meta] = await file.getMetadata();\n\n      await ref.set(\n        {\n          status: \"completed\",\n          completedAt: FieldValue.serverTimestamp(),\n          updatedAt: FieldValue.serverTimestamp(),\n          artifact: {\n            bucket: bucketName,\n            object: objectPath,\n            contentType: meta.contentType ?? \"application/json\",\n            size: meta.size ? Number(meta.size) : null,\n            generation: meta.generation ?? null,\n            md5Hash: meta.md5Hash ?? null,\n            updated: meta.updated ?? null,\n          },\n        },\n        { merge: true },\n      );\n\n      logger.info(\"account.export: completed\", { uid, requestId });\n    } catch (err) {\n      logger.error(\"account.export: failed\", { uid, requestId, err });\n\n      await ref.set(\n        {\n          status: \"failed\",\n          error: err instanceof Error ? err.message : String(err),\n          updatedAt: FieldValue.serverTimestamp(),\n        },\n        { merge: true },\n      );\n\n      throw err; // allow retry\n    }\n  },\n);", "// services/functions/src/http/recomputeDailyFactsAdminHttp.ts\n\nimport { onRequest } from \"firebase-functions/v2/https\";\nimport * as logger from \"firebase-functions/logger\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type {\n  CanonicalEvent,\n  DailyFacts,\n  IsoDateTimeString,\n  YmdDateString,\n} from \"../types/health\";\nimport { aggregateDailyFactsForDay } from \"../dailyFacts/aggregateDailyFacts\";\nimport { enrichDailyFactsWithBaselinesAndAverages } from \"../dailyFacts/enrichDailyFacts\";\nimport { requireAdmin } from \"./adminAuth\";\n\n// \u2705 Data Readiness Contract\nimport { buildPipelineMeta } from \"../pipeline/pipelineMeta\";\n\nconst isYmd = (value: unknown): value is YmdDateString =>\n  typeof value === \"string\" && /^\\d{4}-\\d{2}-\\d{2}$/.test(value);\n\nconst isNonEmptyString = (value: unknown): value is string =>\n  typeof value === \"string\" && value.trim().length > 0;\n\nconst toYmdUtc = (date: Date): YmdDateString => {\n  const year = date.getUTCFullYear().toString().padStart(4, \"0\");\n  const month = (date.getUTCMonth() + 1).toString().padStart(2, \"0\");\n  const day = date.getUTCDate().toString().padStart(2, \"0\");\n  return `${year}-${month}-${day}`;\n};\n\nconst parseIntStrict = (value: string): number | null => {\n  if (!/^\\d+$/.test(value)) return null;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst parseYmdUtc = (ymd: YmdDateString): Date => {\n  const parts = ymd.split(\"-\");\n  if (parts.length !== 3) {\n    throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  }\n\n  const y = parseIntStrict(parts[0] ?? \"\");\n  const m = parseIntStrict(parts[1] ?? \"\");\n  const d = parseIntStrict(parts[2] ?? \"\");\n\n  if (y === null || m === null || d === null) {\n    throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  }\n\n  return new Date(Date.UTC(y, m - 1, d));\n};\n\nconst getYmdNDaysBefore = (date: YmdDateString, days: number): YmdDateString => {\n  const base = parseYmdUtc(date);\n  base.setUTCDate(base.getUTCDate() - days);\n  return toYmdUtc(base);\n};\n\ntype Body = {\n  userId: string;\n  date: YmdDateString;\n};\n\nconst parseBody = (raw: unknown): Body | null => {\n  if (!raw || typeof raw !== \"object\") return null;\n  const obj = raw as Record<string, unknown>;\n\n  const userId = obj[\"userId\"];\n  const date = obj[\"date\"];\n\n  if (!isNonEmptyString(userId)) return null;\n  if (!isYmd(date)) return null;\n\n  return { userId, date };\n};\n\n/**\n * Admin-only HTTP endpoint\n * Recomputes DailyFacts for a specific user + date.\n *\n * Input:\n *  { \"userId\": \"...\", \"date\": \"YYYY-MM-DD\" }\n *\n * Output:\n *  { ok: true, written: true, path: \"...\", date: \"...\", userId: \"...\" }\n */\nexport const recomputeDailyFactsAdminHttp = onRequest(\n  {\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n    invoker: \"private\",\n  },\n  async (req, res) => {\n    const auth = await requireAdmin(req.header(\"authorization\"));\n    if (!auth.ok) {\n      res.status(auth.status).json({ ok: false, error: auth.message });\n      return;\n    }\n\n    const body = parseBody(req.body);\n    if (!body) {\n      res\n        .status(400)\n        .json({ ok: false, error: \"Invalid body. Expected { userId, date: YYYY-MM-DD }\" });\n      return;\n    }\n\n    const { userId, date } = body;\n    const computedAt: IsoDateTimeString = new Date().toISOString();\n\n    try {\n      const userRef = db.collection(\"users\").doc(userId);\n\n      /**\n       * Load canonical events for that user + day\n       */\n      const eventsSnap = await userRef.collection(\"events\").where(\"day\", \"==\", date).get();\n\n      const events: CanonicalEvent[] = eventsSnap.docs.map((d) => d.data() as CanonicalEvent);\n\n      // Truth anchor for readiness\n      const latestCanonicalEventAt: IsoDateTimeString =\n        events.reduce<IsoDateTimeString | null>((max, ev) => {\n          const t = ev.updatedAt ?? ev.createdAt;\n          if (!t) return max;\n          if (!max) return t;\n          return t > max ? t : max;\n        }, null) ?? computedAt;\n\n      const base: DailyFacts = aggregateDailyFactsForDay({\n        userId,\n        date,\n        computedAt,\n        events,\n      });\n\n      /**\n       * Load up-to-6 prior days for enrichment window\n       */\n      const startDate = getYmdNDaysBefore(date, 6);\n\n      const historySnap = await userRef\n        .collection(\"dailyFacts\")\n        .where(\"date\", \">=\", startDate)\n        .where(\"date\", \"<\", date)\n        .get();\n\n      const history: DailyFacts[] = historySnap.docs.map((d) => d.data() as DailyFacts);\n\n      const enriched = enrichDailyFactsWithBaselinesAndAverages({\n        today: base,\n        history,\n      });\n\n      /**\n       * Write DailyFacts with readiness meta\n       *\n       * \u2705 Authoritative recompute: overwrite the doc fully (no merge),\n       * so stale fields cannot survive across recomputes.\n       */\n      const ref = userRef.collection(\"dailyFacts\").doc(date);\n      await ref.set({\n        ...enriched,\n        meta: buildPipelineMeta({\n          computedAt: latestCanonicalEventAt,\n          source: { eventsForDay: events.length },\n        }),\n      });\n\n      logger.info(\"Admin recomputeDailyFacts complete\", {\n        userId,\n        date,\n        eventsForDay: events.length,\n      });\n\n      res.status(200).json({\n        ok: true,\n        written: true,\n        userId,\n        date,\n        path: ref.path,\n      });\n    } catch (err) {\n      logger.error(\"Admin recomputeDailyFacts failed\", { userId, date, err });\n      res.status(500).json({ ok: false, error: \"Internal error recomputing DailyFacts\" });\n    }\n  },\n);", "// services/functions/src/http/adminAuth.ts\n\nimport { admin } from '../firebaseAdmin';\n\nexport type AdminAuthResult =\n  | { ok: true; uid: string; claims: Record<string, unknown> }\n  | { ok: false; status: number; message: string };\n\n/**\n * Verifies Firebase ID token and requires `admin: true` custom claim.\n *\n * Send header:\n * Authorization: Bearer <ID_TOKEN>\n */\nexport const requireAdmin = async (authorizationHeader: string | undefined): Promise<AdminAuthResult> => {\n  const header = authorizationHeader ?? '';\n  const match = header.match(/^Bearer (.+)$/);\n  const token = match?.[1];\n\n  if (!token) {\n    return { ok: false, status: 401, message: 'Missing Authorization: Bearer <token>' };\n  }\n\n  try {\n    const decoded = await admin.auth().verifyIdToken(token);\n    const claims = decoded as unknown as Record<string, unknown>;\n    const isAdmin = claims['admin'] === true;\n\n    if (!isAdmin) {\n      return { ok: false, status: 403, message: 'Admin privileges required' };\n    }\n\n    return { ok: true, uid: decoded.uid, claims };\n  } catch {\n    return { ok: false, status: 401, message: 'Invalid or expired token' };\n  }\n};\n", "// services/functions/src/http/recomputeInsightsAdminHttp.ts\n\nimport { onRequest } from \"firebase-functions/v2/https\";\nimport * as logger from \"firebase-functions/logger\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type { DailyFacts, IsoDateTimeString, YmdDateString } from \"../types/health\";\nimport { generateInsightsForDailyFacts } from \"../insights/rules\";\nimport { requireAdmin } from \"./adminAuth\";\n\n// \u2705 Data Readiness Contract\nimport { buildPipelineMeta } from \"../pipeline/pipelineMeta\";\n\nconst isYmd = (value: unknown): value is YmdDateString =>\n  typeof value === \"string\" && /^\\d{4}-\\d{2}-\\d{2}$/.test(value);\n\nconst isNonEmptyString = (value: unknown): value is string =>\n  typeof value === \"string\" && value.trim().length > 0;\n\nconst toYmdUtc = (date: Date): YmdDateString => {\n  const year = date.getUTCFullYear().toString().padStart(4, \"0\");\n  const month = (date.getUTCMonth() + 1).toString().padStart(2, \"0\");\n  const day = date.getUTCDate().toString().padStart(2, \"0\");\n  return `${year}-${month}-${day}`;\n};\n\nconst parseIntStrict = (value: string): number | null => {\n  if (!/^\\d+$/.test(value)) return null;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst parseYmdUtc = (ymd: YmdDateString): Date => {\n  const parts = ymd.split(\"-\");\n  if (parts.length !== 3) {\n    throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  }\n\n  const y = parseIntStrict(parts[0] ?? \"\");\n  const m = parseIntStrict(parts[1] ?? \"\");\n  const d = parseIntStrict(parts[2] ?? \"\");\n\n  if (y === null || m === null || d === null) {\n    throw new Error(`Invalid YmdDateString: \"${ymd}\"`);\n  }\n\n  return new Date(Date.UTC(y, m - 1, d));\n};\n\nconst addDaysUtc = (ymd: YmdDateString, deltaDays: number): YmdDateString => {\n  const base = parseYmdUtc(ymd);\n  const next = new Date(base.getTime() + deltaDays * 24 * 60 * 60 * 1000);\n  return toYmdUtc(next);\n};\n\nconst buildWindowDatesInclusive = (\n  endDate: YmdDateString,\n  windowSizeDays: number,\n): YmdDateString[] => {\n  const dates: YmdDateString[] = [];\n  for (let i = windowSizeDays - 1; i >= 0; i--) {\n    dates.push(addDaysUtc(endDate, -i));\n  }\n  return dates;\n};\n\ntype Body = {\n  userId: string;\n  date: YmdDateString;\n};\n\nconst parseBody = (raw: unknown): Body | null => {\n  if (!raw || typeof raw !== \"object\") return null;\n  const obj = raw as Record<string, unknown>;\n\n  const userId = obj[\"userId\"];\n  const date = obj[\"date\"];\n\n  if (!isNonEmptyString(userId)) return null;\n  if (!isYmd(date)) return null;\n\n  return { userId, date };\n};\n\nconst sortByDateAsc = (a: DailyFacts, b: DailyFacts): number => {\n  if (a.date < b.date) return -1;\n  if (a.date > b.date) return 1;\n  return 0;\n};\n\nconst chunk = <T,>(arr: T[], size: number): T[][] => {\n  const out: T[][] = [];\n  for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));\n  return out;\n};\n\nconst latestComputedAtFromDailyFactsWindow = (\n  facts: DailyFacts[],\n  fallback: IsoDateTimeString,\n): IsoDateTimeString => {\n  // DailyFacts is expected to have `computedAt` (string ISO).\n  const max = facts.reduce<IsoDateTimeString | null>((acc, f) => {\n    const t = (f as { computedAt?: IsoDateTimeString }).computedAt;\n    if (!t) return acc;\n    if (!acc) return t;\n    return t > acc ? t : acc;\n  }, null);\n\n  return max ?? fallback;\n};\n\n/**\n * Admin-only HTTP endpoint\n * Recomputes Insights for a specific user + date using a 7-day DailyFacts window.\n *\n * Input:\n *  { \"userId\": \"...\", \"date\": \"YYYY-MM-DD\" }\n */\nexport const recomputeInsightsAdminHttp = onRequest(\n  {\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n    invoker: \"private\",\n  },\n  async (req, res) => {\n    const auth = await requireAdmin(req.header(\"authorization\"));\n    if (!auth.ok) {\n      res.status(auth.status).json({ ok: false, error: auth.message });\n      return;\n    }\n\n    const body = parseBody(req.body);\n    if (!body) {\n      res\n        .status(400)\n        .json({ ok: false, error: \"Invalid body. Expected { userId, date: YYYY-MM-DD }\" });\n      return;\n    }\n\n    const { userId, date } = body;\n    const now: IsoDateTimeString = new Date().toISOString();\n\n    try {\n      const userRef = db.collection(\"users\").doc(userId);\n\n      const windowDates = buildWindowDatesInclusive(date, 7);\n\n      const windowSnap = await userRef\n        .collection(\"dailyFacts\")\n        .where(\"date\", \"in\", windowDates)\n        .get();\n\n      const windowFacts = windowSnap.docs\n        .map((d) => d.data() as DailyFacts)\n        .sort(sortByDateAsc);\n\n      const today = windowFacts.find((f) => f.date === date);\n      if (!today) {\n        res\n          .status(404)\n          .json({ ok: false, error: `DailyFacts not found for userId=${userId} date=${date}` });\n        return;\n      }\n\n      const history = windowFacts.filter((f) => f.date !== date);\n\n      const insights = generateInsightsForDailyFacts({\n        userId,\n        date,\n        today,\n        history,\n        now,\n      });\n\n      // \u2705 Truth anchor for readiness: latest DailyFacts computedAt in the window\n      const latestDailyFactsAt = latestComputedAtFromDailyFactsWindow(windowFacts, now);\n\n      const insightsCol = userRef.collection(\"insights\");\n\n      /**\n       * \u2705 Authoritative recompute:\n       * 1) Delete all existing insights for this (userId, date)\n       * 2) Write the newly computed insight set\n       *\n       * This guarantees no stale insight docs survive across recomputes.\n       */\n      const existingSnap = await insightsCol.where(\"date\", \"==\", date).get();\n      const existingRefs = existingSnap.docs.map((d) => d.ref);\n\n      // Firestore batch limit is 500 ops; use a safe headroom.\n      for (const refsChunk of chunk(existingRefs, 450)) {\n        const delBatch = db.batch();\n        for (const ref of refsChunk) delBatch.delete(ref);\n        await delBatch.commit();\n      }\n\n      const insightDocs = insights.map((insight) => ({\n        ref: insightsCol.doc(insight.id),\n        data: {\n          ...insight,\n          meta: buildPipelineMeta({\n            computedAt: latestDailyFactsAt,\n            source: {\n              windowDays: windowDates.length,\n              dailyFactsDocs: windowFacts.length,\n            },\n          }),\n        } as Record<string, unknown>,\n      }));\n\n      for (const docsChunk of chunk(insightDocs, 450)) {\n        const writeBatch = db.batch();\n        for (const d of docsChunk) writeBatch.set(d.ref, d.data);\n        await writeBatch.commit();\n      }\n\n      logger.info(\"Admin recomputeInsights complete\", {\n        userId,\n        date,\n        deletedExisting: existingRefs.length,\n        insightsWritten: insights.length,\n      });\n\n      res.status(200).json({\n        ok: true,\n        written: true,\n        userId,\n        date,\n        deletedExisting: existingRefs.length,\n        insightsWritten: insights.length,\n      });\n    } catch (err) {\n      logger.error(\"Admin recomputeInsights failed\", { userId, date, err });\n      res.status(500).json({ ok: false, error: \"Internal error recomputing Insights\" });\n    }\n  },\n);", "// services/functions/src/http/recomputeDailyIntelligenceContextAdminHttp.ts\n\nimport { onRequest } from \"firebase-functions/v2/https\";\nimport * as logger from \"firebase-functions/logger\";\n\nimport { db } from \"../firebaseAdmin\";\nimport type {\n  CanonicalEvent,\n  DailyFacts,\n  Insight,\n  IsoDateTimeString,\n  YmdDateString,\n} from \"../types/health\";\nimport { requireAdmin } from \"./adminAuth\";\nimport { buildDailyIntelligenceContext } from \"../intelligence/buildDailyIntelligenceContext\";\n\n// \u2705 Data Readiness Contract\nimport { buildPipelineMeta } from \"../pipeline/pipelineMeta\";\n\nconst isYmd = (value: unknown): value is YmdDateString =>\n  typeof value === \"string\" && /^\\d{4}-\\d{2}-\\d{2}$/.test(value);\n\nconst isNonEmptyString = (value: unknown): value is string =>\n  typeof value === \"string\" && value.trim().length > 0;\n\ntype Body = {\n  userId: string;\n  date: YmdDateString;\n};\n\nconst parseBody = (raw: unknown): Body | null => {\n  if (!raw || typeof raw !== \"object\") return null;\n  const obj = raw as Record<string, unknown>;\n\n  const userId = obj[\"userId\"];\n  const date = obj[\"date\"];\n\n  if (!isNonEmptyString(userId)) return null;\n  if (!isYmd(date)) return null;\n\n  return { userId, date };\n};\n\n/**\n * Admin-only HTTP endpoint\n * Recomputes Daily Intelligence Context for a specific user + date\n * from DailyFacts + Insights.\n *\n * Input:\n *  { \"userId\": \"...\", \"date\": \"YYYY-MM-DD\" }\n */\nexport const recomputeDailyIntelligenceContextAdminHttp = onRequest(\n  {\n    region: \"us-central1\",\n    serviceAccount: \"oli-functions-runtime@oli-staging-fdbba.iam.gserviceaccount.com\",\n    invoker: \"private\",\n  },\n  async (req, res) => {\n    const auth = await requireAdmin(req.header(\"authorization\"));\n    if (!auth.ok) {\n      res.status(auth.status).json({ ok: false, error: auth.message });\n      return;\n    }\n\n    const body = parseBody(req.body);\n    if (!body) {\n      res\n        .status(400)\n        .json({ ok: false, error: \"Invalid body. Expected { userId, date: YYYY-MM-DD }\" });\n      return;\n    }\n\n    const { userId, date } = body;\n    const computedAt: IsoDateTimeString = new Date().toISOString();\n\n    try {\n      const userRef = db.collection(\"users\").doc(userId);\n\n      // DailyFacts is required input\n      const dailyFactsSnap = await userRef.collection(\"dailyFacts\").doc(date).get();\n      if (!dailyFactsSnap.exists) {\n        res\n          .status(404)\n          .json({ ok: false, error: `DailyFacts not found for userId=${userId} date=${date}` });\n        return;\n      }\n\n      const today = dailyFactsSnap.data() as DailyFacts;\n\n      // Insights for the day (optional input)\n      const insightsSnap = await userRef.collection(\"insights\").where(\"date\", \"==\", date).get();\n      const insightsForDay = insightsSnap.docs.map((d) => d.data() as Insight);\n\n      // \u2705 Truth anchor for readiness: latest canonical event timestamp for the day\n      const eventsSnap = await userRef.collection(\"events\").where(\"day\", \"==\", date).get();\n      const eventsForDay = eventsSnap.docs.map((d) => d.data() as CanonicalEvent);\n\n      const latestCanonicalEventAt: IsoDateTimeString =\n        eventsForDay.reduce<IsoDateTimeString | null>((max, ev) => {\n          const t = ev.updatedAt ?? ev.createdAt;\n          if (!t) return max;\n          if (!max) return t;\n          return t > max ? t : max;\n        }, null) ?? computedAt;\n\n      const intelligenceDoc = buildDailyIntelligenceContext({\n        userId,\n        date,\n        computedAt,\n        today,\n        insightsForDay,\n      });\n\n      // \u2705 Authoritative recompute: overwrite the doc fully (no merge),\n      // so stale fields cannot survive across recomputes.\n      const outRef = userRef.collection(\"intelligenceContext\").doc(date);\n      await outRef.set({\n        ...intelligenceDoc,\n        meta: buildPipelineMeta({\n          computedAt: latestCanonicalEventAt,\n          source: {\n            eventsForDay: eventsForDay.length,\n            insightsWritten: insightsForDay.length,\n          },\n        }),\n      });\n\n      logger.info(\"Admin recomputeDailyIntelligenceContext complete\", {\n        userId,\n        date,\n        eventsForDay: eventsForDay.length,\n        insightsWritten: insightsForDay.length,\n      });\n\n      res.status(200).json({\n        ok: true,\n        written: true,\n        userId,\n        date,\n        path: outRef.path,\n        insightsCount: insightsForDay.length,\n      });\n    } catch (err) {\n      logger.error(\"Admin recomputeDailyIntelligenceContext failed\", { userId, date, err });\n      res\n        .status(500)\n        .json({ ok: false, error: \"Internal error recomputing Daily Intelligence Context\" });\n    }\n  },\n);"],
  "mappings": "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",
  "names": ["import_firestore", "logger", "util", "objectUtil", "error", "errorUtil", "error", "errorMap", "ctx", "result", "issues", "elements", "processed", "result", "r", "ZodFirstPartyTypeKind", "isoString", "confidenceSchema", "computeMetaSchema", "isoString", "isoString", "isoString", "isoString", "isoString", "manualWeightPayloadSchema", "isoString", "isoString", "import_node_crypto", "crypto", "crypto", "logger", "stableStringify", "stableStringify", "import_node_crypto", "stableStringify", "crypto", "isNumber", "average", "clamp01", "DEFAULT_DOMAIN_CONFIDENCE_THRESHOLD", "isFiniteNumber", "clamp01", "getDomainConfidence", "import_node_crypto", "stableStringify", "sha256Hex", "crypto", "db", "isFiniteNumber", "stableStringify", "db", "db", "rawData", "day", "import_firestore", "logger", "toYmdUtc", "parseIntStrict", "parseYmdUtc", "addDaysUtc", "logger", "toYmdUtc", "parseIntStrict", "parseYmdUtc", "addDaysUtc", "import_scheduler", "logger", "toYmdUtc", "parseIntStrict", "parseYmdUtc", "addDaysUtc", "getYesterdayUtcYmd", "sortByDateAsc", "commitBatches", "import_scheduler", "logger", "readPipelineMetaLike", "toYmdUtc", "getYesterdayUtcYmd", "commitBatches", "import_firestore", "db", "import_pubsub", "import_firebase_functions", "import_firestore", "TOPIC", "assertUid", "db", "logger", "toYmdUtc", "parseIntStrict", "parseYmdUtc", "import_https", "logger", "isYmd", "isNonEmptyString", "toYmdUtc", "parseIntStrict", "parseYmdUtc", "addDaysUtc", "buildWindowDatesInclusive", "parseBody", "sortByDateAsc", "import_https", "logger", "isYmd", "isNonEmptyString", "parseBody"]
}
